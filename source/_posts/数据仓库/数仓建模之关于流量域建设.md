---
title: 数仓建模之关于流量域建设
tags:
  - 数仓建模
  - private
categories:
  - 数据仓库
toc: true
abbrlink: bbbc8dfb
date: 2023-04-14 16:56:16
---
```mermaid
graph LR
A-- 文字描述2 --->B --> c
```

# 什么是流量数据

记录用户在APP、H5、小程序上的操作行为数据即为流量数据，比如点击某个按钮、浏览页面，你能想到的在手机和电脑屏幕可进行的操作都是流量数据。分析这些流量数据，统计用户行为的pv和uv，对业务运营决策和产品规划设计都有着重要意义。

# 流量数据采集

采集流量数据在前、后端均可实现

* 前端埋点：将采集的 SDK 集成在终端上，主要有三种：代码埋点、可视化埋点、无埋点。hipac采取的是代码埋点

  优点是高度定制，控制精准，采集的数据丰富准确，方便灵活，能方便手机到用户在界面上的行为数据
* 后端埋点：在服务端埋点，一般是和前端埋点搭配使用。它的优点是内网传输，即时性强，丢失风险小。

hipac的埋点定义了 **应用、模块、页面、区域、元素** 等采集内容，并在数仓层面完成了归因分析模型建设

技术层面的埋点数据采集持久化架构：
![iPmU5X.png](https://i.328888.xyz/2023/05/04/iPmU5X.png)
analytics系统有两个作用
- 将http请求转化为保存到磁盘上的log
- 接受sls的消息将logstore里面数据写到ES和HDFS

# 埋点信息与事件

hipac的埋点上报目前支持3种用户行为数据:

| 类型     | 详细说明                                   | 支持平台        |
| ---------- | -------------------------------------------- | ----------------- |
| 页面曝光 | 当用户打开页面时，上报页面数据             | APP、H5、小程序 |
| 区域曝光 | 当用户滑动屏幕，区块出现当前屏幕时，上报区块数据 | APP |
| 元素点击 | 当用户点击某个按钮时，上报用户点击事件数据 | APP、H5、小程序 |
| 页面停留时长 | 用户离开页面时间-用户进入页面时间 | APP |


埋点数据主要有4部分：基本信息、具体点位、行为类型、扩展字段

## 基本信息
埋点数据的基本信息是自动从当前系统获取的，字段有：
![iPc7eA.png](https://i.328888.xyz/2023/05/04/iPc7eA.png)

## 具体点位
字段名`utrp`，指具体上报的redpill点位，常见叫法还有**fullcode**

redpill点位是由**数字**和**点**组成的字符串，格式为`应用.模块.页面.区域.元素`

## 行为类型

字段名`utp`，指上报埋点的数据类型，比如：页面曝光、点击事件、可见区域曝光、数据结果曝光、进入页面、离开页面


## 扩展字段
字段`extendFields`，对utrp点位，进行业务数据补充



# 一些参考文章

[美团外卖流量数据的采集加工和应用](https://toutiao.io/posts/csx9zdy/preview)
