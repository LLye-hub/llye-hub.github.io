---
title: 认识一下拉链表
tags:
  - 拉链表
categories:
  - 数据仓库
toc: true
abbrlink: 4e6addf5
date: 2023-11-13 12:20:37
---
# 什么是拉链表

拉链表是维护历史状态，以及最新状态数据的一种表。拉链表记录一个事物从开始，一直到当前状态的所有变化的信息，存储的是用户的最基本信息以及每条记录的生命周期。拉链表根据拉链粒度的不同，实际上相当于快照，只不过做了优化，去除了一部分不变的记录，通过拉链表可以很方便的还原出拉链时点的客户记录。
**拉链表和流水表** ：流水表存放的是一个用户的变更记录，比如在一张流水表中，一天的数据中，会存放一个用户的每条修改记录，但是在拉链表中只有一条记录。

## 数仓模型设计中有下面的需求场景：

1、表中的部分字段会被 update，例如：用户的地址，产品的描述信息，品牌信息等等。
2、需要查看某一个时间点或是时间段的历史快照信息，例如：查看某一个产品在历史某一时间点的状态；查看某一个用户在过去某一段时间内，更新过几次等等。
3、变化的比例和频率不是很大，例如：总共有 1000 万的会员，每天新增和发生变化的有 10 万左右，变化的比例占比很小。

## 那么，上面需求中的数据模型应该怎样设计：

- **方案一：快照每一天的数据到数仓**
- 每一天都保存一份全量，将所有数据同步到数仓中，很多记录都是重复保存，没有任何变化
- **方案二：每天保留一份全量的切片数据**
  每天一份全量的切片是一种比较稳妥的方案，而且历史数据也在。缺点就是存储空间占用量太大太大了，如果对这边表每天都保留一份全量，那么每次全量中会保存很多不变的信息，对存储是极大的浪费。当然也可以做一些取舍，比如只保留近一个月的数据？但是，需求是无耻的，数据的生命周期不是我们能完全左右的。
- **方案三：使用拉链表**
  - 拉链表不存储冗余的数据，只有某行的数据发生变化，才需要保存下来，相比每次全量同步会节省存储空间
  - 能够查询到历史快照
  - 额外的增加了两个时间列（`dw_start_date`、`dw_end_date`），为数据行的生命周期
