---
title: 数仓分层
tags:
  - 文章内容的关键词
categories:
  - 对照文件存放的目录名称
toc: true
abbrlink: 96c137c4
date: 2023-11-09 21:54:03
---

# 为什么要分层

试想一下没有数仓分层的以下场景：

有一个需求，计算每个用户日gmv，然后从交易系统抽取数据，并求和计算得到一张 A 表。  
又来了一个需求，计算每个地区的日gmv，这时发现能再 A 表的基础上能聚合加工得到 B 表。  
一段时间后，需要每个地区的日净gmv（不包含退款），这时 B 表和 A 表都不能支持，然后又从交易系统重复抽取数据。  

上面场景比较简单化，实际中，在没有划分数仓分层的情况下，我们可能会做出一套表依赖结构混乱，甚至出现循环依赖的数据体系。

类比图书管理，如果没有书架和分类标识，图书随意堆叠在一起，每次都需要重复搬书翻找，十分地耗时耗力。当有了书架和分类摆放，每次按照标识就能快速定位书籍位置。

因此，我们需要一套行之有效的数据组织和管理方法来让我们的数据体系更有序，这就是谈到的数据分层。

# 分层的好处
数据分层并不能解决所有的数据问题，但是，数据分层却可以给我们带来如下的好处：

（1）**清晰数据结构**：每一个数据分层都有对应的作用域，在使用数据的时候能更方便的定位和理解。  
（2）**数据血缘追踪**：提供给业务人员或下游系统的数据服务时都是目标数据，目标数据的数据来源一般都来自于多张表数据。若出现目标数据异常时，清晰的血缘关系可以快速定位问题所在。而且，血缘管理也是元数据管理重要的一部分。  
（2）**减少重复开发**：数据的逐层加工原则，下层包含了上层数据加工所需要的全量数据，这样的加工方式避免了每个数据开发人员都重新从源系统抽取数据进行加工。  
（3）**数据关系条理化**：源系统间存在复杂的数据关系，比如客户信息同时存在于核心系统、信贷系统、理财系统、资金系统，取数时该如何决策呢？数据仓库会对相同主题的数据进行统一建模，把复杂的数据关系梳理成条理清晰的数据模型，使用时就可避免上述问题了。  
（4）**屏蔽原始数据的影响**：数据的逐层加工原则，上层的数据都由下一层的数据加工获取，不允许跳级取数。而原始数据位于数仓的最底层，离应用层数据还有多层的数据加工，所以加工应用层数据的过程中就会把原始数据的变更消除掉，保持应用层的稳定性。  

# 分层架构
以呆过的一家公司的数仓架构为例，数仓架构主要分为五层：

1）**ods：（Operational Data Store）数据贴源层**，将业务系统的数据几乎无处理地存储在数仓系统中，结构上与业务系统基本保持一致。  
2）**dwd：（Data Warehouse Detail）数据明细层**，用于隔离业务层和数据仓库，保持和ods层一样的颗粒度，对ods层的数据做一些简单的清洗、去空值、标准化处理。  
3）**dw：（Data Warehouse）数据中间层**，在dwd层的基础上，对数据进行轻微的聚合操作，提升公共指标的复用性，减少重复加工操作。  
4）**dws：（Data Warehouse Summary）数据汇总层**，以dw层为基础，整合成分析某个主题域的汇总数据，用于提供后续的查询分析服务。该层的数据表会涵盖较多的业务信息，字段较多，一般称为宽表。  
5）**ads：（Application Data Store）数据应用层**，为各种数据产品提供个性化的统计指标数据。 

此外，还有**dim层（维表层）**，将事实表中重复出现的属性信息抽取出来，用一张表进行规范管理，查询时再与事实表进行关联。