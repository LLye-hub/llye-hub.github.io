---
title: 关于数据仓库建设的一些思考
tags:
  - null
categories:
  - 数据仓库
toc: true
abbrlink: 49066d40
date: 2023-04-14 17:02:13
---

基于在海拍客的工作经历，沉淀了一些关于数据仓库的思考，没有框架，想到什么写什么

# 数据仓库解决什么问题？

1、避免"烟囱式"开发，减少由于业务变化带来的维护成本
烟囱式开发，所有报表都是基于原始数据加工，SQL复杂度高，模型和指标无法复用，大量重复计算逻辑。一但某个业务变化，模型维护成本极高，而且大量的重复计算对资源消耗非常大，极易造成队列阻塞，影响数据产出

2、统一数据指标口径，保证数据一致性：定义一致、计算口径一致、数据源一致
* 中文博大精深，一个简单的中文词经常包含些隐含信息。
  
比如交易金额，当需求方说要取今天的交易额的时候，很多时候说的是今天的成功的交易金额，然而在逻辑角度，交易金额指的的订单表上支付金额+优惠券金额，不进行交易状态的条件过滤。
  
* 鸡同鸭讲，说的是两个人沟通时说的不是同一个东西。
  
比如订单的发货时间，对于财务业务，指的是订单表中的delivery_time字段，表示的是供货商提供的物流订单后第一次抓取到发货状态的时间；对于门店用户角度，指的是物流表中最终发送到用户手上那个订单的物流的发货时间。

3、数据结构清晰，方便数据查找和理解
数仓的分层设计能明晰每张表的作用域和职责，在需要查询使用时，能快速找到要用的表和理解每个字段的含义

# 公司数仓存在什么问题？
* 一张订单宽表打天下，其中包含了订单、交易、退款、物流、门店、供应商等多维度信息，下游以一个个数据烟囱的方式时间使用dw层的明细数据，无法收缩口径，保证数据的一致性。
* 基于onedate理论建设的数仓模型没有长期推广和取代订单宽表，人就有大量新报表从订单宽表获取数据

# 数据仓库模型分层设计方案
## 基于主题域建设

## 



# 好的数据仓库设计评价标准

好的数仓设计标准应该是数据丰富完善、数据复用性强、数据规范性高。以下面的数仓架构为例
![iSq1LE.png](https://i.328888.xyz/2023/04/24/iSq1LE.png)

## 完善度
* dwd层完善度：衡量dwd层的完善度，看ods层被dw/dws/ads/dim层依赖的数量（跨层引用率）。ods层被越多的非dwd层引用，说明越多任务基于原始数据进行开发，各种数据清洗、数据格式化存在重复计算。好的数仓设计一般要求ods层只能被dwd层引用，即跨层引用率为100%。

* dw/dws/ads层完善度：衡量汇总数据的完善度，看仅靠dw/dws/ads层数据就能满足的查询比例（汇总层查询比例）。若汇总层数据无法满足查询要求，则需要从原始数据自行加工计算。汇总层查询比例不可能完全做到100%，但值越高，说明数仓上层模型建设越完善。

## 复用度
* 模型引用系数：⼀个模型被读取，直接产出下游模型的平均数量。若对所有dwd层表（有下游）的模型引用系数取均值，则可衡量dwd层的模型引用系数。系数越大，说明数仓复用度越高。从数据血缘图来看，自下而上一条线的模型设计复用性差，复杂场景下这条线会极其长，而理想的模型设计应是交织的发散型结构
  ![ioZnHZ.png](https://i.328888.xyz/2023/04/24/ioZnHZ.png)
  
## 规范度
* 表分层规范：有多少表不能划属到数仓架构的某一层，一般从表命名前缀体现。

* 表命名规范：⼀个规范的表命名应该包括所属分层、所属主题域、调度周期、全量/增量等信息。

* 字段命名规范：相同字段应在不同表保持一样的命名。同样是用户id，不能在A表叫user_id，在B表却叫u_id.

数仓规范度越高，表名包含的信息越多，在数据地图查找表越方便，也更利于提高模型表复用度。



# 一些博客文章
[如何避免数仓模型“烟囱式”建设](https://blog.51cto.com/u_15259710/2932712)

[数仓常见问题以及解决方案！](https://mp.weixin.qq.com/s/U-avCBgYbwStUDe7e1LsqA)







