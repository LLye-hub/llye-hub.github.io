<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>LLye</title>
  
  
  <link href="https://llye-hub.github.io/atom.xml" rel="self"/>
  
  <link href="https://llye-hub.github.io/"/>
  <updated>2023-05-15T07:30:49.199Z</updated>
  <id>https://llye-hub.github.io/</id>
  
  <author>
    <name>LLye</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>算法性能分析之时间和空间复杂度</title>
    <link href="https://llye-hub.github.io/posts/d1fda56a.html"/>
    <id>https://llye-hub.github.io/posts/d1fda56a.html</id>
    <published>2023-05-12T07:42:59.000Z</published>
    <updated>2023-05-15T07:30:49.199Z</updated>
    
    <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="抱歉，您输入的密码错误，请检查后重新输入。" data-whm="抱歉, 当前文章不能被校验, 不过您还是可以看看解密后的内容。">  <script id="hbeData" type="hbeData" data-hmacdigest="adedc6fbe56421c50601fccd8cdf2135d0d532e9383ab8da9f52a871c9702a3a">0ae7e196f2221a75e5346dcbb7e124f309bb57432bb6150b12771ba5a4f27e5a8ab2c990c81dcbd5a8fee862dbffaea1e778087c92cab991d61972d51cb53bde8d9c2cc95e3c90a228d488f4d6b3474372db9aca3dd91727e9337adedaab956feadfb0ff73f5d8a0b2ecd867562a466df03cca6ff039c8517d1a2fa2c6f6b007fa2e2937c502cacd2bd3225a154adf91037d5c8731de948c45834089978fa7090d8742c2c08d627434323daa89837fa223c5205a07457969077b335597977281ad4a23022cb2924c278b4d4a82691c27594c3f8695d628d77e39a25e67b8a8885465fcf947e4281b80a4f0978a80a67b04b91ce67cf6c2d0614b90c8bc9147a5b6826741d0d46882fd8f0ff322b0e8f6840a754b7c06290b1aff70860e911d3d385461154795ab99aaf8b47160361d2d8fbddf4b397f1ef61588666f544edcd0a8a644848a9e5be7758212a693beecc01947757bbfce4fbf253c8d9a4de5d74ea0281ce7270f22698658fc48224fb5e12f3daad5a4f0667bbbf059f7cca5bf2057a10c30b2fa4fc8b985afc2db95845cc737fbe860a86bc2b23531af2aef30d10b566c1c4e0d836d0675124e8507b2b31f9912f8ab5846827734ca2b0a122bd1747dc06f7248d6b78fd4a4595fa04fb24538a52c3b2aa3c97397f205b0683e61a92dde1b8b7016051748b6b7ab5e01093c48791bb1222520b1439e33c7afd7812e3c856fb2de4b81db5dd335915856a673133f5c2d1d4b29b61ae4ef3505bed89422d5bd19c58487b66c925ff0e93255cf08166559003b130ac6d9f6f728fae6fd0264e0e6b493b8e1f3338036077d213215e4152794b61e00d1ac352212260d8182adf1ff0d0d54120f690d1e6475ce01155460135035faa0059b611733058d77067040cdce327adb6fadd164711de8f0fc9111e80b20bd85931b9b329828cc1857db3909815558893e27337c4890ba5af4aad3298bfe2a42511aefb5013efc3d7c937afc4e504e13e9f40f10dcb6dbfb11641302dc56c3091fd53f2ed0d507797d0b1d530f8ffb36bdf98a43b17515278293c69bdc5a2a3d383bf5feb02d6f9e65709398b14d7e7f81c552205f91e2cabbb38a8e41f924caba37339f150635ad42241ddbf3a991951a3cf157a9a51d8e9bb524ede86003007e1d41f3ab6d12349eb0066992f33c1deff867a90e61e36a381493cba4a05de444c7d825831db58c8b2a76da80c30d9998e0f8b338a52b5ac8872a7db38f671f17c596cd7b0b1217f9858e51b8715b810190ff737075aa39b23ee38024dfe5ebcd55e97fb40931a9143797cb0bf7c1fd5ab73f189b3a0405f1e2eb48a46b6eb835bcbec7845ff54067c9699a5bff54a9abc775879b8af599c259d7c9268628b88d602f64a506d54f9f6fb03f04476ec333d2764601ab0760ea97cb4ba1f0d7ffb8ad9784003a2cf5f79dffdd9f7e63f71d305e144a63822a854f47c9c64f54977542f04da8bfccac04bcc29f3122077316c9191c13441a67657cf3ca2834ec2c7f9f2f1dcec51727530f5ea921de8aeb6ffbf81991247408df6131e0aa3daf4247932172f3fe4a9f70d7fb3fbea1b3ef14425b14eba5269d82e3264c860008c420af593b3ea9b74123160e337b5d04f5f9aa6d0622010aa813e297b27eb4a93cd3d35e53efc2cea8b7f768d887e918110d0bfd970d8eec11dc4d8788e977032e48e7f72bd15fb12836c68ada3d29a5dadb4698d7a1a609794d978dd3dd055e25b68cbeb46a3cf8c0b678a07db9de0fa14670389e59433d92ada642e74c836cb940a1aa069b281bb0408cbbf671abb0bf939a393ce7146c6b5a11884f5da838273db88a0065980679c2d3909cf54490bc59406c9e9cb77f4e18196164ee334c9cf11629c6fc14f59687a526e801284dabdc30eae8938e5c32183d6a965d09c1a25ec80a7a30c6ec112bed7fd6012024a978c4b6b4fcea1f1339dc2885a4b07d6406667a6db5ac258dcc8ecf8cd402b57047daa42fec617fd5bad778ff95eb72d557c590ccb1fb95f01b82a9b701def28ed635f46f81bd39ddd7f90bf95ef224a29fbc2cc7a6e095f66cb2c3c1a8758824ac5772964859457ae4823232afec6392b6285bb41abcd454d262e427cf25d8d91e6f4f235ac283a461dfd5013769493b5652bbd6394bdc6ac4075d06abd1d2601668e9da50844ed1e9ed24a2f7fcc5b2f1c3676e4d4e59ab18af532474992690d504c9bd7ddc011ab45b74f973be481866653977a3d8d76f880afd092107e2d4478e749b5d6e3720248067ab665c6aea7f517c1ab610c0429c1f93cf0f6818065d3dcf9167a407931cb0e37e2d8c4fa4eef4913bab57f2cc38dfb41829bb0f5cc6ba3a59f5294e61e6385d792416ab89bac4afc9a9645b1ecf439250b508fcbd9bbda2ede3309e23655d564503f804c45237090c19cddd9fa214c6cb9f5ef5f7c82846a59523e369290efc119ed1a181b57b355e8f71f06701138fc55fe15cffdf176a0aef21da6ee0b8a8e92736a9e5646ad2c03941f1bd873dfe2a096eb3c0a8d057371151252ae70d11d9413222451c82bd18deea7b397c4a10b3d8fe9c73417ec21526e77c4f098fd24f08cf655f96ff3e2c03ce596559e41855a02310f66dd4bddebfb13d1ab2de5da6727b3ead07bdaa27ffb86bb5ac2aeb1a395e0cf587d2457388b7653c97613b2815026f1db269355ff9ebdd63f7e32d40ad4327f6c361967f5287cfb06576de0597b15a57e1e2682c14cf314e01382c34b645ab7e40d5cfe03ce1829e9dd158e94c440d317a48fef4d4cebc4f12ef9fc5c6ba1aca59e50a8d59b2ceee44924e31149ed29385ea6e55ff837fea832978cdcfd701b34a415eacc0b6449bf8ac69abcda62a83883caa09a0530cbde8028f2ac776f597888c05050daa7f00eb2f57be9c2817b34645f02655e485df31a00dea16e16aef7d9d90a2a819f88fb9876e13c742128d91aeb0bcc2b7be021f41fa3a5c341f92ebd45a1999644f03580d723118b63d4051eb0440bac051a653294c656f891d78febae30527ee215862b08fd83235342a26f388bcf6927e24fbf65944667ad516ac959b7ba7d1b95e33f2b3bd9c8278099c43ccadc276748814c0e37f0956688c64385e921792a842bf0c3a91f03ec2d7f47ee8c580d7fd03cba8de2bac8e83e54d76a401f02855dc4a8e36923b7ead48f2aa06e03d451d0dbfd6da2cb777be4c28e765827c5117d5fb62b492c56f00ac10142c96ec7c3e1c94601755b4da25edba478698e152c02c6899cc17b7704dccf78f7356699b792f2f6e8dd2d957ad2bba7c0f08cfd16a0ef413a950e108780dc3d9b747dfaa7500503603e8ac989fefa256e7354b4b6d5c4c07c4a3c67390411246ce618aecf2e9ef7e1c315e517119483a9d3fe01eb42bce3c6daccdee792e90a84457428fe28f3a74126df7238ec791441a55a35753d5f07b6db95f872dd86a9562617a5848d65ba6d03ed51ca4cb995b88a11a5d744cd3eaefba280c44cc407c76385c80b2a25dbd3b6883dbe0a75412c92490e7788466499a381af52477b72af838101025eb5b284b8ef14995cae87fbe7e8832a6e392e9c22f0ff9b9b316237455e5e4e320a305e6fb6e579c1d456fdb5d0a4fc91d763fa92b0c84559275e60a6195f03e50069ba9bb60442f311f05c3287fd35cf9fa3cd725e0e2aacd7cf2dce202c52a153fa53f00ae759a2b183f47d3b541427c3f0415e70f8ba4aa2480ae31e1729cc1d0ec9a53baf71965da9955327a18d02d32a10119f0fa0667000d75f60bb19830ed8c6a25c0f1007947a01dff5a7eee079ff145e2eed2e7676be7c3abb312df2c672d6dc1c8152a90edbf2ebdf9aa472b750482e8050dccd7f0dea0c0bd6bf1987cc33393419f8bdc4520ee1c79787ed548c802fa0ec0f032e3dffdbfcc1cff77e8769a5d2354126f892ad49d1d626a632ea852115a4203f3705e6c5627f7c0ddb7c01bf33440b64e4004f62ff11cc18104117f9df869f8c36c44f70052c17eca09dc3052622b7307f8518c87873035e1edfeece2b645a19bbdb83bea7bfe1525fbc3f6c726f62ec33713f16dd78f7c3ceb35ce5ecc6093e76532f6661fee29642b045a4b189c2ddcd6df37efc693b1210fc0ae1573a396d10a93a038129125d71dc5d16ff4f8faafdb76fcb12446d86843ccb61ddcae8630deaf734c93af519df34da89918830b10fccc99ed83dc9f562270accffbf60a7d0e74631104de174720ccbbb9a00a7ef4643257b028b3b9a2044a9b03d72b143795ed5e36941e79632c7d8852b08a9901207cff3c4c45b4795b16ab85af7fe97cc80e0c28e8ed0a4d947ee5db59ff7bed513c8ab8c47ac0a06f7bc2c20cbf666e05a76e7c0afb7b9e772ebda54b87d6eebf21c6e7cdf4428cc2efa34b268810a360a25595954436acf0ce6b450d95e88731a0207b5a48e88feed4b1a73d922ce7d0747beb8da40f1d0f338a932911d487ffde958e3ecb927059135d8f6f5ae38dbc9a093a789bbee158112a8661a7a482546269e0bfff16f6d0681f3462c482f8ae09f80bf9094696b70d7d5d7b48267b91ebe87d7fdcf291124bf072b180462d87230cb9a0b0fb2175500578e5217e2fa2a4ff5cb9002059b34b92a6f250281988a0174cdc5c0cd6be34f601e31c2b4bbc137ac9f1c125ad7376314bc2dc844bb9b8ee0ad70c7ae4fb4db0c766dba2e11bcd25c87f5daffbb5b4717c8eddab182dcf64cbf8a1f5e77c1e42ebabe6c1a0020a0ee04fa8ae88d41b0d255d37d5f6a6eebf0c5ec53afe76323c45fe44b53cc0d5468f031cf729bc513515319b3538c77be30c22c1b1538aafb82dbfe35f8b4719fcccffa2a9cb445da7d8cf533a4ed57eddb0934c643751552a16d0e5f3625d7cf6e64ff0b12489baa84135bfb6d410d941df5d9d51b8a76bfcf26db75fc6e55678e288f76235d60c65b8849431ab0eea1e3adc64f9b0a64ad1cb92978aba3f12cc99b33ceb685476c36cc00a356178e4e95c0fc4afb2f0c3b3dcd8aa4fb1ec68969eb8dcbf6ba5950a07e09ff3b2e9481c9d1e8c68812f87093a0663dd055439895c7f5bc77b8e5d4ce2dbb6d2cc3d630de9cea44a44557414a6ad2a26ca61af1ace45dde8c1b6cf34780d9c39ae1db363fc8e6568ac11f2f99103f28edf97d05d6b33b0565d1275bbcf83c7d2325bf08bc6cd954922fedd4a80fc53be0fb160de9dd1a685b2aab2d69adde3e6990a02a5c1bdd7b2d1025b662cca182e86bf1b010cd900ff7cb0f1442609e8caa99fa88f178a45e5283f845be4bba211bbdfe95798b622190399a566def1b998e122d0e480f6d4338b12acf09c5639b4ead2cde238cc4d5db9215c90c985f6be56171d39f536149560025a3f57075644e1757b07573a0299a5cd65505e2160c861e5f795fd7553c1192a5b4fea45137120ee58356bba35641c2aa6c78d8384e0307d895db43211d33d476eed717c9a1b7ea1fff8afc9ef577c7469513069a01a196bf87657b3a1432fd8a716b4f1843dcbd1eda67cbcb362c36bb970ee7e7ff74c608e7fe467900a0e46143a90de57ff1967765e6e87422786a3d2a6485e01ba979ec94b439acf5645123fe52d8ef2afe6d1ce79cecd160e6b5f3a71764317ee210ffa194e0b74706bef727259b072664e0da1f74dd4d632c918c1631c459c3cfca2948c74a998ec2dd3537bd89f3d685c1244878e6f0b7bb2cfdd260d8f9fffd6b36756ed33e368f71a8bcfd934bf48571ddb9d2d7da2019a2e6fe246faab89f0fab16741fed320bb68f606a9340a706db1c769bb3772640e96a6ba0cfbcb5278b6bba8b5836d3769e50a97224b2e9c30b132a42b1766a5165aa2be4dc575e4ab503e45de7d3dae76fe98111cb991dfe6ddb2d32dda77e54e9d6e3efc1daea104876dfae0e1b9129937819eecd649d2bc9e257a480be7717d4917a371ab9e6311ad4794792536a8aa38a203363642247e55b34b2f556ce89a24f70a3b49a630dcc1d4a5dfe248177c537d8441b240e41f695003964f80a5cff707538e4ed39d912a74e0e3e97022bb75b1ac30069d8b2d23cec3624251361becf34c07f9f753286fb8519e1894c545b0ccff44a325f469669c7349a2a5f3798d0b31df8ffb0482a5f65f7da15275348752e1a718ab92432f545e76fa7f319f50d9faf9c79eb1d45f18801b5c3da965b6b018ffef3c328ae1f012c13d29615b1d15b07e4840db0d480a327c58f58af8b96ce44ae539b272dcf6fac1787e014033dc58ccf585a48e0a45fab43f75d5c6eea8a0d3447d7189961ea83ed43848ed0a8e4c8fd8b8d61a09c1381abea8a303305c35d97948b12613863dc393cd461aeb5c392fd29c140ff413b142540cb79bd69bf7fc7c655c528d2297664fa72b62c14e2aeba06b7d5992ccf52756b64ad93c3df3fc682730553cfaf02a5ec8ea0df9dad52955d4b72763d559b1c6c189de13c2e6c61d179415970a518e2ab150d9b0a53b94aedf0f0c67f0c2bec6c68ba6a9263ecbd5794ca6467d7b41b870d631796d21362656f6cfe27b295210fbcb517548b2622f1865b497407a42d6596b50005a56a8fd7e48e0eb6d1148ee8201144f3d6bcedfa464bac06d48f2dece3e90e4c5010f23506a48280084e9c9feabd9bbb3aaba4ea030d4b9c3fc2ffef82efc460d2a2b6ef04d6ae70f83ae874fec0ed3fc450a77acc2c0ee74d068b29b7b9a82ad844eab08b9e72d5acd684db4362f593235913b8e5186a07c7de4bc37600394951a19185b7e4af02261c70357fd9309e9e6a81c0a0a429e07595a07bd1f5db2f829df2c1fb54a5c35e2131d697ff675238bd0a41919820102cd164d9a84547c70f17b994a86e8df2425c4c29804fbe3198718a4ac88749fba95c8fa7174ef62369ee465862df64e8013ef2e3cab4db22286976008c16dcbd0824a15eaa9a79caf278ea052c297c671d776d89f3529065a4decdeda7ac3bf22c6beb83c42efb401f6107ede558db2e161b051acd2903483679d7a04ac66809f92fb5f3a6a5347a86ca4fa8cfb20dab20e85296e9115697c9039e828e93be1b0d97148f58a045f8ab1e9789b11d6698335f66012ee0288ee09fd4e2d8f0a5d2175098663322742acc19b9206a252dc5f4fb837f7ef3eba6373c1d362deb5b5e76a582d5ac32000ccfff6b6cfadafa6e363e80b592180c1eba49a9693098a8143fc1e25a939594bbe8243a5d9a87a72524126e817f7cfd9a8eb6d4459f6ecfc3d1751e03a1be496a76a2de6b4f227863afb4afa8ceddf69aa0b63832e4bff27d250e3e14ba96517f58b4eb785333982bc6cc516a08714989abc628c79e5445168343f32ab140a5a0c0ee391d9784fcc5930b52e87127bcec888204d52f7cd4c02047a6129631055494602dd8d56cd68fb5e1b38be087e702883d5d1350208e942627423ecea34d829aeef6ed78bb3cd8a35b1b462b514c67e94b10b60c09588ee1661b26c35cd71c2791ce68d3b09c2dc86a7f6fa15838bbecf07fc2a09f044c6402b936cff9e5b30deb479f11fb2cdfa9572de25d27331ed26fa9c74aea85a5f8984db2fbe02749557317de3d4a95da82dd19f3627128fc095a377f35fcc540ef8728baeab40c9d74d11f7ab0bd8bc8e789e32bcd8cdedc7a51841f9167487eb674ba70a3ad7f9badcedddc14e0ca1fe1314b0065658ec6d69e2ddbb834e374c355edf8d85b0d45f14b5fe4512398fcf7c451be602644279d3aa4864bf0029676bed22e789806a6453157d3e2dcee6f4b66dcd381f3eb20dcf0ae0f519a217fe65ea66f1b99e92a914710359f2da4f6a5de65411476fe73acfe1afe5b1d3578342e7b8ded09c8a7b9459150d4c040d33cd2123ca89fc20315942310eb376272896490c1c34cc216a4f28104ff39c367ad4c9d4808bd681002b2153e722116172f429f2c8a935ac6c6dc5883d86e6c3b83f69ef40156d35077999b21c9a3bfd65cdb66ced61a6ea742d17ffaea71e61d3d168e69ddd5b615381044e31b8a640a795d3b0ef91dc48321c65cad602fb1a3d271ec2972753cb51200ae15f0b399a882e9936ffcda8e35aafc53cafe44b26626af77f5daf691b0f66d68d4547b39baea41311ea67c3a1bf56124b5377678c3a46dfb054b735fc1d85b06aafe0a4c2f094c8184e128d229c2ab3217f518ec714fc198d9cc071f6cc3f18d37ee2aa926bd9409cbc45c75e99d36076f058c2114ade6867eb2b8d8ad53f47a6f736b72cdbbb76e8195d1fad43b0a37a052fb09b91fe4adbcd27e04bf36b12ba2f0f3759afb5484544967431609baaba9a140a995c02654bbf5035f9718f96552f07cefe4efa3927f65b18dbfe6693ac9d67b09a231ad395e3aedf1f1057bab2e0f9a31b25908b60ea7a84b6637af6e160cc5b82043f0fc65978aae0d04cc25602e4f4f86c6835ebb0cf77316c86def7e7f36738a13bc0e7736afad25f99f6e54dbdb90ecc4447081afa8593a140986dd1d09a0a3f5858aa7bd0999a767fcc425816fd24cec54a3c5f7960d2f1e81f5827b17fc9a43b11ce129617136d090c3b6bf7b15ebc7b158f4acb50c10d5290fd619399d08f217524569949091e09076c858593a6003113887cefec14b2a16d3b0262faaf0bc743886eaeba1150a37faf25ea1927e379d4fb98e51c0361edd0eb455a8f8e982718cc73699ba2b0f27268512763d25f31f0370af0bc79b7a421085681ef638b022fbbe0501ec5df8dfa8f21a6fbbbb7c6535c030a995b04f68cc92bf6f371838fb45e0de3b4bda4b74d3b81d2266ffdbe4a1eabd4654651c5c5973328524f3744e69ddb164799ac2d6d82d7680597cc67f4cec990210e54e15f87fdd4e3e8c83d54bd3637c25bd0f7cea225bd7bd647ab38905a80aeb653620b317cedd581f5cfe205ad8a3ccaa8a6b6004245e69efaa7110a2da8de8270a6ae489a3ae9af45617d55362f38f210b6676de4fb1448617dc2c01b2729c4dbb6dd41ed8256d87d6cc0c5be5bf4f5e64e777a11704d75e0602282b0b3acab007161e76cf04edcdea0c5844be3e8548af398b9e225a95e44cceb8d302f4d026e1268243b4a0415b89588ada4a3dc5c9a29b54f9c0a0ca2d48ae522e385554adb34aa5a5106b2d5009fdf35919940910c6bbcc3e4a3045ec4d4ec46f52c17e832bb88900cbd4dc372dcc1aceb6b162b7532b6a5888ec300ea651a25fb68d22a2254ebbb9e73bb86218cbbe76ad02932cf4877d825dc25baeb636f79d0db72d2970a7d3fa1d9292fe528bc2aa2b4bb42fb4aa4f166a1c4f627bec4219e1f254d74fc998e68f5deb0368191c01dc824152b9809342ea212a3028951e4271acc99008e1c20d7c83312095a2b0cead54585e20350191b4a61cb02fcb376f2ddc2b137b12d6c31a4dc9b9bc05eba53727ec255640e79093e1ad6e0ab7f7d9c6c6871912c3c3be43ca33082533de283b452c7f96fe98fa0efc70577773e78ac17ace920ae5f96c57d04e0ae1f0d00bbbed39472f95baf6ec080eb2d10c873521843fcbd5a9df9cd41dbba272b0b2f1cc418c40a5b6d788ce0ebc37a06e00fcf47307e48d02969382f510e83360627aa435d5c5c8de72d9d33f95a8639d6defc8aa161e1515cf4b684873ee9b62a72fa4295324eaf0223730dca6f515b06b50f23177484a2f0563f9cb5bc67fe652f957511926b2afc0934c1a8b6de38307bfbdd37dcb88b87b958849c4fa7e3ebc97a5c96c4c29956222c96f11850a464b786c978fb58ff3ba47fe68dd3a28ae116cc03cc2d127f5af87b0c84fa0315e8e5d14adc15d8caccdab78bf3d0e35364a038eb328a83e2c1ead7eb6b5d56e8aac38907e449d731dfe791ad9114c7acd4801f137a97d69063c36bf14b69511e9d5cda767849bfe56c2e8a44709e2dce3327bd3c5202432c38bbd0e41ebc0f090e323575724c374d32bb433f675942ef1918d9562075a667e596ee9fbe11020af29bfe839d6037f9d2f8a158e242dcfd70a9c795bd353055567ef1cf4bccd3dec55662fbd1f394f52ab4dcf20008c29a7c5d8f229f7eea8558975370261d8b36c790ba0c60c763f41f6bc6dde035dd606067ac4483b09cc2ec4885b911e9271abc650aa76878b9d178900cacadad79ab6e8b62c2946817531c6f51b01fb9ab0d50de88fe17422ab0a9173e4df4b05607aa99bc385f2c1db633ff81bde6c328ab5a2588afaedd4a91478ead09fabaa4d7e59de0552291832f6c6cec691f9dae022203bc8a6a1cf8aa872d66980e30398ca1af66c314b37ddf6a7fe393e14aa622ffae9da1c64433bb296e3ed0666845e8d16de7e07510eac32a006111bc45f917b4af861c57a8cb4558006bd44789021039e3147e845b8286701ed8d69f185c83c0573c4bc162a55a5ee77a2c85909ef930261213913dc6594511e18dcc30276e8b5e633cd4d8586c47a0bf853f23ec8447d2c73549d9ca147f29fdb8dd642b5470d3aa2f38f1f3c4ffe8d3e3524b1a89c09485a01d3940651ef147c1eddd291627fc984ba4ec26dafc154cfea12f54cfb5ff3dd7ac733666c72cbb667d1a0b9b3c41c04eebd5c6e01b4a407eb9093553114c48e1200ab7633c6a6dc1a2bb3975a00aca4090d11cec592521ef76f63be713eeaa7ae8f875ace469d744b0ef06e9aa9993c67a7fdbee6ae718125ec12d9f4caef99b4eb86c5ac817eac632fa6e7e8c4c723702713e24b4c401cd351487cc69d15cff7cc3097bc31881f8ce79e9a9683c9a87f2446ca47e20dd3f127f16ad1f5039eeacf346431343008958817dbd603674db8d7e7ed464cf5f37479450f6aaae2e3f0ce679ce446b5f3a97130a3d2870aa42b12c236c4e283cc013aa8ca8e368d0287931096e3c2cbfcaf014cd7c45ced8fe96283ce815bae8bd5d32d4ab7d68f400877e89af221915cc3ac0e13e821400abeb907ddaf217100384bfe993ea2d6d98efff5c086dacbb4f1741fbcf13b6600f14b49bcc3a2abfb911a2fd4a96a8c2cf7dc16154c4c5a8c8aa50c02bb78410bf63163a902dbf648cdc0892695ade21fa25459822157a6d8baf8386609c12fb15cc3313d11ee636b7830264c80177d712b3c782ab7695f574c79a9dcf24b305173c1a1bbb84b586a5f0e4bcc1b7e5c78e5dfc945389148795709117e7abec564a38d3d474aa33eda904d88a778d99d13d26ef5c2e3131ac6aa89450282b76aef0e2a9394481af0653dc8465520f4d03104657474a9b0ba2805849d74b1893ba24a92870ec36b17733bad659fc2227a2dba35c8f15cb3d9146a2b29bd1848c8c400133471e777057d9a79f443104ba39ab89db90ca00c2999fb9f3b69082e72cc6ff353bf4b97ef5f15e1b5e260bbf480f07043dd9135acf412b57f4aba317a8b396e2769e3c357ce6a2a3968493720459f11ffe5741e798c9e51e2a255af7497c370f2b16ac7086caa7c099cbef6eb7baa02334c7d5eea1a3a68e89563a86564a05f293208dc242ce0cf269d109fd8ed3a5b6b683665f1ce064b338521d9e68ff2122dc72be211a70ef9718a46475ceecc1534656348cd95d94606514077c110a51140437e90b33cc3cf96fe542e3279d28a263bbc951e6412499384443a1d40048d10d216de787c2c3354d29411dbc44fe6f1593231de2366a4b6c8a1ee401ba297218153b7e6482365ef73d7d682b2b67cb5b6d1897e7be84376f8a175af13300bd5c7633cf9824224a3fe7beac40c85e199b7ecb01a34210496cf3a6ebf54b839e0f750a69d6d04a02a75910dee71744b3c8704f0bd238dcb23a709f249abaafbdd564354077462d8fc31917d01edcac4efa23ea23770a7483883900066468bf93a63b3074a46a8d3dc5e250a11f7ee3ca5cfad45b8f74191189acd51e11867bbbe074b609f6139f7b03d04277eb026e2e4fee0a8c0bdfefb8b9279b174f98ecab5bcf2330a6984e17f02c96ab1cd3bfc8357724e22e2d5fb8a99a8224441f526dc581231e546912414eda9a3655ae8392a258067ddff24942db8bf7b5c5781d2e5d3a746e3fda5e8f5a40ad20c80175357044a62938e9d2074b789fcbe63758d5d85eff9a704beaac91065cd597606bb22ad0a3083c36bb71bdbf1e5c17c98cfae6dfe17498d74bc9343ce6b3229181da62d4af953b28247eb9f074c68443f7fc7bed023b08cebf412312d8ee69a018713a19eed203202249a630e213e39b813d9b306bc21950392a63770894783e50a1c373cfa12f16660b34c3d946c818e9a8d6486aa8d20936ac947f29e0e43a26ecbcceb4c57116bebdc53f6242a3e7b1b647176fb5b1e49a9ec84dddaf2c0089e2da515262460fdb72cc47c4e06ce6cabf09300762423716b7f1dbd9389c65798c3322973c60966f64186b583f6a72fe29c36be5475d203f56ea5bdc139463dcb2178045e474eae53be8e8a4f34872d89d949125b5f95d14a13273dfc11504096abdcbea4c3014c44c58d15870c5eb60db77960db792e2f636c657ecbe469fbc2113044e0e62a04418a9adb4bbe74f924eb2e3b3a939e1bec6f934797dcb3fcffdf9a1a16f7b989a3e5f4940c7bd2a0bea15fd561e636bd27aef59b30f73a8f5a96c63c321604dd4e42695eeadb014e2dd7560238a8f1b4aa2398a35f0872de9af85a07e28a762c976352b8f2bf21265a2d3f9485dc7012fe8c644f036b5b749d0ae7c04c481258851b9cb57c339009e9b0868ab1417cba5e06e109738e887c3936604535bcfd9c768030b5b512933b910f7957730cd3a18e10aabb052556b2a29e035d8f364fb95f3a3551441d36d989b29dbdc952bb36e61c2c0dc48f547cf97dfea3b2cb98766dee9096829524bec716ca86402d2953c4acbbcdc3f43a8335b7224167b9e0cf521d40da0a09efa462e3e59d7e9f2c8dbcb18f409e7a2b32ec26874e92fb9688593fa1ef3f3dcf44d6246bbb5a81ba0093d96fe71e15e55bce4f9602d90e51542b7d4aaba141abd86c8954634feb7fd191f3dc1be1d2f44bffa42ce5b0e2076ddca236e5bad5226b8efe12a8ba17efdf7c9221bfc05ce0f0c6b594e4e7b7cf5bfb20c0630173edbd51f0e03c5258ac21bf41b1ea4389adf943231d5132be4942d8deb8331c5238a16d1bb5433d0d8f70b5a7bdc443d73250ffd4c97ab4ebeaa2bcf6cd16175e15bc300b9a07e0731c2b4fc5d0dd69b1b8a248bfda64b2c1b1a49be711ccecef0756b6f722d5f8674f009ce5cf12b695cd05a21855bfda312f46e80dcfc8f95887147dd8d55b9156f9a462bf7d36d627ddcf47c56e782074afdb7f978d20aa98aa48bfff9f9c06b0d762d11157382c9276dec7a1ad3ae4858bdf50b43f419fe7c3b6ba68422879fb8bfd59f84cf22600901f9868b5b7a76c45f9239b0be3a9a6c8752916f438b7b3c320ce3486259efee8a712a2c8e19f3c1525cfbd38d8a4fb9b6d5e9c3d4e77feda7e5ba5f82a306d6ae496175522b2120ff6859d707e43c78bfb4256e5f2af8be3464d962f67c2ca6895fd17432636a5c47f61e53a6076ec1989cc4179c7f0e71ae0e3f0a2338856c78e73b96086e5ef439fc20f3dced6287f5b62f25fd7689f23959c90188c86794a139c7385afce34dbcefe9b3f2ce60343807779b9bfc88657720b64f2d6f157a12dddba9d85d57140878102b33d24cbb7b0a50277532eaf8c85a6907c3939891648989a9740d1ba0120d248813f8b0cfb6193ffd2ae4f0795c742103aed0c20ea7fd74d2d5221468c80a8a69916f2f78249f9c3fb0fd6b734610a1bebb5f341c8d538c8a71ec8ff50d38b88243d72af3f0b23a71d54c218ad4edabaa48c2ec651c8a624ffdc8a06c3b83cb040470a41778aa4e5333d4519dd1a2344cdb014044956f91ae31a09e517dae00b65959b1f9655a715021504a71322d3c914258c250a47f9d6acfe3c40efea31769b5cdf8a415289b28d2e2e7df3ebd7e70cc79fcf4068b40f13e6918e207d77f5b5291f458a7bbac6a84e45e537757b75d2e9970f1556a2c6c2dfa488ee27bad310e9db3f0194c80d007ecfb3fe7876fa617114480e9322c1b45915aec00a6c0edab1caf7568b65e949faa0400e69f153e3589f383289b9be18d0377c4b96fb763847316493ee8b58c0faded0a226c6922501fa40003b7f84067311c25acde550cc0aa9943036c706c76bd366e7ed9a973661502cd5702ca2373cd900e812ae31df94db3c2d336330bbd24b4d0cc750ed5eac6ee025c6358f0cb7f644e1c132a7533e8c2f5e4d2538349c1922113cc0f5d48cfbe54836abf26eb65a070cd52b6006263e0f104e318d042a82ce9c6e3d21ccb49c485a0904b963f89e143775411d7a809b60df1e370af0fc2dfb47030cbe416c316ca6560020a4e4fb9368d79cf819e988ce2d18ba6b80314994609881171e7fc08e4f2504319798be3cfe465c4c154b0af0b5eb8fba76081044ef834000b78149ca0b69801411d50ff13bdce027040a9b1558817f38cb6819292a91ab1893d1116f1f81291159d774a447145070691ab29243312aacd3da9efa8000441c2b202d0a4680673f11cceb9f5fc2b07db6ea3be1db43a5cdb7c772cb41b25cdf6b98f429d673097552818f622f585fb1ededfdd197de46b44cd3be6a0153b6e4084a5f8958866e56e35abee4ee5acdc6a9f67385bdd5a6ce15615ef008a482a29f4011f4d0ba7b76c4ac5fdff06db2e622d8a23c6ade0cd42a8fa5fc2e9e157bf18ae3cba12e28f1e108c723075e548c09d88ce3813dfdf0a02702780350a5274340e524e72166dd632293dd256a468dde1c970a6403ba91ed97c4557f241f183da7144cad1b01afd9a9e5278e1c502fba58254699b9d2f1df00fa4dae17774acf1a5cd3839d51d3ebd64a1ec8152638f63f2a02ed0195369f9cc4edabdfb511ceb1357b06ffe068b575f681459fc6b33d19e28250230a65dd7a0a08ddfbef726658fc50c390eaa40edd80daca7f5c9003c00226ed125a1ecd781f7968670567dab24986f04d20c5b7d8a10e6b672e523353346623a5c35dc4994b338a2636f0eff45d86fcefbbd0504dd6642c0ef75217f01c0056481e84da81bdbd89ded79639ef7362cf7f6d3e0d6f38d11230112333f041c8ad8b37691e4abd4d3a5e41391234713689ddb7821a2fa9f1211e16ff502d22e4cbd19b007785196b7016de1e31d2bdf61c302d8fbccc364cb1f376820abbb049f0d437d3287aa8b5226ae4485f4fdf5db1ddf69c3c11b7031646751fcd6f0c8a01c11ae299549748a98fe550c542690a2954d05dc1ddf229bd21de29338c1a2d75c74747a011d38fa2774ebb77142dbe8e1229c4e9dfc4ceef68d16442da08d408ce0c23cdd75dfdd4da569f1998bd4353ea00187158d77b41730882a19d24e4fca6e77b7f050d87af19809bc190f5ad0ebcfa5992dfcf5b0842590c8a6f8041044cc0291676295cf9fd4f6c9ce298cebb2aca93c42aacd82503f9d3d9ea1209b572b930da5c2d1d336cf084e1b9441278f8c2ee88f2193c6ea4aeeb15ddcd0031fa9173f6096f749feb6648cb4d6f15d9248b8d8731c4597e049f9551adf04e66024a56bb1c465f39f9844d03ff7bca4e5c1b9184d3602bb002db6c4bcadaac2016d9eba23f3f6b12f09e595ff348943c412cb644a23a255ffe54d2bd57d1081bb4618397e05fd3b588388fc4e555c6493bfa6a24404e5fd95399d348ba12cc5253981f09c37dfd1dcbe1d8105de23629f02499bf4cef5d96deed03d2e20331bff5c186eb3df999e7a630c58f8c9f50f3ccc241a742b9fe941babd7e2fd9e4aa74c664725f2811844335bddafd1c7ebb52c17e44f56ec7ceeea0f93a444bee6e79ed64546387555cd6e83903e0749bab52ef62bea330046f62b63b855108d142ddfe20783ea664052adff4c353f54acc5bcebe5ade1dde6b1f03856c2005abddaccd08a4f0fca914ff641708294dad06887c0d0505511cdcb4a6431f2bc46de9d296d97fa6def46bbef9b6fd8e8dfca6d3333b8d7e76c8a892885fd1fc214b9b7e44486f3eeb9d8d358b5acb4336aa89ef3ac0487676d0af0413a1fd1228ae2216681c010c7f3ceb89655352e2ea7feff6fdb651f5bf0fb6d62fc590bdd89c4bc1f844cee6ae72f6da3f73d3f47c2fd913188a34e8832be2e135e9d182f7969161879b679966f90b837ebd41fdbfdf4e5cc21108622d14234e8eb98e393f54c4a627ff3636aa30ddc1714f0f4ffc6a5060b0fd3ee6d6e6cba9e6d6ad0735982dbd5e0af420de3a9de97ff929ed857b6cc4c77c0f7a519a5bb6191d276dcf56a8c1aa49143ddf298998dcb688dafe6731312100c7969318f35e66c5d7e4845e1305effe1111f67813034fc7b6b69c6223a04f3bcf92f3f9df6d07dcf40dcf4f8e2a9ba7e1c95ab7ad30be0df83fefcdf68fe5d5b7e79d4a1726c7b89386cf2cf0c4250457a062fd19d1731ad140587f6ddc7a43b27673ac76cb5c64f5c184d4beae4cdf58e42a6eab1870a0cf0596dfae1d41b437b81e1ac0c9bc66f9dbc4b9d9ba9718867b14fd5bfc402d4fc1a715a175105b82657674a9a8108dbf7dc7dd6a08357a06ad3c760e5499c4506afebda84b3950e376404860909d39e49f11d0f22324648e5c8e86b0bc3b264e3b2bf8da446401366135e8d9fe8dba817c9467747b40ad6bd3d4d0993accb05bb78f025c341e6c1d0d6b3afdaa814164710eb3ff8c7d21111234871a8fe9b3edd7601d9d28dce5b188ad4475f454f988e67656674d1e17b980c24024a4b6b4ebb43be939b4aa4375a585186eb49eb8c2db932f91d0f79be273320bdd27fdad99310213d906991899df27651794047113e0ac8aded5a1d9d40f04c87f64817737a60992d877ca68390d576fc027a5b13359b42588531b81c3475aac978b30f4920cc3b9082c699b3c237464f45277c99b47477c2841e929e4573282ae1578993127a1687a7464f96062afcea19e9b4c83d8a0f81a4f93bde20fae1c0e703996f064e9a169d8d3584ef0176c4198e4bd05223f1bab646f6a348fcf182c7a142a82b63458a5c8700bbf07de36c774a014d947bb4e838d3e4d755a0f020bf239edc5ae62ee062e03b2df3a9be4df53bd0da5da0be79d2897a15ebe5763664468c0a09b48f09fefaa5fa548da3077bdda02de7f6a204cf2658624a6b1171983e38474fb271f79e12f853ba041fd0d31c8dafcc036cd1df1b350a6c5183a66c3557f969e2e93a4f22194c7f25d636c54f152cb334081effce9a42625d55b4c9a7e13d8362d52583307c3f3cf0d47c0cca3b867fe844a4345154d0c137f2daf11356c3e070c547b934b7e2c886539b4fddec900bfaf1e70adb338e21fec03d62d88586a83c0e9fbf50ba0d07f0c207d3f7c4981c200101d22c081b3901e1b28040a2c98e3486adda64fba0d23bf9c03d1f1ee68ec6de7e19a64e2c6db97de6a4ccec8b62cdde10147bc8efabb7257b9a30546b93dcbb53449ff53165786a3c6f10167bee0ed992797eee5938065f04814f13f5e7efb7720186ce02412efaefa8a4835b797626c4a6ac79f4ea78037594ac90d492a6197bc013e73769af01322478dcf05660808066129fd8577b28d90357b5417a94ca93c08e06b4e5122cbfbb2fcfbed5ba9d91be7aafb79881b65db7ead95cbd156160cc6805325847e6282cacbdbc6f5e95d3c1eb1d50d28bb3e38f08abdffda4549390f4b3d4eb0ba184c7600dc33c020d01d194b8bdd8c278034b934269f7877d319c8</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-default">      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-default">当前文章暂不对外可见，请输入密码后查看！</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
    
    
    <summary type="html">这是一篇加密文章，需要密码才能继续阅读。</summary>
    
    
    
    <category term="题集" scheme="https://llye-hub.github.io/categories/%E9%A2%98%E9%9B%86/"/>
    
    
    <category term="private" scheme="https://llye-hub.github.io/tags/private/"/>
    
  </entry>
  
  <entry>
    <title>hexo+GitHub自建博客遇到的问题</title>
    <link href="https://llye-hub.github.io/posts/69a95f3b.html"/>
    <id>https://llye-hub.github.io/posts/69a95f3b.html</id>
    <published>2023-05-08T06:48:01.000Z</published>
    <updated>2023-05-08T06:49:22.520Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://blog.csdn.net/weixin_45149481/article/details/116794535">hexo文章目录点击不跳转，html没有生成href</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;a href=&quot;https://blog.csdn.net/weixin_45149481/article/details/116794535&quot;&gt;hexo文章目录点击不跳转，html没有生成href&lt;/a&gt;&lt;/p&gt;
</summary>
      
    
    
    
    
    <category term="hexo" scheme="https://llye-hub.github.io/tags/hexo/"/>
    
  </entry>
  
  <entry>
    <title>hiveSQL之理解explain参数</title>
    <link href="https://llye-hub.github.io/posts/2369b6cf.html"/>
    <id>https://llye-hub.github.io/posts/2369b6cf.html</id>
    <published>2023-05-08T03:16:49.000Z</published>
    <updated>2023-05-08T08:27:00.383Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual+Explain">hive官方文档说明</a></p><p><strong>关键字</strong> <code>EXPLAIN</code></p><p><strong>语法：</strong> <code>EXPLAIN [EXTENDED|DEPENDENCY|AUTHORIZATION|VECTORIZATION|ANALYZE] query</code>（<code>hive2.3.9</code>版本支持）  </p><ul><li>EXPLAIN EXTENDED是EXPLAIN的扩展，能展示更加详细的信息。除了EXPLAIN打印出的内容，还包括每个标的HDFS读取路径，每个HIVE表的配置信息等，可以查看出表是否被全表扫描。</li><li>EXPLAIN DEPENDENCY用于描述一段sql需要的数据来源，输出的是一个json格式的数据，里面包含一下两个部分的内容，<br>input_partitions：描述一段sql依赖的数据来源表分区，里面存储的分区名的列表，格式如下：<br>{“partitionname”:“库名@表名 @分区列&#x3D;分区列的值”} ，如果整段sql包含的所有表都是是非分区表，则显示为空。<br>input_table：描述一段sql依赖的数据来源表，里面存储的是HIVE表名的列表格式如下：<br>{“tablename”:“库名@表名 ”，“tabletype”：表的类型（外部表&#x2F;内部表）}</li><li>EXPLAIN ANALYZE是EXPLAIN的扩展。EXPLAIN的信息中标示的是预估扫描行数，EXPLAIN ANALYZE但展示信息中也标示了实际扫描行数，格式为：<code>Num rows: (estimated row count)/(actual row count)</code></li></ul><p>**执行计划包含三部分内容: **</p><ul><li>查询sql的抽象语法树</li><li>所有stage之间的依赖关系</li><li>每个stage的具体描述</li></ul><p><strong>参数解释</strong></p><ul><li><p>MapReduce: 表示当前任务执行所用的计算机引擎是MapReduce  </p></li><li><p>Map Operator Tree: 表示当前描述的Map阶段执行的操作信息。</p><ul><li>TableScan: 表示对关键字alias声明的结果集。这里代指表明。</li><li>Statistics: 表示对当前阶段的统计信息。例如数据行数和数据量，这两个都是预估值。</li><li>Filter Operator: 表示在之前操作（TableScan）的结果集上进行数据的过滤。</li><li>Predicate: 表示Filter Operator进行过滤时候使用的谓词，例如 pt_dt &#x3D; 2020-11-11</li><li>Select Operator: 表示在之前的结果集上对列进行投影，即列筛选。<ul><li>Expressions: 表示需要投影的列，即筛选的列。</li><li>OutputColNames: 表示输出的列名。</li><li>Group By Operator: 表示在之前的结果集上分组聚合。<ul><li>keys: 表示分组的列。</li><li>mode[aggregations]: 表示分组聚合使用的算法.例如 count（）。</li><li>Reduce Output Operator: 表示当前描述的是对之前的结果聚合后的输出信息，这里表示Map端聚合后的信息。<ul><li>key expressions&#x2F;value expressions: MapReduce计算引擎，在Map阶段和Reduce阶段输出的都是键-值对的形式，这里key expression和 key expression 和 value expression 分别描述的就是Map阶段输出的键（key） 和值（value）所用的数据列。key expression指代的就是聚合列。 value expression 指代的就是 聚合的函数。</li><li>sort order：表示输出是否进行排序，每个<code>+</code>表示正序排序的一列，每个<code>-</code>表示倒序排序的一列。</li><li>Map-Reduce partition columns: 表示Map阶段输出到Reduce阶段的分区列。在HIVE-SQL中可以用distribute by 指代分区的列。</li></ul></li></ul></li></ul></li></ul></li><li><p>Reduce Operator Tree: 表示当前描述的Reduce阶段执行的操作信息。<br>  Reduce 阶段关键字和Map阶段的含义一样，不同的如下：</p></li><li><p>compressed: 在 File output operator中这个关键词表示文件输出的结果是否进行压缩，FALSE表示不进行输出压缩。</p></li><li><p>table: 表示正在操作的表。</p></li><li><p>input format&#x2F;out putformat: 分别表示文件输入和输出的文件类型。</p></li><li><p>serde:表示读取表数据的序列化和反序列化的方式。</p></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;a href=&quot;https://cwiki.apache.org/confluence/display/Hive/LanguageManual+Explain&quot;&gt;hive官方文档说明&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;关键字&lt;/strong&gt; &lt;code&gt;EXPLAI</summary>
      
    
    
    
    <category term="hive" scheme="https://llye-hub.github.io/categories/hive/"/>
    
    
    <category term="hiveSQL" scheme="https://llye-hub.github.io/tags/hiveSQL/"/>
    
  </entry>
  
  <entry>
    <title>hiveSQL之groupBy语句增强语法grouping sets/CUBE/rollup</title>
    <link href="https://llye-hub.github.io/posts/67bc5d15.html"/>
    <id>https://llye-hub.github.io/posts/67bc5d15.html</id>
    <published>2023-05-05T06:01:45.000Z</published>
    <updated>2023-05-12T03:37:35.202Z</updated>
    
    <content type="html"><![CDATA[<p>本文详细整理了关于group by子句的增强聚合语法grouping sets&#x2F;CUBE&#x2F;rollup的具体用法，语法的<a href="https://cwiki.apache.org/confluence/display/Hive/Enhanced+Aggregation%2C+Cube%2C+Grouping+and+Rollup">hive官方介绍文档</a> 。</p><h1 id="测试数据"><a href="#测试数据" class="headerlink" title="测试数据"></a>测试数据</h1><p>首先声明使用的hive版本为 <code>2.3.9</code></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> if <span class="keyword">exists</span> travel_data;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> if <span class="keyword">not</span> <span class="keyword">exists</span> travel_data(</span><br><span class="line">      province string,</span><br><span class="line">      city string,</span><br><span class="line">      attraction string,</span><br><span class="line">      star_level <span class="type">int</span>,</span><br><span class="line">      Price <span class="keyword">double</span>,</span><br><span class="line">      sales <span class="type">int</span>,</span><br><span class="line">      sale_date string</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> overwrite <span class="keyword">table</span> travel_data</span><br><span class="line"><span class="keyword">select</span> <span class="string">&#x27;河南省&#x27;</span>,<span class="string">&#x27;郑州市&#x27;</span>,<span class="string">&#x27;方特&#x27;</span>,<span class="number">4</span>,<span class="number">312.22</span>,<span class="number">15789</span>,<span class="string">&#x27;2019-02-03&#x27;</span></span><br><span class="line"><span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line"><span class="keyword">select</span> <span class="string">&#x27;河南省&#x27;</span>,<span class="string">&#x27;郑州市&#x27;</span>,<span class="string">&#x27;二七广场&#x27;</span>,<span class="number">4</span>,<span class="number">0</span>,<span class="number">5942</span>,<span class="string">&#x27;2019-02-03&#x27;</span></span><br><span class="line"><span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line"><span class="keyword">select</span> <span class="string">&#x27;河南省&#x27;</span>,<span class="string">&#x27;郑州市&#x27;</span>,<span class="string">&#x27;河南省博物馆&#x27;</span>,<span class="number">4</span>,<span class="number">1.22</span>,<span class="number">943</span>,<span class="string">&#x27;2019-02-03&#x27;</span></span><br><span class="line"><span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line"><span class="keyword">select</span> <span class="string">&#x27;河南省&#x27;</span>,<span class="string">&#x27;洛阳市&#x27;</span>,<span class="string">&#x27;白云山&#x27;</span>,<span class="number">4</span>,<span class="number">324.44</span>,<span class="number">16843</span>,<span class="string">&#x27;2019-02-03&#x27;</span></span><br><span class="line"><span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line"><span class="keyword">select</span> <span class="string">&#x27;河南省&#x27;</span>,<span class="string">&#x27;洛阳市&#x27;</span>,<span class="string">&#x27;白马寺&#x27;</span>,<span class="number">4</span>,<span class="number">23.45</span>,<span class="number">2567</span>,<span class="string">&#x27;2019-02-03&#x27;</span></span><br><span class="line"><span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line"><span class="keyword">select</span> <span class="string">&#x27;河南省&#x27;</span>,<span class="string">&#x27;洛阳市&#x27;</span>,<span class="string">&#x27;龙门石窟&#x27;</span>,<span class="number">4</span>,<span class="number">45</span>,<span class="number">15784</span>,<span class="string">&#x27;2019-02-03&#x27;</span></span><br><span class="line"><span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line"><span class="keyword">select</span> <span class="string">&#x27;广东省&#x27;</span>,<span class="string">&#x27;深圳市&#x27;</span>,<span class="string">&#x27;东部华侨城&#x27;</span>,<span class="number">4</span>,<span class="number">86</span>,<span class="number">9523</span>,<span class="string">&#x27;2019-02-03&#x27;</span></span><br><span class="line"><span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line"><span class="keyword">select</span> <span class="string">&#x27;广东省&#x27;</span>,<span class="string">&#x27;深圳市&#x27;</span>,<span class="string">&#x27;欢乐谷&#x27;</span>,<span class="number">4</span>,<span class="number">54</span>,<span class="number">2573</span>,<span class="string">&#x27;2019-02-03&#x27;</span></span><br><span class="line"><span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line"><span class="keyword">select</span> <span class="string">&#x27;广东省&#x27;</span>,<span class="string">&#x27;深圳市&#x27;</span>,<span class="string">&#x27;世界之窗&#x27;</span>,<span class="number">4</span>,<span class="number">34</span>,<span class="number">5644</span>,<span class="string">&#x27;2019-02-03&#x27;</span></span><br><span class="line"><span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line"><span class="keyword">select</span> <span class="string">&#x27;广东省&#x27;</span>,<span class="string">&#x27;广州市&#x27;</span>,<span class="string">&#x27;长隆&#x27;</span>,<span class="number">4</span>,<span class="number">46</span>,<span class="number">25673</span>,<span class="string">&#x27;2019-02-03&#x27;</span></span><br><span class="line"><span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line"><span class="keyword">select</span> <span class="string">&#x27;广东省&#x27;</span>,<span class="string">&#x27;广州市&#x27;</span>,<span class="string">&#x27;广州塔&#x27;</span>,<span class="number">4</span>,<span class="number">35</span>,<span class="number">9735</span>,<span class="string">&#x27;2019-02-03&#x27;</span></span><br><span class="line">;</span><br></pre></td></tr></table></figure><h1 id="grouping-set语句"><a href="#grouping-set语句" class="headerlink" title="grouping set语句"></a>grouping set语句</h1><p>官方说明</p><blockquote><p>The GROUPING SETS clause in GROUP BY allows us to specify more than one GROUP BY option in the same record set. All GROUPING SET clauses can be logically expressed in terms of several GROUP BY queries connected by UNION. Table-1 shows several such equivalent statements. This is helpful in forming the idea of the GROUPING SETS clause. A blank set ( ) in the GROUPING SETS clause calculates the overall aggregate.</p></blockquote><p>grouping set子句可以实现对同一个数据集指定多个group by条件，适合多维聚合场景下使用。其执行效果等同于对多个group by查询进行union all操作。</p><p><code>SELECT a, b, SUM(c) FROM tab1 GROUP BY a, b GROUPING SETS ( (a,b) )</code>等同下面语句</p><blockquote><p>SELECT a, b, SUM(c) FROM tab1 GROUP BY a, b</p></blockquote><p><code>SELECT a, b, SUM( c ) FROM tab1 GROUP BY a, b GROUPING SETS ( (a, b), a, b, ( ) )</code>等同下面语句</p><blockquote><p>SELECT a, b, SUM( c ) FROM tab1 GROUP BY a, b<br>UNION<br>SELECT a, null, SUM( c ) FROM tab1 GROUP BY a, null<br>UNION<br>SELECT null, b, SUM( c ) FROM tab1 GROUP BY null, b<br>UNION<br>SELECT null, null, SUM( c ) FROM tab1</p></blockquote><p><strong>语法</strong></p><ol><li>grouping sets子句必须跟在group by语句后，且出现在grouping sets的字段必须出现在group by语句中，但是出现在group by中字段不一定要出现在grouping sets语句中</li><li>出现在group by中但是没有在grouping sets中的字段将会被赋值为null</li><li>grouping__id字段可以区分不同的聚合粒度，表示当前行数据数据哪个分组集合</li><li>grouping函数可以处理空值，grouping()接受一个列名作为参数，如果结果对应行使用了参数列做聚合，返回0，此时意味着NULL来自输入数据；否则返回1，此时意味着NULL是grouping sets的占位符。</li></ol><p><strong>测试sql：从省&amp;市聚合维度统计销售数量</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">    td.province,</span><br><span class="line">    td.city,</span><br><span class="line">    IF(<span class="keyword">grouping</span>(td.city) <span class="operator">=</span> <span class="number">0</span>,td.city,<span class="string">&#x27;城市&#x27;</span>) <span class="keyword">as</span> city2, <span class="comment">-- 进行空值判断，替换输出更有实际意义的值</span></span><br><span class="line">    <span class="built_in">sum</span>(sales) <span class="keyword">as</span> sales,</span><br><span class="line">    grouping__id</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">    travel_data td</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span></span><br><span class="line">    td.province,</span><br><span class="line">    td.city</span><br><span class="line">    <span class="keyword">grouping</span> SETS (td.province,td.city)</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> grouping__id</span><br><span class="line">;</span><br></pre></td></tr></table></figure><p>查询结果：</p><p><img src="https://i.328888.xyz/2023/05/05/iTpX0x.png" alt="iTpX0x.png"></p><ul><li>第一列按照province</li><li>第二列按照city</li><li>第三列按照city分组，并对空值进行替换</li><li>第四列按照province或city分组，进行统计计算</li><li>第五列grouping__id表示当前行数据属于哪个分组，1表示province，2表示city</li></ul><p><strong>测试sql：从省&amp;市、省&amp;日期、省三个聚合维度统计销售数量</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">td.province ,</span><br><span class="line">td.city,</span><br><span class="line"><span class="built_in">sum</span>(sales) <span class="keyword">as</span> sales,</span><br><span class="line">td.sale_date ,</span><br><span class="line">grouping__id</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">travel_data td</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span></span><br><span class="line">td.province ,</span><br><span class="line">td.city,</span><br><span class="line">td.sale_date</span><br><span class="line"><span class="keyword">grouping</span> SETS (</span><br><span class="line">(td.province , td.city)</span><br><span class="line">,(td.province, td.sale_date)</span><br><span class="line">,td.province </span><br><span class="line">)</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">grouping__id</span><br></pre></td></tr></table></figure><h1 id="cube语句"><a href="#CUBE语句" class="headerlink" title="CUBE语句"></a>CUBE语句</h1><p>CUBE函数跟group by语句一起使用，可以对group by的所有字段进行组合再进行聚合计算。</p><p><code>group by a,b,c with CUBE</code>执行效果等同于 <code>group by a, b, c grouping sets ( (a, b, c), (a, b), (b, c), (a, c), (a), (b), (c), ( ))</code></p><p><strong>测试sql</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">    province ,</span><br><span class="line">    city,</span><br><span class="line">    <span class="built_in">sum</span>(sales) <span class="keyword">as</span> sales,</span><br><span class="line">    grouping__id</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">    travel_data</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span></span><br><span class="line">    province,city</span><br><span class="line"><span class="keyword">with</span> <span class="keyword">CUBE</span></span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">    grouping__id</span><br><span class="line">;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 或者下面这种写法</span></span><br><span class="line"><span class="keyword">select</span></span><br><span class="line">    province ,</span><br><span class="line">    city,</span><br><span class="line">    <span class="built_in">sum</span>(sales) <span class="keyword">as</span> sales,</span><br><span class="line">    grouping__id</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">    travel_data</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span></span><br><span class="line">    <span class="keyword">CUBE</span>(province,city)</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">    grouping__id</span><br><span class="line">;</span><br></pre></td></tr></table></figure><p>查询结果：</p><p><img src="https://i.328888.xyz/2023/05/06/iatksp.png" alt="iatksp.png"></p><p>从上面的结果数据可以看到，对聚合字段 <code>(province,city)</code>使用CUBE函数后，返回结果有4种聚合维度：<code>(province,city)</code>、<code>(province)</code>、<code>(city)</code>、<code>()</code></p><h1 id="rollup语句"><a href="#rollup语句" class="headerlink" title="rollup语句"></a>rollup语句</h1><p>rollup是CUBE的子集，以最左侧的维度为主，从该维度进行层级聚合，可以实现上钻和下钻的效果</p><p><code>group by a,b,c with rollup</code>假设层次结构是 “a “向下钻到 “b “向下钻到 “c”，执行效果等同于 <code>group by a, b, c grouping sets ( (a, b, c), (a, b), (a), ( ))</code></p><p><strong>测试sql</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">    province ,</span><br><span class="line">    city,</span><br><span class="line">    sale_date ,</span><br><span class="line">    <span class="built_in">sum</span>(sales) <span class="keyword">as</span> sales,</span><br><span class="line">    grouping__id</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">    travel_data</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span></span><br><span class="line">    province,city,sale_date</span><br><span class="line"><span class="keyword">with</span> <span class="keyword">rollup</span></span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">    grouping__id</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 或者下面这种写法</span></span><br><span class="line"><span class="keyword">select</span></span><br><span class="line">province ,</span><br><span class="line">city,</span><br><span class="line">sale_date ,</span><br><span class="line"><span class="built_in">sum</span>(sales) <span class="keyword">as</span> sales,</span><br><span class="line">grouping__id</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">travel_data </span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span></span><br><span class="line"><span class="keyword">rollup</span>(province,city,sale_date)</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">grouping__id</span><br></pre></td></tr></table></figure><p>查询结果：</p><p><img src="https://i.328888.xyz/2023/05/06/iakvoL.png" alt="iakvoL.png"></p><p>从上面的结果数据可以看到，对聚合字段 <code>(province,city,sale_date)</code>使用rollup函数后，返回结果有4种聚合维度：<code>(province,city,sale_date)</code>、<code>(province,city)</code>、<code>(province)</code>、<code>()</code></p><h1 id="grouping__id计算方法"><a href="#grouping-id计算方法" class="headerlink" title="grouping__id计算方法"></a>grouping__id计算方法</h1><p>从rollup函数的例子可以看到，grouping__id的数值并不是连续的，下面总结下grouping__id计算方法</p><ol><li>按group by语句的字段顺序（不理解网上有说法是按字段倒序排序）。所以这里要注意groupby字段顺序变化是会影响grouping__id计算结果的。</li><li>对于每个字段，若出现在了当前粒度中，则该字段位置赋值为0，否则为1。</li><li>这样就形成了一个二进制数，将这个二进制数转为十进制，即为当前粒度对应的 grouping__id。</li></ol><p>以统计粒度 <code>group by province,city,sale_date</code>为例，</p><ul><li>字段顺序为:province,city,sale_date</li><li>所有聚合维度对应的二进制数为：</li></ul><table><thead><tr><th align="center">grouping sets</th><th align="center">按字段顺序赋值二进制数</th><th align="center">转换为十进制的grouping__id</th></tr></thead><tbody><tr><td align="center">province,city,sale_date</td><td align="center">000</td><td align="center">0</td></tr><tr><td align="center">province,city</td><td align="center">001</td><td align="center">1</td></tr><tr><td align="center">province,sale_date</td><td align="center">010</td><td align="center">2</td></tr><tr><td align="center">province</td><td align="center">011</td><td align="center">3</td></tr><tr><td align="center">city,sale_date</td><td align="center">100</td><td align="center">4</td></tr><tr><td align="center">city</td><td align="center">101</td><td align="center">5</td></tr><tr><td align="center">sale_date</td><td align="center">110</td><td align="center">6</td></tr><tr><td align="center">无</td><td align="center">111</td><td align="center">7</td></tr></tbody></table><p><strong>测试sql：</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">td.province ,</span><br><span class="line">city,</span><br><span class="line">td.sale_date ,</span><br><span class="line"><span class="built_in">sum</span>(sales) <span class="keyword">as</span> sales,</span><br><span class="line">grouping__id</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">travel_data td</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span></span><br><span class="line"><span class="keyword">CUBE</span>(td.province,td.city,td.sale_date)</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line">grouping__id</span><br></pre></td></tr></table></figure><p>查询结果：</p><p><img src="https://i.328888.xyz/2023/05/05/iT55Jb.png" alt="iT55Jb.png"></p><p>从上面的结果可以看到，grouping__id的数值与计算规则得出来的一致。hive2.3版本前关于grouping__id的计算方式可能不同，可以参见<a href="https://blog.csdn.net/Dax1n/article/details/104308886">其他博客</a></p><h1 id="grouping-sets和union-all性能对比"><a href="#grouping-sets和union-all性能对比" class="headerlink" title="grouping sets和union all性能对比"></a>grouping sets和union all性能对比</h1><p><strong>实现逻辑</strong><br>如果说 <code>union all</code>是先聚合再联合，那么 <code>grouping sets</code>就是先联合再聚合。<code>grouping sets</code>根据 <code>N</code>个分组对每条数据进行计算，不在当前分组的字段置为null，将数据量扩展成原来的 <code>N</code>倍，再按 <code>group by</code>的字段做聚合计算。</p><p><code>group by province,city grouping sets ((province,city),province,())</code>计算效果图如下：</p><p><img src="https://i.328888.xyz/2023/05/06/iacyut.png" alt="iacyut.png"></p><p><code>…… group by province,city union all …… group by province</code>计算效果图如下：</p><p><img src="https://i.328888.xyz/2023/05/06/iaRuvE.png" alt="iaRuvE.png"></p><p>分析源码，grouping__id在process的时候将newKeysGroupingSets的值赋予具体的行</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// org/apache/hadoop/hive/ql/exec/GroupByOperator.java</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">process</span><span class="params">(Object row, <span class="type">int</span> tag)</span> <span class="keyword">throws</span> HiveException &#123;</span><br><span class="line">……</span><br><span class="line">    <span class="keyword">if</span> (groupingSetsPresent) &#123;</span><br><span class="line">    Object[] newKeysArray = newKeys.getKeyArray();</span><br><span class="line">    Object[] cloneNewKeysArray = <span class="keyword">new</span> <span class="title class_">Object</span>[newKeysArray.length];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">keyPos</span> <span class="operator">=</span> <span class="number">0</span>; keyPos &lt; groupingSetsPosition; keyPos++) &#123;</span><br><span class="line">    cloneNewKeysArray[keyPos] = newKeysArray[keyPos];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">groupingSetPos</span> <span class="operator">=</span> <span class="number">0</span>; groupingSetPos &lt; groupingSets.size(); groupingSetPos++) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">keyPos</span> <span class="operator">=</span> <span class="number">0</span>; keyPos &lt; groupingSetsPosition; keyPos++) &#123;</span><br><span class="line">    newKeysArray[keyPos] = <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">FastBitSet</span> <span class="variable">bitset</span> <span class="operator">=</span> groupingSetsBitSet[groupingSetPos];</span><br><span class="line">    <span class="comment">// Some keys need to be left to null corresponding to that grouping set.</span></span><br><span class="line">    <span class="comment">// 按照bitSet保留原值，对于group by a, b, c 如果bitSet是010，则表示keyPos为0和2就表示ClearBit，需要保留原值，1其他就为null</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">keyPos</span> <span class="operator">=</span> bitset.nextClearBit(<span class="number">0</span>); keyPos &lt; groupingSetsPosition;</span><br><span class="line">          keyPos = bitset.nextClearBit(keyPos+<span class="number">1</span>)) &#123;</span><br><span class="line">          newKeysArray[keyPos] = cloneNewKeysArray[keyPos];</span><br><span class="line">      &#125;</span><br><span class="line">    <span class="comment">// 这里就是给当前这条数据赋予GROUPING_ID的值</span></span><br><span class="line">    newKeysArray[groupingSetsPosition] = newKeysGroupingSets[groupingSetPos];</span><br><span class="line">    processKey(row, rowInspector);</span><br><span class="line">    &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    processKey(row, rowInspector);</span><br><span class="line">    &#125;  </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>下面通过执行计划分析两种方式的差异。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="keyword">select</span></span><br><span class="line">    province,</span><br><span class="line">    city,</span><br><span class="line">    grouping__id</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">    travel_data </span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span></span><br><span class="line">    province,</span><br><span class="line">    city</span><br><span class="line">    <span class="keyword">grouping</span> SETS ((province,city),province,())</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> grouping__id</span><br><span class="line">;</span><br></pre></td></tr></table></figure><p>hive执行计划：</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">Explain                                                                                                      |</span><br><span class="line">-------------------------------------------------------------------------------------------------------------+</span><br><span class="line">STAGE DEPENDENCIES:                                                                                          |</span><br><span class="line">  Stage-1 is a root stage                                                                                    |</span><br><span class="line">  Stage-2 depends on stages: Stage-1                                                                         |</span><br><span class="line">  Stage-0 depends on stages: Stage-2                                                                         |</span><br><span class="line">                                                                                                             |</span><br><span class="line">STAGE PLANS:                                                                                                 |</span><br><span class="line">  Stage: Stage-1                                                                                             |</span><br><span class="line">    Map Reduce                                                                                               |</span><br><span class="line">      Map Operator Tree:                                                                                     |</span><br><span class="line">          TableScan                                                                                          |</span><br><span class="line">            alias: travel_data                                                                               |</span><br><span class="line">            Statistics: Num rows: 11 Data size: 597 Basic stats: COMPLETE Column stats: NONE                 |</span><br><span class="line">            Select Operator                                                                                  |</span><br><span class="line">              expressions: province (type: string), city (type: string)                                      |</span><br><span class="line">              outputColumnNames: _col0, _col1                                                                |</span><br><span class="line">              Statistics: Num rows: 11 Data size: 597 Basic stats: COMPLETE Column stats: NONE               |</span><br><span class="line">              Group By Operator                                                                              |</span><br><span class="line">                keys: _col0 (type: string), _col1 (type: string), 0 (type: int)                              |</span><br><span class="line">                mode: hash                                                                                   |</span><br><span class="line">                outputColumnNames: _col0, _col1, _col2                                                       |</span><br><span class="line">                Statistics: Num rows: 33 Data size: 1791 Basic stats: COMPLETE Column stats: NONE            |  这里读取数据后按grouping sets的3个分组维度，将数据由11条扩充为33条</span><br><span class="line">                Reduce Output Operator                                                                       |</span><br><span class="line">                 ……</span><br><span class="line">      Reduce Operator Tree:                                                                                  |</span><br><span class="line">        Group By Operator                                                                                    |</span><br><span class="line">          keys: KEY._col0 (type: string), KEY._col1 (type: string), KEY._col2 (type: int)                    |</span><br><span class="line">          mode: mergepartial                                                                                 |</span><br><span class="line">          outputColumnNames: _col0, _col1, _col2                                                             |</span><br><span class="line">          Statistics: Num rows: 16 Data size: 868 Basic stats: COMPLETE Column stats: NONE                   |</span><br><span class="line">          Select Operator                                                                                    |</span><br><span class="line">            expressions: _col0 (type: string), _col1 (type: string), _col2 (type: int)                       |</span><br><span class="line">            outputColumnNames: _col0, _col1, _col2                                                           |</span><br><span class="line">            Statistics: Num rows: 16 Data size: 868 Basic stats: COMPLETE Column stats: NONE                 |</span><br><span class="line">            ……</span><br><span class="line">                                                                                                             |</span><br><span class="line">  Stage: Stage-2                                                                                             |</span><br><span class="line">    Map Reduce                                                                                               |</span><br><span class="line">      Map Operator Tree:                                                                                     |</span><br><span class="line">          TableScan                                                                                          |</span><br><span class="line">            Reduce Output Operator                                                                           |</span><br><span class="line">              key expressions: _col2 (type: int)                                                             |</span><br><span class="line">              sort order: +                                                                                  |</span><br><span class="line">              Statistics: Num rows: 16 Data size: 868 Basic stats: COMPLETE Column stats: NONE               |</span><br><span class="line">              value expressions: _col0 (type: string), _col1 (type: string)                                  |</span><br><span class="line">      Reduce Operator Tree:                                                                                  |</span><br><span class="line">        Select Operator                                                                                      |</span><br><span class="line">          expressions: VALUE._col0 (type: string), VALUE._col1 (type: string), KEY.reducesinkkey0 (type: int)|  这里KEY.reducesinkkey0即为grouping__id</span><br><span class="line">          outputColumnNames: _col0, _col1, _col2                                                             |</span><br><span class="line">          Statistics: Num rows: 16 Data size: 868 Basic stats: COMPLETE Column stats: NONE                   |</span><br><span class="line">          ……                                                                                        |</span><br><span class="line"> </span><br><span class="line">                                 |</span><br><span class="line">                                                                                                             |</span><br><span class="line">  Stage: Stage-0                                                                                             |</span><br><span class="line">    ……                                                                                   </span><br></pre></td></tr></table></figure><p>从上面的执行计划可以看到，<code>Stage-1</code>在读取数据时，在<code>map</code>阶段根据<code>grouping sets</code>有3个分组维度，将数据量扩充至原来的3倍，然后在<code>reduce</code>阶段做<code>group by province,city</code>操作。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">explain</span><br><span class="line"><span class="keyword">select</span></span><br><span class="line">province,</span><br><span class="line">city</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">travel_data</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span></span><br><span class="line">    province,city</span><br><span class="line"><span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line"><span class="keyword">select</span></span><br><span class="line">    province,</span><br><span class="line">    <span class="keyword">NULL</span> <span class="keyword">as</span> city</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">travel_data</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span></span><br><span class="line">    province </span><br><span class="line">;</span><br></pre></td></tr></table></figure><p>hive执行计划：</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">Explain                                                                                           |</span><br><span class="line">--------------------------------------------------------------------------------------------------+</span><br><span class="line">STAGE DEPENDENCIES:                                                                               |</span><br><span class="line">  Stage-1 is a root stage                                                                         |</span><br><span class="line">  Stage-2 depends on stages: Stage-1, Stage-3                                                     |</span><br><span class="line">  Stage-3 is a root stage                                                                         |</span><br><span class="line">  Stage-0 depends on stages: Stage-2                                                              |</span><br><span class="line">                                                                                                  |</span><br><span class="line">STAGE PLANS:                                                                                      |</span><br><span class="line">  Stage: Stage-1                                                                                  |</span><br><span class="line">    Map Reduce                                                                                    |</span><br><span class="line">      Map Operator Tree:                                                                          |</span><br><span class="line">          TableScan                                                                               |</span><br><span class="line">            alias: travel_data                                                                    |</span><br><span class="line">            Statistics: Num rows: 11 Data size: 597 Basic stats: COMPLETE Column stats: NONE      |</span><br><span class="line">            Select Operator                                                                       |</span><br><span class="line">              expressions: province (type: string), city (type: string)                           |</span><br><span class="line">              outputColumnNames: province, city                                                   |</span><br><span class="line">              Statistics: Num rows: 11 Data size: 597 Basic stats: COMPLETE Column stats: NONE    |</span><br><span class="line">              Group By Operator                                                                   |</span><br><span class="line">                keys: province (type: string), city (type: string)                                |</span><br><span class="line">                mode: hash                                                                        |</span><br><span class="line">                outputColumnNames: _col0, _col1                                                   |</span><br><span class="line">                Statistics: Num rows: 11 Data size: 597 Basic stats: COMPLETE Column stats: NONE  |  这里数据量没有变化</span><br><span class="line">                Reduce Output Operator                                                            |</span><br><span class="line">                  ……</span><br><span class="line">      Reduce Operator Tree:                                                                       |</span><br><span class="line">        Group By Operator                                                                         |</span><br><span class="line">          keys: KEY._col0 (type: string), KEY._col1 (type: string)                                |</span><br><span class="line">          mode: mergepartial                                                                      |</span><br><span class="line">          outputColumnNames: _col0, _col1                                                         |</span><br><span class="line">          Statistics: Num rows: 5 Data size: 271 Basic stats: COMPLETE Column stats: NONE         |</span><br><span class="line">          ……</span><br><span class="line">                                                                                                  |</span><br><span class="line">  Stage: Stage-2                                                                                  |</span><br><span class="line">    Map Reduce                                                                                    |</span><br><span class="line">      Map Operator Tree:                                                                          |</span><br><span class="line">          TableScan                                                                               |</span><br><span class="line">            Union                                                                                 |</span><br><span class="line">              Statistics: Num rows: 10 Data size: 542 Basic stats: COMPLETE Column stats: NONE    |</span><br><span class="line">              ……                  |</span><br><span class="line">          TableScan                                                                               |</span><br><span class="line">            Union                                                                                 |</span><br><span class="line">              Statistics: Num rows: 10 Data size: 542 Basic stats: COMPLETE Column stats: NONE    |</span><br><span class="line">              ……               </span><br><span class="line">  Stage: Stage-3                                                                                  |</span><br><span class="line">    Map Reduce                                                                                    |</span><br><span class="line">      Map Operator Tree:                                                                          |</span><br><span class="line">          TableScan                                                                               |</span><br><span class="line">            alias: travel_data                                                                    |</span><br><span class="line">            Statistics: Num rows: 11 Data size: 597 Basic stats: COMPLETE Column stats: NONE      |</span><br><span class="line">            Select Operator                                                                       |</span><br><span class="line">              expressions: province (type: string)                                                |</span><br><span class="line">              outputColumnNames: province                                                         |</span><br><span class="line">              Statistics: Num rows: 11 Data size: 597 Basic stats: COMPLETE Column stats: NONE    |</span><br><span class="line">              Group By Operator                                                                   |</span><br><span class="line">                keys: province (type: string)                                                     |</span><br><span class="line">                mode: hash                                                                        |</span><br><span class="line">                outputColumnNames: _col0                                                          |</span><br><span class="line">                Statistics: Num rows: 11 Data size: 597 Basic stats: COMPLETE Column stats: NONE  |  这里数据量没有变化</span><br><span class="line">                Reduce Output Operator                                                            |</span><br><span class="line">                  ……</span><br><span class="line">      Reduce Operator Tree:                                                                       |</span><br><span class="line">        Group By Operator                                                                         |</span><br><span class="line">          keys: KEY._col0 (type: string)                                                          |</span><br><span class="line">          mode: mergepartial                                                                      |</span><br><span class="line">          outputColumnNames: _col0                                                                |</span><br><span class="line">          Statistics: Num rows: 5 Data size: 271 Basic stats: COMPLETE Column stats: NONE         |</span><br><span class="line">            ……             </span><br><span class="line">                                                                                                  |</span><br><span class="line">  Stage: Stage-0                                                                                  |</span><br><span class="line">    ……                     </span><br></pre></td></tr></table></figure><p>从上面的执行计划可以看到，<code>Stage-1</code>和<code>Stage-3</code>都是读取数据，再分别按照<code>group by province,city</code>和<code>group by province</code>做聚合操作，最后在<code>Stage-2</code>做<code>union</code>操作合并数据。<code>union all</code>这种写法对表<code>travel_data</code>重复读取两次，查询性能上比<code>grouping sets</code>写法要差些。在集群空闲的情况下，对两种写法的sql分别执行5次，得到如下结果：</p><blockquote><p>grouping sets写法执行5次的耗时:</p><blockquote><p>select province, city, grouping__id from travel_data group by province, city grouping SETS ((province,city),province) order by grouping__id ;</p></blockquote><p>Time taken: 54.807 seconds, Fetched: 6 row(s)<br>Time taken: 56.261 seconds, Fetched: 6 row(s)<br>Time taken: 52.671 seconds, Fetched: 6 row(s)<br>Time taken: 62.945 seconds, Fetched: 6 row(s)<br>Time taken: 57.337 seconds, Fetched: 6 row(s)</p></blockquote><blockquote><p>union all写法执行5次的耗时:</p><blockquote><p>select province,city from travel_data group by province,city union all select province, NULL as city from travel_data group by province;</p></blockquote><p>Time taken: 83.91 seconds, Fetched: 6 row(s)<br>Time taken: 94.466 seconds, Fetched: 6 row(s)<br>Time taken: 86.253 seconds, Fetched: 6 row(s)<br>Time taken: 75.509 seconds, Fetched: 6 row(s)<br>Time taken: 88.633 seconds, Fetched: 6 row(s)</p></blockquote><p>可以算出，<code>grouping sets</code>写法的平均耗时为56.8s，<code>union all</code>写法的平均耗时为85.7s，耗时是前者的1.5倍。</p><p>所以，<code>grouping sets</code>写法的sql不仅在表达上更加简洁，在查询性能上也更加高效。</p><h1 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h1><p><a href="https://juejin.cn/post/7223211123961200700">Hive分析函数详解：GROUPING SETS&#x2F;CUBE&#x2F;ROLLUP</a></p><p><a href="https://zhuanlan.zhihu.com/p/536981356">从源码深入理解 Spark SQL 中的 Grouping Sets 语句</a></p><p><a href="https://zhuanlan.zhihu.com/p/408391394">Hive虚拟列的生成与计算【1】</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;本文详细整理了关于group by子句的增强聚合语法grouping sets&amp;#x2F;CUBE&amp;#x2F;rollup的具体用法，语法的&lt;a href=&quot;https://cwiki.apache.org/confluence/display/Hive/Enhanced+</summary>
      
    
    
    
    <category term="SQL" scheme="https://llye-hub.github.io/categories/SQL/"/>
    
    
    <category term="grouping sets" scheme="https://llye-hub.github.io/tags/grouping-sets/"/>
    
  </entry>
  
  <entry>
    <title>关于数据仓库建设的一些思考</title>
    <link href="https://llye-hub.github.io/posts/49066d40.html"/>
    <id>https://llye-hub.github.io/posts/49066d40.html</id>
    <published>2023-04-14T09:02:13.000Z</published>
    <updated>2023-05-09T09:36:46.989Z</updated>
    
    <content type="html"><![CDATA[<p>基于在海拍客的工作经历，沉淀了一些关于数据仓库的思考，没有框架，想到什么写什么</p><h1 id="数据仓库解决什么问题"><a href="#数据仓库解决什么问题？" class="headerlink" title="数据仓库解决什么问题？"></a>数据仓库解决什么问题？</h1><p>1、避免”烟囱式”开发，减少由于业务变化带来的维护成本<br>烟囱式开发，所有报表都是基于原始数据加工，SQL复杂度高，模型和指标无法复用，大量重复计算逻辑。一但某个业务变化，模型维护成本极高，而且大量的重复计算对资源消耗非常大，极易造成队列阻塞，影响数据产出</p><p>2、统一数据指标口径，保证数据一致性：定义一致、计算口径一致、数据源一致</p><ul><li>中文博大精深，一个简单的中文词经常包含些隐含信息。</li></ul><p>比如交易金额，当需求方说要取今天的交易额的时候，很多时候说的是今天的成功的交易金额，然而在逻辑角度，交易金额指的的订单表上支付金额+优惠券金额，不进行交易状态的条件过滤。</p><ul><li>鸡同鸭讲，说的是两个人沟通时说的不是同一个东西。</li></ul><p>比如订单的发货时间，对于财务业务，指的是订单表中的delivery_time字段，表示的是供货商提供的物流订单后第一次抓取到发货状态的时间；对于门店用户角度，指的是物流表中最终发送到用户手上那个订单的物流的发货时间。</p><p>3、数据结构清晰，方便数据查找和理解<br>数仓的分层设计能明晰每张表的作用域和职责，在需要查询使用时，能快速找到要用的表和理解每个字段的含义</p><h1 id="公司数仓存在什么问题"><a href="#公司数仓存在什么问题？" class="headerlink" title="公司数仓存在什么问题？"></a>公司数仓存在什么问题？</h1><ul><li>一张订单宽表打天下，其中包含了订单、交易、退款、物流、门店、供应商等多维度信息，下游以一个个数据烟囱的方式时间使用dw层的明细数据，无法收缩口径，保证数据的一致性。</li><li>基于onedate理论建设的数仓模型没有长期推广和取代订单宽表，人就有大量新报表从订单宽表获取数据</li></ul><h1 id="数据仓库模型分层设计方案"><a href="#数据仓库模型分层设计方案" class="headerlink" title="数据仓库模型分层设计方案"></a>数据仓库模型分层设计方案</h1><h2 id="基于主题域建设"><a href="#基于主题域建设" class="headerlink" title="基于主题域建设"></a>基于主题域建设</h2><h2 id><a href="#" class="headerlink" title></a></h2><h1 id="好的数据仓库设计评价标准"><a href="#好的数据仓库设计评价标准" class="headerlink" title="好的数据仓库设计评价标准"></a>好的数据仓库设计评价标准</h1><p>好的数仓设计标准应该是数据丰富完善、数据复用性强、数据规范性高。以下面的数仓架构为例<br><img src="https://i.328888.xyz/2023/04/24/iSq1LE.png" alt="iSq1LE.png"></p><h2 id="完善度"><a href="#完善度" class="headerlink" title="完善度"></a>完善度</h2><ul><li><p>dwd层完善度：衡量dwd层的完善度，看ods层被dw&#x2F;dws&#x2F;ads&#x2F;dim层依赖的数量（跨层引用率）。ods层被越多的非dwd层引用，说明越多任务基于原始数据进行开发，各种数据清洗、数据格式化存在重复计算。好的数仓设计一般要求ods层只能被dwd层引用，即跨层引用率为100%。</p></li><li><p>dw&#x2F;dws&#x2F;ads层完善度：衡量汇总数据的完善度，看仅靠dw&#x2F;dws&#x2F;ads层数据就能满足的查询比例（汇总层查询比例）。若汇总层数据无法满足查询要求，则需要从原始数据自行加工计算。汇总层查询比例不可能完全做到100%，但值越高，说明数仓上层模型建设越完善。</p></li></ul><h2 id="复用度"><a href="#复用度" class="headerlink" title="复用度"></a>复用度</h2><ul><li>模型引用系数：⼀个模型被读取，直接产出下游模型的平均数量。若对所有dwd层表（有下游）的模型引用系数取均值，则可衡量dwd层的模型引用系数。系数越大，说明数仓复用度越高。从数据血缘图来看，自下而上一条线的模型设计复用性差，复杂场景下这条线会极其长，而理想的模型设计应是交织的发散型结构<br><img src="https://i.328888.xyz/2023/04/24/ioZnHZ.png" alt="ioZnHZ.png"></li></ul><h2 id="规范度"><a href="#规范度" class="headerlink" title="规范度"></a>规范度</h2><ul><li><p>表分层规范：有多少表不能划属到数仓架构的某一层，一般从表命名前缀体现。</p></li><li><p>表命名规范：⼀个规范的表命名应该包括所属分层、所属主题域、调度周期、全量&#x2F;增量等信息。</p></li><li><p>字段命名规范：相同字段应在不同表保持一样的命名。同样是用户id，不能在A表叫user_id，在B表却叫u_id.</p></li></ul><p>数仓规范度越高，表名包含的信息越多，在数据地图查找表越方便，也更利于提高模型表复用度。</p><h1 id="一些博客文章"><a href="#一些博客文章" class="headerlink" title="一些博客文章"></a>一些博客文章</h1><p><a href="https://blog.51cto.com/u_15259710/2932712">如何避免数仓模型“烟囱式”建设</a></p><p><a href="https://mp.weixin.qq.com/s/U-avCBgYbwStUDe7e1LsqA">数仓常见问题以及解决方案！</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;基于在海拍客的工作经历，沉淀了一些关于数据仓库的思考，没有框架，想到什么写什么&lt;/p&gt;
&lt;h1 id=&quot;数据仓库解决什么问题&quot;&gt;&lt;a href=&quot;#数据仓库解决什么问题？&quot; class=&quot;headerlink&quot; title=&quot;数据仓库解决什么问题？&quot;&gt;&lt;/a&gt;数据仓库解决什</summary>
      
    
    
    
    <category term="数据仓库" scheme="https://llye-hub.github.io/categories/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/"/>
    
    
  </entry>
  
  <entry>
    <title>数仓建模之关于流量域建设</title>
    <link href="https://llye-hub.github.io/posts/bbbc8dfb.html"/>
    <id>https://llye-hub.github.io/posts/bbbc8dfb.html</id>
    <published>2023-04-14T08:56:16.000Z</published>
    <updated>2023-05-08T02:05:14.131Z</updated>
    
    <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="抱歉，您输入的密码错误，请检查后重新输入。" data-whm="抱歉, 当前文章不能被校验, 不过您还是可以看看解密后的内容。">  <script id="hbeData" type="hbeData" data-hmacdigest="4304f858f102b5e1e05f225132d79abf84e95f7b78114b0fe4c30989e795a675">0ae7e196f2221a75e5346dcbb7e124f3b1b3c5930620d283013007149d4c4935b69ce92f61658828479c839b5ea9198d1bda489f76e02aefb6c8c1b6c4f32fd31f36e698664f02671ce11c574fe5628c2d85825c7895fbc00177c55eaf6dc5335488610a8b88d894b09d84d011efc5134b4573dfbe48ed2bf6c239d1fecd49fc54f965b6c70627686bc4d8b5209339f82930e76524144c0f1b5aaa60eef52f119b05e4136dc067e5e8ca67e8e0772186df70f115b895d7d8f368b79708fb1e4c54851da8d44365f6047c0fad077890a16bdd1a6ce5d908272fbbf4f3ee0664dfd07c0471c47bd5506baa027cb755c66a44a1e7277f99d9e2ee2202bd050c0bff1e7d335c69ba839e217bb9e0d3c3eebe6e72bacfd7dda5938764aa615d6f61ed67ed2b24bdcd393e307a817bb140ddb80654ca6f812585d0c73d00616a462225de61da0fc1629df0558f3ee47d9cecd1800ddc7e1d26428f625b965c2e48ac61c2a647927e16629ad85603f6a9378530d503ae19fbace06786266ea4e64eac41d7f818b58581c1086db366efa626abcfc9b024e24da4a29a84e2109cfe15b3fc4f486af813e69865ed2f2ae6b0b48844db76d51998001273c492f1ba476fb840b757be323d45fc5e3fe94eccb2131d4490c4ca9fda3b8088132ec133e5af1c60a7c297a3496af60720a9f2eeca0cf3cc43f5ddd4af9a1297eb760d777ea0626e3a9ad3e2168591d480999c1e7d13dfeb07f4835a8c12500d23c84a42935d3581287ab81ac6ffc7a61afb2eac4dd07742903b802d69292c3d7c56ffa992fa2556e2fc12cc6e52e60a3effa93e3d295e2b7149769d628962d5157c1d24ae1e28b632e676e76f487194ce8c0a434727916a1b8864513f4d69fa39d6a11d868a01dd69c0af40db273372ca9e8c832fea678c5842f86ee27e302472f3101ffbcbf7acc58cdbd720be68548958012f88480fd3af182ea95d5641a911905cc06e3ae93106941854c87263e3fba2445b0ee9b5e5ef894c1a4bba66165a51e1d256d8d186e704ed5e03ae2708a34c0fd18d12cc364164c8b49862a30ccb66621a9a00e10b911882fa0a44156c9686c81e3d0af11c400cc49f94663aa6db8511244e709be165369752e37546cdf7f5d4426a8a45088b2c546ffddb0710c07bdf0256f1e62514037ffdddb1245e6b6ab90d6503a50236f96dacbbe60d1353df2e9edd3b9ff638e32aa3dd29941692520119ba4ad15b060b64f1fb75bfa9e260011a92286c6033803626c66224641b78cd9d7c6e6b8ce6d3b439dd55e05dc95d4bca8009f5cc4d91aa275b41a3f558acbd64c86ea7ba7ebffaaff75acae85274fe26e0d739cf8cdcbf891c2a81a1c9e7bc3a4be7812357246c8a6ada9174133ebbc096984f8b324d5d2a13bb2a3ca4ca6cb44e971ea79ec807547e4421c5dc012bd4c633f805d07718f3906f4f28b7f2457e4c6d4badb98b7a126f3e170d32635bcca3aaa493acce8ef23435e755908f907c4d2786521d3fc0eba03d272015a567009ded9cf1b1730b8b40c7d3b16d9d9fdb734727e277da59dc74f90d3ab88019fa0f31a42161b568de2f8e79321055ff90c038bc71ae84799c93b9bc40aaa4b0ce38fea856e3479dcae13bcb0972ea996c083ea6d3abd6cb45844127558d16f547fa24c6b600fbd84d747f0590f3058fb1d4c5609c8e1a9b926d7b2f3ef3d119557c8519cb2cf49d6027256b75ff51844347463da6205855fca3987416daa6cff5f216c3dd3f5488d10f76f63cea20ac8c9f40f1ad6f7b87b412f1ce8de19e9a8b413bc57e4f5c3c63f680c7d7f71f31f8922b1907815a3e87e2db2a7433b7a2f93f6dd5b703d8c43ed34ee84e652d7225d0cda6dc1cf28cb8704e4cc70588542d8076d687197f40575d4b178184474d2c5a147b883f0fd88a7081f4947ecfaddece704619ac093393174f43a6808f48e40fffc1fc1d7427374af1b9b4e8fb15f47e7ffec46b7292c75eeedb6ce93c94d4c36c246873c258485a41864fc7a46f8beb92d89cc99d8c9bf5ba3837fe64518016646aade36cc72c13b72386fb67423e330e40834d158fe6d889d02bac2745b02278bc4f8616cfe8050c1c17ee2408218915aa74f7df41144896e73bdbd743cc93eca87e78798211d29722134d4ca765e934268e0591c7c0f260792d91bdecc238e531c81da5853102904028580b37c7b2c1fc67c3b7e485a10b46fe636230207b95859bb01229e2a71a60fbce2bfc27013984550bd5ba38a7c4a5169d87ed63d74d51cdb07dca8a1fbaae7e99e2f83227c70427295b2f033c327ad0debcd39972446d355bb4024c6f9f5a36ea0879a8ce63fb90bdec6f3be6c71709bdbf97079fd120217ed4d5f1e89669ca5330fe35d9576db186edf7d520f6161fb224d0a50fad62903dc59fcf83b91cb63edb46bb7b28ea42292888b5509b59ec75cbf486cb6b5c8128f2afe5e23f3a652467efa509826e32426ac0deba3b8842b78f77fc31f110ad08e37d6a586b092e171abf1c43414de5491225c42334c4e6436f7f93c163503fd3b3056ef53e7ea5a77c8322d9f5ed6028ab1e8869515a46b79bb5e58c6a1aeabbbafce68805d768b72b7233f8c73d56622e84eec13d927205ca7e6c4858b9882980607b77faba4f82fe8135d1934a936c927487e596e3e735b82828105a8564353682855d27323bec7490e3ed445305c25fb895fca89647b8bf138b03deaf7622ecad90653159daca153b3df86b0236f978f851fbd9652ce78b94dba6be505f42eafdf2b3c1d3323d59c067118ff4873f7b3af8c8f25d8a251ffc4528ebb206043dcd20560bdf2458281f8c44082ff04152d873f9a9225fe739d61cc74948428e17a1d5d76c8365b9965cbac70a5cf4fb0fd637cd01020f7c52ea00961dbbee810888289c769cce32542960817050608756792754596b5f9d939bc9da9b49e7b28899ab16d465e96fd883ebba0a1cfaf5a1c140cdf1aa06572f9cb1bfb1c86244e95234170c53c4fe97f60821614025d5b107a97a715ea088277509efcdf048a4f61d2840dd40588b62cd4e46a6d2ca0ac77baea8b5b986f39bd9c2cd5a205f77189fffc292f416e43ca35574c153c5f2a7bfb74ec1fe7ceb20e79fbb3fd9dafd8391e7783827787a6c80467a96e8b94a22037f5d8d3ed3ad42f1a0200802b4f290eea664de60c76ef0643b993e5f05fd4964556665ecb7dba9040b65f566613480c1782d497d898ebe18df29b22cd07b948eb87371bc64b4e1d76a27df605b9cb07e5bd2e7a1a2c6e11bbd61125e859ab15e2e116d93e3f9ad34ca2c2d0c4b18f9bcc4ea9361e34ca54cc94256e8a0e41dca8be7ee4cf63f092c8cd765fed448ef98c2af893a8f2a5499bbba2ff2e0ffacd44829f0868b4428026a380fa832e35cde44bbc2f5cd7cfdb9bbb85a72d310de5b6f09da4f39dea6e0c9f8dcdecb56ae25b320063d3bcfe4da51b4d6003a6c6a63973fa927e8083a56f91923207bf7e61d4694851e06600b6a86dc3eb65fe86f978036d0c420f5f128aa5be5b68c3b8b95f1dd86006d63181950c5050dd784b91d08ae8e84eb604e4b862f8020b965fedb8a14bc718d217c25acadc5987c508dc369c8bd399d6241d138196721673f78bd358b0b76370bd56adb3ea516668ada2bc680108084159ee8bf21e8b102d315d3764de07eec5e27105713a36898e161b076bda7bf29c0855336bbce1e096ba5c888331e6e6ae777416547bb7bfc0d8f7c2a2a77c5528177d0223015b8f27707ce76b8766908a4de59fa00128a76bd15456c570058f7db0b6811e85acc09e6e407fd86c3d6c112ef96c35f5403dbe5013d8e85292315ad0b3e4d5ae616d381da0e9de2e468c20998d755961c3826f98a0e054fa1c8d70a7c9ffbddf4683f456ef612d0d615d6ff40fb956761746083b29ce90d4e5ea705cb930043377a775b762717390ad3790d41827aadb6a259233a690475af89d00ded680760637c62eba2a1c59681e869da63b8bd65beb2d1a0173c7005e9b1c3c683486767ccf92ae5b2cdd2d4c90811d347839245cbedb7cae6b07d85e8b58787ff23e9e54afd405e0be59b79bc73f302fbf7bb662e2b87de660328ea2e6be77451cc5f25bf6a25dd929a0f48785ca9fe77535acdffadb0b36e0da29b9d44157c12b727495fb1ade0ef22d45b2f194c68d83898407fd8da7542f857629540122f36dc7e70fd5b4fec7201d078ba13607d5bcb5ec75838b0d7f3cc981c6a2d93a5fdff1054ad72b7f05ec96c4a4ac2fa56efdaa1b936ae305b28213dd7898239c13b360a8d38fe0854b3bdc102707d6a3a46673e35e6c265e01b13d7a7d72474bbcde3a0ef34ae9d2e9ce9705a4c8bdd1e99d97246e9197960cf49b58a239dd360e11e316211c339b58003b9dfb1a8c0330ae5a9d43894a06fc8efaae0a596778fca4fd629e3fd3eefbe608a6dd293d006a3009ac3d9b2b913315028267f2e895790632144253660efc5e5c960f62c3e1027a26cc42dd80e52f7b3a6b11ab3ec944a69128670ec935b5347cf9e77476b38daefa3203262e9b0f911ce81ae6f667305f165a4dbaccbdd49cd722e2146d8a486aec151813c250a295bc63cb9369622cbe531c8490f92c4ebae5f803373c2bacbfc68ea9f1cb583fa4828531768defff1a4f9ebeb23cb542c5461055cfb4d4d5007f5a50552fcd5127fa3145adbe910caf93b214cb1c164bbf39b1d3b707572d1e0b6132e47e48125e15afa4a7b14530f46d46d0dd798064c73e65e3aea8fdc22c80e6f8fa79e7cd1d3ee46438029060c01a3e5a8adab4717e94d1034951f03fe7ca7c63501f613c0e66c7dbc56d22f1024209b8467cf2ee291bae87e113fb63c9e63f5cfc989284d9480115cffa8cfb1ae24bec3aae6e560473afb2136951f7462c4edc5785b93e7d1f60f1f1bd97536207925fc9fe186f7d34a92e5b2c7d59b6c2c4b7e741d9e020ff9eb8cc4620b41bd026cb0afb7aa4d60a8ac6836c1eb81fe21acd80033df74120a146dcc76ca089f0a33e2112bde4b72d20870e076f783a7d13dc1344387352195485afa3867e8612df21709e93ea730c484217cf2c9d673204ff318c27c3b0232ae927e4481dcd7858bfffc2c59ede849589d5a25c22450a421245eae41dd95f17816c6ae5ff2befeec956ce12d74a1295a9f134d44ca7e072d12274f8ad8dd1dcd23dba8a2ef65c7e590c3b130e6cdbc3e32db0cb1703ef6d2c638420f71bd53b2e11f1227541ae163c0b10acdb91b10a1c840ee45cddec4afa2782f213dd74c885cfb4c9be150bd8c0e389f4b037ad34255e67ff628dacdcc128a771e0c698767148517ea8199785d010a9ff2f4d59973740be995cac9dc44909d981ca5be80eb673cd25830cb10f510a7c7d49cf6fbe7f4cf6bc74541d1470339f58972868d03bd49bc72e679e121d2226a42668b5718d6541a84513f33110539e888879bc77050fb2e6377c4265e80c6b8b4fadbf959f5cd32c46fe79436af2a3406e3754df2c5b348e658f5ec9e0681911d78ca946160d90b2854b8f34277485c7f3fcbb44383057b31bbc4d01c013100</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-default">      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-default">当前文章暂不对外可见，请输入密码后查看！</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
    
    
    <summary type="html">这是一篇加密文章，需要密码才能继续阅读。</summary>
    
    
    
    <category term="数据仓库" scheme="https://llye-hub.github.io/categories/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/"/>
    
    
    <category term="private" scheme="https://llye-hub.github.io/tags/private/"/>
    
    <category term="数仓建模" scheme="https://llye-hub.github.io/tags/%E6%95%B0%E4%BB%93%E5%BB%BA%E6%A8%A1/"/>
    
  </entry>
  
  <entry>
    <title>在hive中嵌入自定义数据处理函数-UDF函数</title>
    <link href="https://llye-hub.github.io/posts/cafe49d7.html"/>
    <id>https://llye-hub.github.io/posts/cafe49d7.html</id>
    <published>2023-04-11T09:04:03.000Z</published>
    <updated>2023-04-18T07:45:38.183Z</updated>
    
    
    
    
    <category term="hive" scheme="https://llye-hub.github.io/categories/hive/"/>
    
    
    <category term="写UDF" scheme="https://llye-hub.github.io/tags/%E5%86%99UDF/"/>
    
  </entry>
  
  <entry>
    <title>hiveSQL之全面认识窗口函数</title>
    <link href="https://llye-hub.github.io/posts/ed2327bc.html"/>
    <id>https://llye-hub.github.io/posts/ed2327bc.html</id>
    <published>2023-03-31T02:46:52.000Z</published>
    <updated>2023-04-07T03:23:39.244Z</updated>
    
    <content type="html"><![CDATA[<p>本文内容来自文章<a href="https://mp.weixin.qq.com/s/VnQT-bidnJDduoLfJeRhxA">Hive SQL大厂必考常用窗口函数及面试题</a></p><p>受岗位性质和工作内容影响，在我从事数仓开发工作至今，对于窗口函数的使用场景都很基础，常用的也只有row_number、sum、max&#x2F;min，<br>偶尔碰到些其他场景，因为不熟悉，可能就需要反复查看官方文档确认。</p><p>所以在上面文章阅读过程中，基于个人理解，重新梳理写了本文</p><h1 id="窗口函数概述"><a href="#窗口函数概述" class="headerlink" title="窗口函数概述"></a>窗口函数概述</h1><p><a href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual+WindowingAndAnalytics">hive官方介绍</a></p><p>窗口函数也称为OLAP函数，是数据分析最常用到的函数，熟练的掌握窗口函数的各种用法和骚操作对从事数据工作者是很重要的。</p><p>与聚合函数将多条记录聚合为一条不同，窗口函数每条记录都会执行，执行前后数据量不变，且窗口函数兼具分组和排序两种功能。</p><h2 id="窗口函数用法"><a href="#窗口函数用法" class="headerlink" title="窗口函数用法"></a>窗口函数用法</h2><h2 id="基本语法"><a href="#基本语法" class="headerlink" title="基本语法"></a>基本语法</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">窗口函数</span>&gt;</span> over ([partition by <span class="tag">&lt;<span class="name">列名</span>&gt;</span>] [order by <span class="tag">&lt;<span class="name">排序列名</span>&gt;</span>] [window_frame])</span><br></pre></td></tr></table></figure><p>其中：</p><p>&lt;窗口函数&gt;: 指需要使用的分析函数，如row_number()、sum()等。</p><p>over() : 用来指定函数执行的窗口范围，这个数据窗口大小可能会随着行的变化而变化。<br>如果括号中什么都不写，则意味着窗口包含满足where条件的所有行，窗口函数基于所有行进行计算</p><p>window_frame: 在分组窗口基础上，可以进一步指定窗口计算边界</p><h2 id="设置窗口"><a href="#设置窗口" class="headerlink" title="设置窗口"></a>设置窗口</h2><h3 id="1partition-by子句"><a href="#1）partition-by子句" class="headerlink" title="1）partition by子句"></a>1）partition by子句</h3><p>窗口划分分组条件</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    uid,</span><br><span class="line">    score,</span><br><span class="line">    <span class="built_in">sum</span>(score) <span class="keyword">OVER</span>(<span class="keyword">PARTITION</span> <span class="keyword">BY</span> uid) <span class="keyword">AS</span> sum_score</span><br><span class="line"><span class="keyword">FROM</span> exam_record</span><br></pre></td></tr></table></figure><h3 id="2order-by子句"><a href="#2）order-by子句" class="headerlink" title="2）order by子句"></a>2）order by子句</h3><p>窗口排序条件</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    uid,</span><br><span class="line">    score,</span><br><span class="line">    <span class="built_in">sum</span>(score) <span class="keyword">OVER</span>(<span class="keyword">ORDER</span> <span class="keyword">BY</span> uid) <span class="keyword">AS</span> sum_score</span><br><span class="line"><span class="keyword">FROM</span> exam_record</span><br></pre></td></tr></table></figure><h3 id="3指定窗口大小"><a href="#3）指定窗口大小" class="headerlink" title="3）指定窗口大小"></a>3）指定窗口大小</h3><p>指定窗口大小，又称为窗口框架。框架是重新定义窗口计算边界，框架有两种范围限定方式：</p><ul><li><p>一种是使用 ROWS 子句，通过指定当前行之前或之后的固定数目的行来限制分区中的行数。</p></li><li><p>另一种是使用 RANGE 子句，按照排列序列的当前值，根据相同值来确定分区中的行数。</p></li></ul><p>语法<code>ORDER BY 字段名 RANGE|ROWS 边界规则0 | [BETWEEN 边界规则1 AND 边界规则2]</code>，边界规则的可取值如下：</p><ul><li><code>current row</code>：当前行</li><li><code>n preceding</code>：当前行及往前n行数据</li><li><code>unbounded preceding</code>：第一行至当前行数据</li><li><code>n following</code>：当前行及往后n行数据</li><li><code>unbounded following</code>：当前行至最后一行数据</li></ul><p>需要注意的是，</p><ul><li>使用框架时必须有order by子句</li><li>若仅有order by子句而未指定框架，则默认框架语句为<code>range unbounded preceding and current row</code>，<br><a href="https://llye-hub.github.io/posts/5af52219.html">详情见文章</a></li></ul><h3 id="4window_name"><a href="#4）window-name" class="headerlink" title="4）window_name"></a>4）window_name</h3><p>给窗口指定一个别名<code>WINDOW my_window_name AS (PARTITION BY uid ORDER BY score)</code>，<br>适用于一个窗口被多次使用，可以使sql简洁清晰，也易于维护</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    uid,</span><br><span class="line">    score,</span><br><span class="line">    <span class="built_in">rank</span>() <span class="keyword">OVER</span> my_window_name <span class="keyword">AS</span> rk_num,</span><br><span class="line">    <span class="built_in">row_number</span>() <span class="keyword">OVER</span> my_window_name <span class="keyword">AS</span> row_num,</span><br><span class="line">    <span class="built_in">dense_rank</span>() <span class="keyword">OVER</span> my_window_name <span class="keyword">AS</span> dr_num</span><br><span class="line"><span class="keyword">FROM</span> exam_record</span><br><span class="line"><span class="keyword">WHERE</span> score<span class="operator">&gt;=</span><span class="number">60</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> uid</span><br><span class="line"><span class="keyword">WINDOW</span> my_window_name <span class="keyword">AS</span> (<span class="keyword">PARTITION</span> <span class="keyword">BY</span> uid <span class="keyword">ORDER</span> <span class="keyword">BY</span> score)</span><br></pre></td></tr></table></figure><h2 id="窗口函数分类"><a href="#窗口函数分类" class="headerlink" title="窗口函数分类"></a>窗口函数分类</h2><p>窗口函数：</p><ul><li>first_value: 返回计算窗口内按排序条件的第一个值，语法<code>first_value(exp_str,true|false)</code></li><li>last_value: 返回计算窗口内按排序条件的最后一个值，语法<code>last_value(exp_str,true|false)</code></li><li>lag: 返回相对当前行，第前n行的数据，语法<code>lag(exp_str,offset,defval) over(partition by .. order by …)</code></li><li>lead: 返回相对当前行，第后n行的数据，语法<code>lead(exp_str,offset,defval) over(partition by .. order by …)</code></li></ul><p>配合over语句使用的聚合函数：</p><ul><li>sum</li><li>count([distinct])</li><li>max</li><li>min</li><li>avg</li></ul><p>分析函数：</p><ul><li>row_number: 连续排序——1、2、3、4</li><li>rank: 并列跳号排序——1、1、3、4</li><li>dense_rank: 并列连续排序——1、1、2、3</li><li>percent_rank: 将某个数值在数据集中的rank()排位作为数据集的百分比值返回，每行按照公式(rank-1) &#x2F; (rows-1)进行计算，百分比值的范围为 0 到 1。<br>可用于计算值在数据集内的相对位置。语法<code>percent_rank(exp_str)</code></li><li>cume_dist: 如果按升序排列，则统计：小于等于当前值的行数&#x2F;总行数。<br>       如果是降序排列，则统计：大于等于当前值的行数&#x2F;总行数。<br>       语法<code>cume_dist(exp_str)</code></li><li>ntiles: 将分组数据按照顺序平均切分成n组，并返回当前切片值。语法<code>ntiles(n)</code>。<br>    如果不能平均分配，则优先分配较小编号的切片，并且各个切片中能放的行数最多相差 1。<br>    可简单理解为，有 n 个桶，按编号 1-n 的顺序逐个将分组数据放到每个桶内，直至数据分配完毕。</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;本文内容来自文章&lt;a href=&quot;https://mp.weixin.qq.com/s/VnQT-bidnJDduoLfJeRhxA&quot;&gt;Hive SQL大厂必考常用窗口函数及面试题&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;受岗位性质和工作内容影响，在我从事数仓开发工作至今，对于窗口函数的使用</summary>
      
    
    
    
    <category term="SQL" scheme="https://llye-hub.github.io/categories/SQL/"/>
    
    
    <category term="hiveSQL" scheme="https://llye-hub.github.io/tags/hiveSQL/"/>
    
  </entry>
  
  <entry>
    <title>读书笔记之数据仓库工具箱维度建模权威指南(第3版)</title>
    <link href="https://llye-hub.github.io/posts/4142350a.html"/>
    <id>https://llye-hub.github.io/posts/4142350a.html</id>
    <published>2023-03-29T06:31:37.000Z</published>
    <updated>2023-04-18T08:14:08.029Z</updated>
    
    <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="抱歉，您输入的密码错误，请检查后重新输入。" data-whm="抱歉, 当前文章不能被校验, 不过您还是可以看看解密后的内容。">  <script id="hbeData" type="hbeData" data-hmacdigest="fe1d605873a64a776899cd24903c2cfb2b3f6754276eb8f0e33aa5b5ff6dec62">0ae7e196f2221a75e5346dcbb7e124f36deed831076312fa04e0c81d58c043c17806a367438824993e46b7303f74bdc03c0e9ef99e6f77cba23b77d5795720fb095d0c0e430a499f25eafc1f85fa0f26957e29e45a080da2e8c46c303015a2e2d6358f33b7831aac9e0a2fb3efa003c3cd5eaad97f9f54582e1da9d3f386f64442896e98805a10458108864bf0ef61af265291b4e35171a4ad62b9b68d2af755a6d3a47e23cfd7745f64e906d3d8ee534e387db252f45c508dac4c9ea64049c4a1c46c527800821ef48f838cbb99cc8ee5868166e758e4d826c9191045615239b0bba54723f534af3edc77073e5d173076bcc9d21377398813eebbe67fc13a41ea9b5290197772c51657848492cf450b25cb0fbda050d9f647c76c2ebd3459fd832323e2b8429cc279db814182e50790c0d6be8eb77aeae5900968ddad7ed661712e64bfcdbfc1fef9de209b4c86198573b24d0c8b0c0411af81c363f39c9f2a39a50a4e90b788ba333b563d188038926a4b8395a1fc54527e2e32d417c5ce6f0ab609334238dbf3f9e8a2a14c98c2324bc4e10e89bf085eec861d6b7bb63ba368b0b19eaf6554dce238e24f2eb6adae45ba88b31a41e358062f923d36aa294c5c69aef6cf5bd7e0ac159e04dec4c9afcc6782871a78be29a1af865d6bee02567373df4c8613a2eca0addc868f95d36def19cdf52874a6c37f8a73f02e7406aba0c30837fa9f3f5824054821260a56a37ccd83dc8bf48d55c6aa8a8cf54902233ae65c8539507f899f69cdd4578e899ca62eef20dbc2c62d93024f91675dbb3c44433526d59ccfb6c05b07789cff3c7bd2cc00a1abcb17b4fc14fab6a0e54a9c5468694c93a2b47dcfdffb36940d04ce71a420b1be7b7f34b4d7affc4372014c4022636cd353a115c0cbf51871ba41d55c14f2dac1ac1aaf1bfc8f7ea941568819a2a3fff8d5d45baf70a186d14ab11f375333786ec21e5c2c899504a9ffedba9864a1ed410fc0f58dd54d0200d0c39885ee14a485527caa2873936f60d4f7b84c34cce55e813a133ba372f781098969dacd4822610fb052f127c250bc50751f6f898875e0d8e4f2651497822fe62ce2fd9fcc8a2d157f870d1567e9975390486f1649f47d7bd22d2c47d6e8123f0d9a0867d731624d11c059793bfffcf417442ce4613c032d7fe5dc8b3f3a5dc5928ca0203636dad75632ff16d3a60447404feed43c0abe71f8c230b7448bcbd5a8b2fbb6bc6fde25b66bb65119415b55883fa33045f15360a426b8e57e3d1883b7e275259b408bfe2dbd99489a169defdde7cd9d3f1ebacb81189a59580199edbe0fdc72c80e15ab587b9e14abe0f7e4b635b4bbde877e75ef8b80b5b3330086c5a21104e737d1abae006ac6ca62e5910562b8dd19e83011e5b3099d270b238fc9d281476d06df4ba20b62eaa1db8ab10fb9e767162c78277f2b35ad15ed94a1f93fa9c1350a9b2cc42aec7f1b2742d3dc1deec41b7bdecad8d211b1b61bf6a4fa1a7354c57857f7f3091e64b7997a9392f61fd3d83fa37ebcd824fbd8e228134d72ff5207950a1bb1c83e68c6d7786dddad528cfa8f56cc5bda0195457edeec78abbcb9b8d4c05cc2c61cb0461db5d8954feecc1fe224f19f8756785cc826673959038e4a4800e158887a9dade68e86b099f1687be6418dc3482c001135ecf21d1366dbc41aa1284b08434a6c9612aaeeb6</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-default">      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-default">当前文章暂不对外可见，请输入密码后查看！</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
    
    
    <summary type="html">这是一篇加密文章，需要密码才能继续阅读。</summary>
    
    
    
    <category term="阅读笔记" scheme="https://llye-hub.github.io/categories/%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/"/>
    
    
    <category term="读书笔记" scheme="https://llye-hub.github.io/tags/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/"/>
    
    <category term="private" scheme="https://llye-hub.github.io/tags/private/"/>
    
  </entry>
  
  <entry>
    <title>内置函数之reflect</title>
    <link href="https://llye-hub.github.io/posts/1d24daf8.html"/>
    <id>https://llye-hub.github.io/posts/1d24daf8.html</id>
    <published>2023-03-22T09:39:53.000Z</published>
    <updated>2023-03-29T03:43:07.269Z</updated>
    
    
    
    
    <category term="SQL" scheme="https://llye-hub.github.io/categories/SQL/"/>
    
    
    <category term="内置函数" scheme="https://llye-hub.github.io/tags/%E5%86%85%E7%BD%AE%E5%87%BD%E6%95%B0/"/>
    
  </entry>
  
  <entry>
    <title>搭建spark on yarn源码调试</title>
    <link href="https://llye-hub.github.io/posts/5e1f3fb0.html"/>
    <id>https://llye-hub.github.io/posts/5e1f3fb0.html</id>
    <published>2023-03-21T09:02:06.000Z</published>
    <updated>2023-03-29T03:43:07.272Z</updated>
    
    <content type="html"><![CDATA[<p><strong>参考文章</strong><br><a href="https://www.cnblogs.com/qixing/p/14017875.html">Spark3.0.1各种集群模式搭建及spark on yarn日志配置</a><br><a href="https://www.jianshu.com/p/aa6f3a366727">Spark on Yarn集群搭建详细过程</a></p><h1 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h1><p>jdk8+Hadoop3.3.1 </p><h1 id="spark的几种部署方式"><a href="#spark的几种部署方式" class="headerlink" title="spark的几种部署方式"></a>spark的几种部署方式</h1><p>Spark作为准实时大数据计算引擎，Spark的运行需要依赖资源调度和任务管理，Spark自带了standalone模式资源调度和任务管理工具，运行在其他资源管理和任务调度平台上，如Yarn、Mesos、Kubernates容器等。</p><p>spark的搭建和Hadoop差不多，主要有下面几种部署方式：</p><ul><li><p>Local：多用于本地测试，如在eclipse，idea中写程序测试等。</p></li><li><p>Standalone：Standalone是Spark自带的一个资源调度框架，它支持完全分布式。</p></li><li><p>Yarn：Hadoop生态圈里面的一个资源调度框架，Spark也是可以基于Yarn来计算的。</p></li></ul><p>基于个人学习需求，本文仅记录Local模式部署过程。</p><h1 id="下载spark源码"><a href="#下载spark源码" class="headerlink" title="下载spark源码"></a>下载spark源码</h1><p><a href="https://archive.apache.org/dist/spark/">下载地址</a></p><p><strong>解压</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -zcvf spark-3.2.0-bin-hadoop3.2.tgz</span><br></pre></td></tr></table></figure><p><strong>配置环境变量</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">编辑</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">SPARK_HOME=/Users/llye/workspace/spark-3.2.0-bin-hadoop3.2</span> </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">export</span> PATH=<span class="variable">$SPARK_HOME</span>/bin:<span class="variable">$PATH</span></span></span><br><span class="line">vi ~/.bash_profile </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">生效</span></span><br><span class="line">source ~/.bash_profile</span><br></pre></td></tr></table></figure><h1 id="本地local模式"><a href="#本地local模式" class="headerlink" title="本地local模式"></a>本地local模式</h1><p><strong>测试样例</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd $SPARK_HOME/bin </span><br><span class="line">run-example SparkPi 10  # 可计算出结果</span><br></pre></td></tr></table></figure><p><img src="https://i.328888.xyz/2023/03/24/iV6lXq.png" alt="iV6lXq.png"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spark-shell  # 启动成功，说明Local模式部署成功</span><br></pre></td></tr></table></figure><p><img src="https://i.328888.xyz/2023/03/24/iV6HUw.png" alt="iV6HUw.png"></p><p>启动成功后，访问<code>http://localhost:4040/</code> 即可进行web UI监控页面访问</p><h1 id="standalone模式未完成不具参考性"><a href="#Standalone模式（未完成，不具参考性）" class="headerlink" title="Standalone模式（未完成，不具参考性）"></a>Standalone模式（未完成，不具参考性）</h1><p>配置Spark on Yarn集群</p><p><strong>修改spark-env.sh文件</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">cd $SPARK_HOME/conf</span><br><span class="line">cat &gt; spark-env.sh &lt;&lt; EOF</span><br><span class="line">JAVA_HOME=/Library/Java/JavaVirtualMachines/jdk1.8.0_301.jdk/Contents/Home/</span><br><span class="line">SCALA_HOME=/Users/llye/soft/scala/</span><br><span class="line">HADOOP_HOME=/Users/llye/soft/hadoop-3.3.1/</span><br><span class="line">HADOOP_CONF_DIR=/Users/llye/soft/hadoop-3.3.1/etc/hadoop/</span><br><span class="line">YARN_CONF_DIR=/Users/llye/soft/hadoop-3.3.1/etc/hadoop/etc/hadoop/</span><br><span class="line">SPARK_MASTER_HOST=spark    # 主节点机器名称</span><br><span class="line">SPARK_MASTER_PORT=7077     # 默认端口号7077</span><br><span class="line">SPARK_HOME=/Users/llye/workspace/spark-3.2.0-bin-hadoop3.2/</span><br><span class="line">SPARK_LOCAL_DIRS=/Users/llye/workspace/spark-3.2.0-bin-hadoop3.2/</span><br><span class="line">SPARK_LIBARY_PATH=/Library/Java/JavaVirtualMachines/jdk1.8.0_301.jdk/Contents/Home/lib/:/Users/llye/soft/hadoop-3.3.1/lib/native/</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><p><strong>修改slaves配置文件</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cd $SPARK_HOME/sbin </span><br><span class="line">vi slaves</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">spark001</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">spark002</span></span><br></pre></td></tr></table></figure><p><strong>将spark目录发送到其他机器</strong></p><p>创建workers文件，指定Worker节点：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cd $SPARK_HOME/conf</span><br><span class="line">cat &gt; workers &lt;&lt; EOF</span><br><span class="line">worker1</span><br><span class="line">worker2</span><br><span class="line">worker3</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><h1 id="启动spark-on-yarn集群"><a href="#启动Spark-on-Yarn集群" class="headerlink" title="启动Spark on Yarn集群"></a>启动Spark on Yarn集群</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd $SPARK_HOME/sbin</span><br></pre></td></tr></table></figure><p>在Spark节点上启动Spark Master节点：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">start-master.sh</span><br></pre></td></tr></table></figure><p>在Worker节点上启动Spark Worker节点：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">start-worker.sh spark://spark:7077</span><br></pre></td></tr></table></figure><h1 id="登录spark-on-yarn集群"><a href="#登录Spark-on-Yarn集群" class="headerlink" title="登录Spark on Yarn集群"></a>登录Spark on Yarn集群</h1><p>登录Master：</p><p>登录Worker：<code>http://localhost:8081/</code></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;strong&gt;参考文章&lt;/strong&gt;&lt;br&gt;&lt;a href=&quot;https://www.cnblogs.com/qixing/p/14017875.html&quot;&gt;Spark3.0.1各种集群模式搭建及spark on yarn日志配置&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;ht</summary>
      
    
    
    
    <category term="spark" scheme="https://llye-hub.github.io/categories/spark/"/>
    
    
    <category term="spark on yarn" scheme="https://llye-hub.github.io/tags/spark-on-yarn/"/>
    
  </entry>
  
  <entry>
    <title>hive本机安装</title>
    <link href="https://llye-hub.github.io/posts/47d5b7b0.html"/>
    <id>https://llye-hub.github.io/posts/47d5b7b0.html</id>
    <published>2023-03-15T02:49:23.000Z</published>
    <updated>2023-05-05T03:32:22.681Z</updated>
    
    <content type="html"><![CDATA[<p><strong>参考文章</strong></p><p><a href="https://zhuanlan.zhihu.com/p/68748400">Hive源码系列（一）hive2.1.1+hadoop2.7.3环境搭建</a></p><p><a href="https://juejin.cn/post/7114252763621490719">Hive安装超详细教程</a></p><p><a href="https://www.cnblogs.com/swordfall/p/13426569.html#auto_id_14">Hive架构与源码分析</a></p><p><a href="https://datavalley.github.io/2015/10/16/Hive%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90%E4%B9%8B%E6%9C%AC%E5%9C%B0%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA">Hive:源码解析之本地环境搭建</a></p><h1 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h1><p>jdk8 + Hadoop3.3.1</p><h1 id="下载安装"><a href="#下载安装" class="headerlink" title="下载安装"></a>下载安装</h1><p><a href="https://dlcdn.apache.org/hive/">下载地址</a></p><p><strong>解压安装包</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf apache-hive-2.3.9-bin.tar.gz</span><br></pre></td></tr></table></figure><p><strong>环境变量配置</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">编辑</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">HIVE_HOME=/Users/llye/soft/hive-2.3.9</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">export</span> PATH=<span class="variable">$HIVE_HOME</span>/bin:<span class="variable">$PATH</span></span></span><br><span class="line">vi ~/.bash_profile </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">生效</span></span><br><span class="line">source ~/.bash_profile</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">验证</span></span><br><span class="line">hive --version</span><br></pre></td></tr></table></figure><p><strong>修改配置文件</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd $HIVE_HOME/conf</span><br></pre></td></tr></table></figure><p><code>vi hive-site.xml</code>编辑内容如下：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--  以mysql作为hive元数据库  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>javax.jdo.option.ConnectionURL<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>jdbc:mysql://localhost:3306/hivedb?createDatabaseIfNotExist=true<span class="symbol">&amp;amp;</span>characterEncoding=UTF-8<span class="symbol">&amp;amp;</span>useSSL=false<span class="symbol">&amp;amp;</span>serverTimezone=GMT<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span>hive metastore连接串<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>javax.jdo.option.ConnectionDriverName<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>com.mysql.cj.jdbc.Driver<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span>Hive metastore JDBC驱动<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>javax.jdo.option.ConnectionUserName<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>root<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span>Mysql登录账号<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>javax.jdo.option.ConnectionPassword<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>rootroot<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span>Mysql登录密码<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 忽略HIVE 元数据库版本的校验，如果非要校验就得进入MYSQL升级版本 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.metastore.schema.verification<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>false<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.cli.print.current.db<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.cli.print.header<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--  配置hive用户名、密码  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.jdbc_passwd.auth.root<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>rootroot<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.jdbc_passwd.auth.llye<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>rootroot<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- hiveserver2 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--  配置用户安全认证方式  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.server2.authentication<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>NONE<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span></span><br><span class="line">            Expects one of [nosasl, none, ldap, kerberos, pam, custom].</span><br><span class="line">            Client authentication types.</span><br><span class="line">            NONE: no authentication check</span><br><span class="line">            LDAP: LDAP/AD based authentication</span><br><span class="line">            KERBEROS: Kerberos/GSSAPI authentication</span><br><span class="line">            CUSTOM: Custom authentication provider</span><br><span class="line">            (Use with property hive.server2.custom.authentication.class)</span><br><span class="line">            PAM: Pluggable authentication module</span><br><span class="line">            NOSASL:  Raw transport</span><br><span class="line">        <span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.server2.custom.authentication.class<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>org.apache.hadoop.hive.contrib.auth.CustomPasswdAuthenticator<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span>配置用于权限认证的类【这里实际没有】<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 指定 hiveserver2 jdbc连接的 host+port --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.server2.thrift.bind.host<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>localhost<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span>hiveserver2 jdbc连接的 host<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.server2.thrift.port<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>10000<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">description</span>&gt;</span>hiveserver2 jdbc连接的端口号<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--  配置webUI界面 host+port  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.server2.webui.host<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>localhost<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.server2.webui.port<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>10002<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>下载连接MySQL的驱动包到hive的lib目录下</strong></p><p><code>mysql-connector-java-8.0.17.jar</code><a href="https://repo1.maven.org/maven2/mysql/mysql-connector-java/8.0.17/mysql-connector-java-8.0.17.jar">下载地址</a></p><p><strong>初始化hive元数据库</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd $HIVE_HOME/bin</span><br><span class="line">schematool -initSchema -dbType mysql -verbose</span><br></pre></td></tr></table></figure><p><strong>验证初始化是否成功</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- mysql的hivedb库中，若展示多个数据表，即代表初始化成功</span></span><br><span class="line"><span class="keyword">show</span> tables;</span><br></pre></td></tr></table></figure><p><img src="https://i.328888.xyz/2023/03/15/JxW5E.png" alt="JxW5E.png"></p><p><strong>启动hive</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$</span><span class="language-bash">HADOOP_HOME/sbin/start-dfs.sh &amp;</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">HADOOP_HOME/sbin/start-yarn.sh</span></span><br><span class="line">cd $HIVE_HOME </span><br><span class="line">hive </span><br></pre></td></tr></table></figure><p>遇到启动报错<code>org.apache.hadoop.hdfs.server.namenode.SafeModeException): Cannot create directory /tmp/hive</code>时，执行命令<code>hdfs dfsadmin -safemode leave</code>关闭HDFS安全模式</p><p><strong>验证</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 建表</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> student(id <span class="type">int</span>, name string);</span><br><span class="line"><span class="comment">-- 插入数据</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">table</span> student <span class="keyword">values</span>(<span class="number">1</span>, <span class="string">&#x27;abc&#x27;</span>);</span><br><span class="line"><span class="comment">-- 查询数据</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> student;</span><br></pre></td></tr></table></figure><p><img src="https://i.328888.xyz/2023/03/15/J73cF.png" alt="J73cF.png"></p><h1 id="beeline连接hiveserver2"><a href="#beeline连接hiveserver2" class="headerlink" title="beeline连接hiveserver2"></a>beeline连接hiveserver2</h1><p><strong>hadoop配置</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd $HADOOP_HOME/etc/hadoop</span><br></pre></td></tr></table></figure><p><code>vi core-site.xml</code>补充内容如下：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>hadoop.proxyuser.root.groups<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>*<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>hadoop.proxyuser.root.hosts<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>*<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>hadoop.proxyuser.llye.groups<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>*<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>hadoop.proxyuser.llye.hosts<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>*<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>重启hadoop</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$</span><span class="language-bash">HADOOP_HOME/sbin/stop-all.sh &amp;</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">HADOOP_HOME/sbin/start-all.sh</span> </span><br></pre></td></tr></table></figure><p><strong>启动metastore</strong></p><p>配置了hive的环境变量，任意文件夹下执行即可</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive --service metastore</span><br></pre></td></tr></table></figure><p><strong>启动hiveserver2</strong></p><p>配置了hive的环境变量，任意文件夹下执行即可</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hiveserver2</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">或</span></span><br><span class="line">hive --service hiveserver2</span><br></pre></td></tr></table></figure><p>若<code>hiveserver2</code>启动失败，检查1000端口是否被占用，命令<code>lsof -i:10000</code>和<code>kill -9 xxx</code></p><p><strong>beeline连接</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">beeline</span><br><span class="line"><span class="meta prompt_">beeline&gt; </span><span class="language-bash">!connect jdbc:hive2://localhost:10000/default</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">或</span></span><br><span class="line">beeline -u jdbc:hive2://localhost:10000/default </span><br></pre></td></tr></table></figure><p>遇到报错问题的参考：</p><p><a href="https://blog.csdn.net/qq_16633405/article/details/82190440">beeline连接hiveserver2报错：User: root is not allowed to impersonate root</a></p><p><a href="https://developer.aliyun.com/article/606803">Hive JDBC：Permission denied: user&#x3D;anonymous, access&#x3D;EXECUTE, inode&#x3D;”&#x2F;tmp”</a></p><h1 id="客户端jdbc连接hive库"><a href="#客户端jdbc连接hive库" class="headerlink" title="客户端jdbc连接hive库"></a>客户端jdbc连接hive库</h1><p><strong>启动metastore和hiveserver2</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">hive --service metastore</span><br><span class="line"></span><br><span class="line">hiveserver2</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">或</span></span><br><span class="line">hive --service hiveserver2</span><br></pre></td></tr></table></figure><p><code>DBeaver</code>连接，设置jdbc URL：<code>jdbc:hive2://localhost:10000/default</code></p><h1 id="hive源码编译"><a href="#hive源码编译" class="headerlink" title="hive源码编译"></a>hive源码编译</h1><p><strong>解压安装包</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf apache-hive-2.3.9-src.tar.gz</span><br></pre></td></tr></table></figure><p><strong>编译源码</strong></p><p>进入解压目录</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn clean package -DskipTests -Phadoop-2 -Pdist</span><br></pre></td></tr></table></figure><p>编译过程中报错<code>An error has occurred in JavaDocs report generation:Exit code: 1 - javadoc: error - invalid flag: -author</code>，<a href="https://stackoverflow.com/questions/19181236/an-error-has-occurred-in-javadocs-report-generationexit-code-1-javadoc-erro">解决方案</a>:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-javadoc-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;maven.javadoc.plugin.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span>&gt;</span>resourcesdoc.xml<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">goal</span>&gt;</span>javadoc<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">phase</span>&gt;</span>compile<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoding</span>&gt;</span>$&#123;project.build.sourceEncoding&#125;<span class="tag">&lt;/<span class="name">encoding</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">verbose</span>&gt;</span>true<span class="tag">&lt;/<span class="name">verbose</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">show</span>&gt;</span>public<span class="tag">&lt;/<span class="name">show</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">doclet</span>&gt;</span>com.sun.jersey.wadl.resourcedoc.ResourceDoclet<span class="tag">&lt;/<span class="name">doclet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">docletArtifacts</span>&gt;</span></span><br><span class="line">          ……</span><br><span class="line">        <span class="tag">&lt;/<span class="name">docletArtifacts</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">additionalparam</span>&gt;</span>-output $&#123;project.build.outputDirectory&#125;/resourcedoc.xml<span class="tag">&lt;/<span class="name">additionalparam</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--  pom文件中加上此项配置  --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">useStandardDocletOptions</span>&gt;</span>false<span class="tag">&lt;/<span class="name">useStandardDocletOptions</span>&gt;</span>   </span><br><span class="line">      <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>导入idea</strong></p><p>从hive的解压目录中选择pom.xml文件导入</p><p><strong>调试代码</strong></p><p>进入解压目录</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd  packaging/target/apache-hive-2.3.9-bin/apache-hive-2.3.9-bin</span><br><span class="line"></span><br><span class="line">hive --debug -hiveconf hive.root.logger=DEBUG,console</span><br></pre></td></tr></table></figure><p>成功时，界面出现：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Listening for transport dt_socket at address: 8000</span><br></pre></td></tr></table></figure><p>JVM会监听8000端口，等待客户端调试连接。</p><p>进入idea配置远程连接如下：<br><img src="https://i.328888.xyz/2023/03/20/Pz9vq.png" alt="Pz9vq.png"></p><p>hive的CLI的入口类为：<code>src/java/org/apache/hadoop/hive/cli/CliDriver.java</code>，断点调试成功如下：<br><img src="https://i.328888.xyz/2023/03/20/PFA3q.png" alt="PFA3q.png"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;strong&gt;参考文章&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/68748400&quot;&gt;Hive源码系列（一）hive2.1.1+hadoop2.7.3环境搭建&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;htt</summary>
      
    
    
    
    <category term="hive" scheme="https://llye-hub.github.io/categories/hive/"/>
    
    
    <category term="hive安装" scheme="https://llye-hub.github.io/tags/hive%E5%AE%89%E8%A3%85/"/>
    
  </entry>
  
  <entry>
    <title>hadoop本机安装</title>
    <link href="https://llye-hub.github.io/posts/2cb81866.html"/>
    <id>https://llye-hub.github.io/posts/2cb81866.html</id>
    <published>2023-03-15T02:49:02.000Z</published>
    <updated>2023-05-05T02:56:45.176Z</updated>
    
    <content type="html"><![CDATA[<p><strong>参考文章</strong></p><p><a href="https://zhuanlan.zhihu.com/p/68748400">Hive源码系列（一）hive2.1.1+hadoop2.7.3环境搭建</a></p><p><a href="https://cloud.tencent.com/developer/article/1708064">Hadoop【单机安装-测试程序WordCount】</a></p><p>Hadoop 安装有三种方式：</p><p><code>单机模式</code>：安装简单，几乎不用做任何配置，但仅限于调试用途；</p><p><code>伪分布模式</code>：在单节点上同时启动 NameNode、DataNode、JobTracker、TaskTracker、Secondary Namenode 等 5 个进程，模拟分布式运行的各个节点；</p><p><code>完全分布式模式</code>：正常的 Hadoop 集群，由多个各司其职的节点构成。</p><p>本人选择的是<code>伪分布模式</code>安装</p><p><strong>下载安装</strong></p><p><a href="https://hadoop.apache.org/">下载地址</a></p><ul><li>解压安装包</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf hadoop-3.3.1.tar.gz</span><br></pre></td></tr></table></figure><p><strong>环境变量配置</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">编辑</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">HADOOP_HOME=/Users/llye/soft/hadoop-3.3.1</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">export</span> PATH=<span class="variable">$HADOOP_HOME</span>/bin:<span class="variable">$PATH</span></span></span><br><span class="line">vi ~/.bash_profile </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">生效</span></span><br><span class="line">source ~/.bash_profile</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">验证</span></span><br><span class="line">hadoop version</span><br></pre></td></tr></table></figure><p><strong>修改配置文件</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd $HADOOP_HOME/etc/hadoop</span><br></pre></td></tr></table></figure><p><code>vi core-site.xml</code>编辑内容如下：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 配置分布式文件系统的schema和ip以及port,默认8020--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>fs.defaultFS<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>hdfs://localhost:8020<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><p><code>vi hdfs-site.xml</code>编辑内容如下：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 配置副本数，注意，伪分布模式只能是1。--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.replication<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>1<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><p><code>vi hadoop-env.sh</code>编辑内容如下：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export JAVA_HOME=/Library/Java/JavaVirtualMachines/jdk1.8.0_301.jdk/Contents/Home</span><br></pre></td></tr></table></figure><p><code>vi mapred-site.xml</code>编辑内容如下：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.framework.name<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>yarn<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.app.mapreduce.am.env<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>HADOOP_MAPRED_HOME=$&#123;HADOOP_HOME&#125;<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.map.env<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>HADOOP_MAPRED_HOME=$&#123;HADOOP_HOME&#125;<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.reduce.env<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>HADOOP_MAPRED_HOME=$&#123;HADOOP_HOME&#125;<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><p><code>vi yarn-site.xml</code>编辑内容如下：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- Site specific YARN configuration properties --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.aux-services<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>mapreduce_shuffle<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>ssh免密码登录</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa -P &#x27;&#x27; -f ~/.ssh/id_rsa</span><br><span class="line">cat ~/.ssh/id_rsa.pub&gt;&gt; ~/.ssh/authorized_keys</span><br><span class="line">chmod 0600~/.ssh/authorized_keys</span><br></pre></td></tr></table></figure><p>以前安装其他软件已操作过，所以此步骤忽略</p><p><strong>格式化namenode</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hdfs namenode -format</span><br></pre></td></tr></table></figure><p>忽略<code>SHUTDOWN_MSG: Shutting down NameNode at localhost/127.0.0.1</code></p><p>有<code>INFO common.Storage: Storage directory /tmp/hadoop-llye/dfs/name has been successfully formatted.</code>即说明操作成功。</p><p><strong>启动</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$</span><span class="language-bash">HADOOP_HOME/sbin/start-dfs.sh &amp;</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">HADOOP_HOME/sbin/start-yarn.sh</span></span><br></pre></td></tr></table></figure><p><strong>验证</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">root@localhost hadoop % jps</span><br><span class="line">11440 </span><br><span class="line">11169 </span><br><span class="line">74514 NameNode # 名称节点</span><br><span class="line">74756 SecondaryNameNode</span><br><span class="line">74999 ResourceManager</span><br><span class="line">75098 NodeManager</span><br><span class="line">75834 Jps</span><br><span class="line">19771 Launcher</span><br><span class="line">74620 DataNode  # 数据节点</span><br></pre></td></tr></table></figure><p><strong>访问UI：ip+port</strong></p><p>All Applications：<code>http://localhost:8088/cluster/apps</code></p><p>Applications running on this node：<code>http://localhost:8042/node/allApplications</code><br><img src="https://i.328888.xyz/2023/03/15/JCU0J.png" alt="JCU0J.png"></p><p>Browse Hdfs：<code>http://localhost:9870/</code><br><img src="https://i.328888.xyz/2023/03/15/J0HkZ.png" alt="J0HkZ.png"></p><p>这里需要注意的是，因为安装的是3.x版本，所以端口号为9870</p><p>若安装的是2.x版本，则端口号为50070</p><p><img src="https://i.328888.xyz/2023/03/15/J0ehd.png" alt="J0ehd.png"></p><p><strong>测试程序</strong></p><ul><li>测试一</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd $HADOOP_HOME</span><br><span class="line">hadoop jar share/hadoop/mapreduce/hadoop-mapreduce-examples-3.3.1.jar pi 2 100</span><br></pre></td></tr></table></figure><ul><li>测试二</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">cd $HADOOP_HOME</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建一个hdfs目录</span></span><br><span class="line">hdfs dfs -mkdir /wordcount</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">造数据</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">hello hadoop</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">hello world</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">hello hadoop</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">hello hangzhou</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">hello hangzhou</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">hello hadoop</span></span><br><span class="line">mkdir wordCount</span><br><span class="line">cd wordCount</span><br><span class="line">touch wc.input</span><br><span class="line">vi wc.input</span><br><span class="line">cat wc.input</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">上传本地文件到指定目录</span></span><br><span class="line">hdfs dfs -put wc.input /wordcount</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">运行mr程序</span></span><br><span class="line">cd $HADOOP_HOME</span><br><span class="line">hadoop jar share/hadoop/mapreduce/hadoop-mapreduce-examples-3.3.1.jar wordcount /wordcount/ /wordcount/output</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看mr计算结果</span></span><br><span class="line">hadoop fs -cat /wordcount/output/part-r-00000</span><br></pre></td></tr></table></figure><p><strong>停止</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$</span><span class="language-bash">HADOOP_HOME/sbin/stop-dfs.sh &amp;</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">HADOOP_HOME/sbin/stop-yarn.sh</span></span><br></pre></td></tr></table></figure><p><strong>补充：hadoop启动会遇到的问题</strong></p><ul><li>namenode启动失败，使用<code>jps</code>命令查看时无namenode进程</li></ul><p>解决办法：</p><ol><li>执行命令<code>hdfs namenode -format</code>重新格式化namenode</li><li>执行命令<code>hadoop-daemon.sh start namenode</code>单独启动namenode，若是其他哪个进程挂了也可以采取这种方式。（本地尚未试过这种解决方式）</li><li>修改<code>core-site.xml</code>和<code>hdfs-site.xml</code>配置，再重新格式化namenode。因为系统重启后namenode和datanode的信息被清理了</li></ol><p><code>core-site.xml</code>补充配置如下：</p><pre><code class="xml">&lt;property&gt;&lt;name&gt;hadoop.tmp.dir&lt;/name&gt;&lt;value&gt;/Users/llye/hadoop/tmp&lt;/value&gt;&lt;description&gt;Abase for other temporary directories.&lt;/description&gt;&lt;/property&gt;</code></pre><p><code>hdfs-site.xml</code>补充配置如下：</p><pre><code class="xml">&lt;property&gt;    &lt;name&gt;dfs.namenode.name.dir&lt;/name&gt;    &lt;value&gt;/Users/llye/hadoop/tmp/dfs/name&lt;/value&gt;&lt;/property&gt;&lt;property&gt;    &lt;name&gt;dfs.datanode.data.dir&lt;/name&gt;    &lt;value&gt;/Users/llye/hadoop/tmp/dfs/data&lt;/value&gt;&lt;/property&gt;</code></pre><p>若执行命令<code>hdfs namenode -format</code>报错：<br><img src="https://i.328888.xyz/2023/05/05/iTZ6qL.png" alt="iTZ6qL.png"><br>上面报错原因是权限不够，无法再目录内新建文件，解决办法是执行命令<code>sudo chmod -R a+w /Users/llye/hadoop</code>，再格式化namenode就ok了。</p><p>修改配置后，系统启动后会默认路径下的文件作为namenode、datanode的配置信息</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;strong&gt;参考文章&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/68748400&quot;&gt;Hive源码系列（一）hive2.1.1+hadoop2.7.3环境搭建&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;htt</summary>
      
    
    
    
    <category term="hadoop" scheme="https://llye-hub.github.io/categories/hadoop/"/>
    
    
    <category term="hadoop安装" scheme="https://llye-hub.github.io/tags/hadoop%E5%AE%89%E8%A3%85/"/>
    
  </entry>
  
  <entry>
    <title>终端常用命令汇总</title>
    <link href="https://llye-hub.github.io/posts/84fddb38.html"/>
    <id>https://llye-hub.github.io/posts/84fddb38.html</id>
    <published>2023-03-15T02:29:05.000Z</published>
    <updated>2023-03-21T08:09:18.234Z</updated>
    
    <content type="html"><![CDATA[<h1 id="获取本机ip地址"><a href="#获取本机ip地址" class="headerlink" title="获取本机ip地址"></a>获取本机ip地址</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/sh</span></span><br><span class="line">local_ip=`ifconfig -a|grep inet|grep -v 127.0.0.1|grep -v inet6|awk &#x27;&#123;print $2&#125;&#x27;|tr -d &quot;addr:&quot;​`</span><br><span class="line">echo &quot;$&#123;local_ip&#125;&quot;</span><br><span class="line"></span><br><span class="line">ifconfig -a        //和window下执行此命令一样道理，返回本机所有ip信息</span><br><span class="line">grep inet    //截取包含ip的行</span><br><span class="line">grep -v 127.0.0.1//去掉本地指向的那行</span><br><span class="line">grep -v inet6//去掉包含inet6的行</span><br><span class="line">awk &#123; print $2&#125;//$2 表示默认以空格分割的第二组 同理 $1表示第一组​</span><br><span class="line">tr -d &quot;addr:&quot;//删除&quot;addr:&quot;这个字符串</span><br></pre></td></tr></table></figure><p><a href="https://blog.csdn.net/finghting321/article/details/108476650">https://blog.csdn.net/finghting321/article/details/108476650</a></p><h1 id="查找文件"><a href="#查找文件" class="headerlink" title="查找文件"></a>查找文件</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find / -iname $filename 2&gt;  /dev/null</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;获取本机ip地址&quot;&gt;&lt;a href=&quot;#获取本机ip地址&quot; class=&quot;headerlink&quot; title=&quot;获取本机ip地址&quot;&gt;&lt;/a&gt;获取本机ip地址&lt;/h1&gt;&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td cl</summary>
      
    
    
    
    <category term="shell" scheme="https://llye-hub.github.io/categories/shell/"/>
    
    
    <category term="shell命令" scheme="https://llye-hub.github.io/tags/shell%E5%91%BD%E4%BB%A4/"/>
    
  </entry>
  
  <entry>
    <title>终端免密登录mysql</title>
    <link href="https://llye-hub.github.io/posts/b31f5f52.html"/>
    <id>https://llye-hub.github.io/posts/b31f5f52.html</id>
    <published>2023-03-14T07:29:49.000Z</published>
    <updated>2023-03-14T08:04:15.277Z</updated>
    
    <content type="html"><![CDATA[<p>参考资料：<a href="https://aijishu.com/a/1060000000088457">Mysql Shell免密登录的思考及实际应用案例</a></p><p>常见终端登录mysql的方式是通过命令<code>mysql -u&#123;user&#125; -p&#123;password&#125;</code>，每次登录都需要输入一长串命令和参数，我觉得麻烦，且这种方式下密码直接暴露出来是不安全的</p><p>虽然也可用命令<code>mysql -u&#123;user&#125; -p</code> + 手动输入密码，也是麻烦的，而且还要记密码</p><p>所以，如果仅用命令<code>mysql</code>即可实现登录，那得多方便</p><p>从网上搜索后发现，可以通过明文配置文件的方式实现mysql免密登录</p><p>具体命令如下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">编辑配置文件</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">[mysql]</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">user=xxx</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">password=xxx</span></span><br><span class="line">sudo vi /etc/my.cnf</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看文件内容</span></span><br><span class="line">cat  /etc/my.cnf</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">指定mysql server仅从这个配置文件读取参数</span></span><br><span class="line">mysql --defaults-file=/etc/my.cnf</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">验证读取配置情况</span></span><br><span class="line">mysql --defaults-file=/etc/my.cnf --print-defaults</span><br></pre></td></tr></table></figure><p><img src="https://i.328888.xyz/2023/03/14/9EVXa.png" alt="9EVXa.png"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;参考资料：&lt;a href=&quot;https://aijishu.com/a/1060000000088457&quot;&gt;Mysql Shell免密登录的思考及实际应用案例&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;常见终端登录mysql的方式是通过命令&lt;code&gt;mysql -u&amp;#123;user&amp;#1</summary>
      
    
    
    
    <category term="shell" scheme="https://llye-hub.github.io/categories/shell/"/>
    
    
    <category term="免密登录" scheme="https://llye-hub.github.io/tags/%E5%85%8D%E5%AF%86%E7%99%BB%E5%BD%95/"/>
    
  </entry>
  
  <entry>
    <title>sql练习之连续登录问题</title>
    <link href="https://llye-hub.github.io/posts/67cc9ac.html"/>
    <id>https://llye-hub.github.io/posts/67cc9ac.html</id>
    <published>2023-03-10T08:22:38.000Z</published>
    <updated>2023-03-14T08:04:15.277Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://mp.weixin.qq.com/s?__biz=MzU5NTc1NzE2OA==&mid=2247484833&idx=1&sn=2a965091ec5ec09fe10185fecbf92779&chksm=fe6c54bec91bdda83229a33ceefb0358f408ed24ac5048eb48dbe6911b795b1536971a98ab57&scene=21#wechat_redirect">题目来源</a></p><h1 id="题目要求"><a href="#题目要求" class="headerlink" title="题目要求"></a>题目要求</h1><p>求出连续3天登录的用户id</p><h1 id="数据"><a href="#数据" class="headerlink" title="数据"></a>数据</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> if <span class="keyword">not</span> <span class="keyword">exists</span> one.user_login(</span><br><span class="line">     id <span class="type">int</span> COMMENT <span class="string">&#x27;用户主键&#x27;</span>,</span><br><span class="line">     dt <span class="type">varchar</span>(<span class="number">20</span>) COMMENT <span class="string">&#x27;登录日期&#x27;</span></span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span>  user_login <span class="keyword">values</span>(<span class="number">1001</span>,<span class="string">&#x27;2021-12-12&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span>  user_login <span class="keyword">values</span>(<span class="number">1002</span>,<span class="string">&#x27;2021-12-12&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span>  user_login <span class="keyword">values</span>(<span class="number">1001</span>,<span class="string">&#x27;2021-12-13&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span>  user_login <span class="keyword">values</span>(<span class="number">1001</span>,<span class="string">&#x27;2021-12-14&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span>  user_login <span class="keyword">values</span>(<span class="number">1001</span>,<span class="string">&#x27;2021-12-16&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span>  user_login <span class="keyword">values</span>(<span class="number">1002</span>,<span class="string">&#x27;2021-12-16&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span>  user_login <span class="keyword">values</span>(<span class="number">1001</span>,<span class="string">&#x27;2021-12-19&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span>  user_login <span class="keyword">values</span>(<span class="number">1002</span>,<span class="string">&#x27;2021-12-17&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span>  user_login <span class="keyword">values</span>(<span class="number">1001</span>,<span class="string">&#x27;2021-12-20&#x27;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="解题"><a href="#解题" class="headerlink" title="解题"></a>解题</h1><h2 id="解法一自关联"><a href="#解法一：自关联" class="headerlink" title="解法一：自关联"></a>解法一：自关联</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line"><span class="keyword">distinct</span> id</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">(</span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">id</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">(</span><br><span class="line"><span class="keyword">select</span></span><br><span class="line">a.id ,</span><br><span class="line">a.dt <span class="keyword">as</span> dt1 ,</span><br><span class="line">b.dt <span class="keyword">as</span> dt2</span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">user_login a</span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span> user_login b <span class="keyword">on</span></span><br><span class="line">a.id <span class="operator">=</span> b.id</span><br><span class="line"><span class="keyword">and</span> (b.dt <span class="keyword">between</span> DATE_SUB(a.dt, <span class="type">interval</span> <span class="number">2</span> <span class="keyword">day</span>) <span class="keyword">and</span> a.dt)</span><br><span class="line">) tmp1</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span></span><br><span class="line">id,</span><br><span class="line">dt1</span><br><span class="line"><span class="keyword">having</span></span><br><span class="line"><span class="built_in">count</span>(<span class="number">1</span>) <span class="operator">=</span> <span class="number">3</span></span><br><span class="line">)tmp2</span><br><span class="line">;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;a href=&quot;https://mp.weixin.qq.com/s?__biz=MzU5NTc1NzE2OA==&amp;mid=2247484833&amp;idx=1&amp;sn=2a965091ec5ec09fe10185fecbf92779&amp;chksm=fe6c54bec91bdda</summary>
      
    
    
    
    <category term="题集" scheme="https://llye-hub.github.io/categories/%E9%A2%98%E9%9B%86/"/>
    
    
    <category term="sql练习" scheme="https://llye-hub.github.io/tags/sql%E7%BB%83%E4%B9%A0/"/>
    
  </entry>
  
  <entry>
    <title>SQL之窗口函数的边界</title>
    <link href="https://llye-hub.github.io/posts/5af52219.html"/>
    <id>https://llye-hub.github.io/posts/5af52219.html</id>
    <published>2023-02-28T08:25:40.000Z</published>
    <updated>2023-03-01T07:30:20.176Z</updated>
    
    <content type="html"><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>窗口函数常用于在SQL数据分析计算各种统计指标，也是日常sql开发中常见的函数了，但是最近发现自己在这方面存在一些误解</p><p>比如下面这段sql</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> col1</span><br><span class="line">    ,<span class="built_in">sum</span>(col2) <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> col1 <span class="keyword">order</span> <span class="keyword">by</span> col3) <span class="keyword">as</span> sum1</span><br><span class="line">    ,<span class="built_in">sum</span>(col2) <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> col1) <span class="keyword">as</span> sum2</span><br><span class="line"><span class="keyword">from</span> (<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> (<span class="keyword">VALUES</span>(<span class="string">&#x27;a&#x27;</span>,<span class="number">1</span>,<span class="number">4</span>),(<span class="string">&#x27;a&#x27;</span>,<span class="number">2</span>,<span class="number">7</span>),(<span class="string">&#x27;a&#x27;</span>,<span class="number">3</span>,<span class="number">6</span>)) t(col1,col2,col3)) a</span><br></pre></td></tr></table></figure><p>第一眼感觉<code>sum1</code>和<code>sum2</code>字段计算值是一样的，但实际运行出来的结果为(<code>mysql</code>+<code>hiveSQL</code>)</p><table><thead><tr><th>col1</th><th>sum1</th><th>sum2</th></tr></thead><tbody><tr><td>a</td><td>1</td><td>6</td></tr><tr><td>a</td><td>4</td><td>6</td></tr><tr><td>a</td><td>6</td><td>6</td></tr></tbody></table><p>从执行结果上来看，<code>sum1</code>字段为窗口内的累加值，<code>sum2</code>字段值为窗口内所有值之和</p><h1 id="为什么有无order-by差异这么大"><a href="#为什么有无order-by差异这么大" class="headerlink" title="为什么有无order by差异这么大"></a>为什么有无order by差异这么大</h1><p>有人会说，聚合函数<code>sum()</code>的窗口内有<code>order by</code>子句时，计算结果本就是累加性质。从执行结果上来看，这么说是对的，但是这种解释太流于表面，并没有真正从函数定义上解释为什么</p><p>这里重新回顾下窗口函数基本语法：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&lt;</span>window_function<span class="operator">&gt;</span> <span class="keyword">over</span> (<span class="keyword">partition</span> <span class="keyword">by</span> <span class="operator">&lt;</span>column_name<span class="operator">&gt;</span> <span class="keyword">order</span> <span class="keyword">by</span> <span class="operator">&lt;</span>column_name<span class="operator">&gt;</span> <span class="operator">&lt;</span>window_frame<span class="operator">&gt;</span>)</span><br></pre></td></tr></table></figure><p>主要有四个部分：</p><ul><li>window_function：函数，比如：sum、row_number、first_value</li><li>partition by：窗口分区子句</li><li>order by：窗口排序子句</li><li>window_frame：窗口框架，限制窗口的边界大小</li></ul><p>对照基本语法，有<code>order by</code>子句的执行结果就是计算窗口边界为起始行至当前行的<code>sum</code>结果，<br>即<code>sum(col2) over(partition by col1 order by col3)</code><br>等同于<code>sum(col2) over(partition by col1 order by col3 rows between unbounded preceding and current row)</code> </p><h1 id="窗口函数的官方说明"><a href="#窗口函数的官方说明" class="headerlink" title="窗口函数的官方说明"></a>窗口函数的官方说明</h1><p><a href="https://dev.mysql.com/doc/refman/8.0/en/window-functions-frames.html">mysql官方文档</a> </p><p><a href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual+WindowingAndAnalytics#LanguageManualWindowingAndAnalytics-PARTITIONBYwithonepartitioningcolumn,noORDERBYorwindowspecification">hive官方文档</a></p><p><code>mysql</code>关于窗口函数的window_frame有如下说明：<br><img src="https://i.328888.xyz/2023/03/01/6DIOt.png" alt="6DIOt.png"></p><p><code>hive</code>关于窗口函数的window_frame有如下说明：<br><img src="https://i.328888.xyz/2023/03/01/6DNeJ.png" alt="6DNeJ.png"></p><p>根据以上官方说明可知，<br>当<code>window_frame</code>子句和<code>order by</code>子句都没有时，窗口计算默认包含窗口内的所有数据，即<code>window_frame=ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING</code>；<br>当仅有<code>order by</code>子句，没有<code>window_frame</code>子句时，窗口计算默认仅包含排序后起始行至当前行的数据，即<code>window_frame=ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW</code></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h1&gt;&lt;p&gt;窗口函数常用于在SQL数据分析计算各种统计指标，也是日常sql开发中常见的函数了，但是最近发现自己在这方面存在一些误解&lt;/p&gt;
&lt;p&gt;比如下</summary>
      
    
    
    
    <category term="SQL" scheme="https://llye-hub.github.io/categories/SQL/"/>
    
    
    <category term="窗口函数" scheme="https://llye-hub.github.io/tags/%E7%AA%97%E5%8F%A3%E5%87%BD%E6%95%B0/"/>
    
  </entry>
  
  <entry>
    <title>关于Java PriorityQueue类的使用场景</title>
    <link href="https://llye-hub.github.io/posts/76a5661e.html"/>
    <id>https://llye-hub.github.io/posts/76a5661e.html</id>
    <published>2023-02-23T08:53:35.000Z</published>
    <updated>2023-03-29T03:42:57.496Z</updated>
    
    <content type="html"><![CDATA[<p>最近在leetcode刷题的时候，发现很多题推荐解法是用<strong>优先队列</strong>的特性，比如：<a href="https://leetcode.cn/problems/hua-dong-chuang-kou-de-zui-da-zhi-lcof/">滑动窗口的最大值</a> 、<a href="https://leetcode.cn/problems/chou-shu-lcof/">丑数</a></p><p>以前完全没有用个这个类，所以在此整理一下对优先队列的认识和刷题场景</p><h1 id="优先队列的特性"><a href="#优先队列的特性" class="headerlink" title="优先队列的特性"></a>优先队列的特性</h1><p>很明显，优先队列也是一种队列，只不过其出队顺序和一般队列不同，优先队列的出队顺序是按照一定的优先级来的，也就是说出队规则可以随意定制</p><p>优先队列ADT是一种数据结构，它支持插入、删除最小值操作（返回并删除最小元素）、删除最大值操作（返回并删除最大元素）</p><p>优先队列的主要操作：优先队列是元素的容器，每个元素有一个相关的键值</p><ul><li>insert(key, data)：插入键值为key的数据到优先队列中，元素以其key进行排序</li><li>deleteMin&#x2F;deleteMax：删除并返回最小&#x2F;最大键值的元素</li><li>getMinimum&#x2F;getMaximum：返回最小&#x2F;最大剑指的元素，但不删除它</li></ul><p>优先队列的辅助操作：</p><ul><li>第k最小&#x2F;第k最大：返回优先队列中键值为第k个最小&#x2F;最大的元素</li><li>大小（size）：返回优先队列中的元素个数</li><li>堆排序（Heap Sort）：基于键值的优先级将优先队列中的元素进行排序</li></ul><p>在某些场景下，比如要求队列中的最小元素先出即可用优先队列，在java中的实现类为<code>java.util.PriorityQueue</code>。</p><h1 id="认识下priorityqueue类的方法"><a href="#认识下PriorityQueue类的方法" class="headerlink" title="认识下PriorityQueue类的方法"></a>认识下PriorityQueue类的方法</h1><h2 id="创建对象"><a href="#创建对象" class="headerlink" title="创建对象"></a>创建对象</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 默认情况下，优先级队列的头是队列中最小的元素，元素将按升序从队列中移除</span></span><br><span class="line">PriorityQueue&lt;Integer&gt; nums = <span class="keyword">new</span> <span class="title class_">PriorityQueue</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 借助 Comparator 接口自定义元素的顺序，头是队列中最大的元素，按降序从队列中移除</span></span><br><span class="line">PriorityQueue&lt;<span class="type">int</span>[]&gt; win = <span class="keyword">new</span> <span class="title class_">PriorityQueue</span>&lt;<span class="type">int</span>[]&gt;(<span class="keyword">new</span> <span class="title class_">Comparator</span>&lt;<span class="type">int</span>[]&gt;() &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">compare</span><span class="params">(<span class="type">int</span>[] a, <span class="type">int</span>[] b)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> a[<span class="number">0</span>] != b[<span class="number">0</span>] ? b[<span class="number">0</span>] - a[<span class="number">0</span>] : b[<span class="number">1</span>] - a[<span class="number">1</span>];</span><br><span class="line">        &#125;&#125;);</span><br></pre></td></tr></table></figure><h2 id="插入元素add-offer"><a href="#插入元素：add、offer" class="headerlink" title="插入元素：add、offer"></a>插入元素：add、offer</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建优先队列</span></span><br><span class="line">PriorityQueue&lt;Integer&gt; numbers = <span class="keyword">new</span> <span class="title class_">PriorityQueue</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line"><span class="comment">//使用add()方法，如果队列已满，则会引发异常</span></span><br><span class="line">numbers.add(<span class="number">4</span>);</span><br><span class="line">numbers.add(<span class="number">2</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;PriorityQueue: &quot;</span> + numbers);</span><br><span class="line"></span><br><span class="line"><span class="comment">//使用offer()方法，如果队列已满，则返回false</span></span><br><span class="line">numbers.offer(<span class="number">1</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;更新后的PriorityQueue: &quot;</span> + numbers);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 输出结果：</span></span><br><span class="line"><span class="comment"> * PriorityQueue: [2, 4]</span></span><br><span class="line"><span class="comment"> * 更新后的PriorityQueue: [1, 4, 2]</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * 以上结果中，队列的头是最小元素</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="访问元素peek"><a href="#访问元素：peek" class="headerlink" title="访问元素：peek"></a>访问元素：peek</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//使用 peek() 方法</span></span><br><span class="line"><span class="type">int</span> <span class="variable">number</span> <span class="operator">=</span> nums.peek();</span><br><span class="line">System.out.println(<span class="string">&quot;访问元素: &quot;</span> + number);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 输出结果：</span></span><br><span class="line"><span class="comment"> * 访问元素: 1</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure><h2 id="删除元素remove-poll"><a href="#删除元素：remove、poll" class="headerlink" title="删除元素：remove、poll"></a>删除元素：remove、poll</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//使用remove()方法，从队列中删除指定的元素</span></span><br><span class="line"><span class="type">boolean</span> <span class="variable">result</span> <span class="operator">=</span> numbers.remove(<span class="number">2</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;元素2是否已删除? &quot;</span> + result);</span><br><span class="line"></span><br><span class="line"><span class="comment">//使用poll()方法，返回并删除队列的头</span></span><br><span class="line"><span class="type">int</span> <span class="variable">number</span> <span class="operator">=</span> numbers.poll();</span><br><span class="line">System.out.println(<span class="string">&quot;使用poll()删除的元素: &quot;</span> + number);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 输出结果：</span></span><br><span class="line"><span class="comment"> * 元素2是否已删除? true</span></span><br><span class="line"><span class="comment"> * 使用poll()删除的元素: 1</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure><h2 id="是否包含元素contains"><a href="#是否包含元素：contains" class="headerlink" title="是否包含元素：contains"></a>是否包含元素：contains</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//使用contains()方法，从队列中搜索指定的元素，找到则返回true，否则false。</span></span><br><span class="line"><span class="type">boolean</span> <span class="variable">result</span> <span class="operator">=</span> numbers.contains(<span class="number">4</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;队列中是否有元素 4 ？&quot;</span> + result);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 输出结果：</span></span><br><span class="line"><span class="comment"> * 队列中是否有元素 4 ？ true</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure><h1 id="刷题场景"><a href="#刷题场景" class="headerlink" title="刷题场景"></a>刷题场景</h1><h2 id="滑动窗口的最大值"><a href="#滑动窗口的最大值" class="headerlink" title="滑动窗口的最大值"></a><a href="https://leetcode.cn/problems/hua-dong-chuang-kou-de-zui-da-zhi-lcof/">滑动窗口的最大值</a></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//给定一个数组 nums 和滑动窗口的大小 k，请找出所有滑动窗口里的最大值。 </span></span><br><span class="line"><span class="comment">//示例: </span></span><br><span class="line"><span class="comment">//输入: nums = [1,3,-1,-3,5,3,6,7], 和 k = 3</span></span><br><span class="line"><span class="comment">//输出: [3,3,5,5,6,7] </span></span><br><span class="line"><span class="comment">//解释:</span></span><br><span class="line"><span class="comment">//  滑动窗口的位置                最大值</span></span><br><span class="line"><span class="comment">//---------------               -----</span></span><br><span class="line"><span class="comment">//[1  3  -1] -3  5  3  6  7       3</span></span><br><span class="line"><span class="comment">// 1 [3  -1  -3] 5  3  6  7       3</span></span><br><span class="line"><span class="comment">// 1  3 [-1  -3  5] 3  6  7       5</span></span><br><span class="line"><span class="comment">// 1  3  -1 [-3  5  3] 6  7       5</span></span><br><span class="line"><span class="comment">// 1  3  -1  -3 [5  3  6] 7       6</span></span><br><span class="line"><span class="comment">// 1  3  -1  -3  5 [3  6  7]      7</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Comparator;</span><br><span class="line"><span class="keyword">import</span> java.util.PriorityQueue;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 解题思路：利用优先队列的特性，规定堆顶元素就是窗口最大值</span></span><br><span class="line"><span class="comment"> * */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span>[] maxSlidingWindow(<span class="type">int</span>[] nums, <span class="type">int</span> k) &#123;</span><br><span class="line"><span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> nums.length;</span><br><span class="line">PriorityQueue&lt;<span class="type">int</span>[]&gt; win = <span class="keyword">new</span> <span class="title class_">PriorityQueue</span>&lt;<span class="type">int</span>[]&gt;(<span class="keyword">new</span> <span class="title class_">Comparator</span>&lt;<span class="type">int</span>[]&gt;() &#123;</span><br><span class="line"><span class="comment">// 重新定义出队规则</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">compare</span><span class="params">(<span class="type">int</span>[] a, <span class="type">int</span>[] b)</span> &#123;</span><br><span class="line"><span class="keyword">return</span> a[<span class="number">0</span>] != b[<span class="number">0</span>] ? b[<span class="number">0</span>] - a[<span class="number">0</span>] : b[<span class="number">1</span>] - a[<span class="number">1</span>];</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 初始化窗口</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; k; ++i) &#123;</span><br><span class="line">win.offer(<span class="keyword">new</span> <span class="title class_">int</span>[]&#123;nums[i], i&#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 创建指定长度的结果数组</span></span><br><span class="line"><span class="type">int</span>[] res = <span class="keyword">new</span> <span class="title class_">int</span>[len-k+<span class="number">1</span>];</span><br><span class="line"><span class="comment">// 第一个窗口的最大值</span></span><br><span class="line">res[<span class="number">0</span>] = win.peek()[<span class="number">0</span>];</span><br><span class="line"><span class="comment">// 遍历滑动窗口</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> k; i &lt; len; ++i) &#123;</span><br><span class="line"><span class="comment">// 添加新元素</span></span><br><span class="line">win.offer(<span class="keyword">new</span> <span class="title class_">int</span>[]&#123;nums[i], i&#125;);</span><br><span class="line"><span class="comment">// 删除窗口长度外的元素</span></span><br><span class="line"><span class="keyword">while</span> (win.peek()[<span class="number">1</span>] &lt;= i - k) &#123;</span><br><span class="line">win.poll();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 返回当前窗口的最大值</span></span><br><span class="line">res[i - k + <span class="number">1</span>] = win.peek()[<span class="number">0</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="丑数"><a href="#丑数" class="headerlink" title="丑数"></a><a href="https://leetcode.cn/problems/chou-shu-lcof/">丑数</a></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 我们把只包含质因子 2、3 和 5 的数称作丑数（Ugly Number）。求按从小到大的顺序的第 n 个丑数。</span></span><br><span class="line"><span class="comment">// 示例: </span></span><br><span class="line"><span class="comment">// 输入: n = 10</span></span><br><span class="line"><span class="comment">// 输出: 12</span></span><br><span class="line"><span class="comment">// 解释: 1, 2, 3, 4, 5, 6, 8, 9, 10, 12 是前 10 个丑数。 </span></span><br><span class="line"><span class="comment">// 说明:</span></span><br><span class="line"><span class="comment">// 1 是丑数。 </span></span><br><span class="line"><span class="comment">// n 不超过1690。</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashSet;</span><br><span class="line"><span class="keyword">import</span> java.util.PriorityQueue;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 解题思路：最小堆，需借助java的PriorityQueue类的特性实现：https://www.cainiaojc.com/java/java-priorityqueue.html</span></span><br><span class="line"><span class="comment"> * 初始化堆，将最小丑数1放入堆</span></span><br><span class="line"><span class="comment"> * 每次取出堆顶元素x，x元素也是堆中最小的丑数，需排除重复元素，依次将 2x,3x,5x 加入堆</span></span><br><span class="line"><span class="comment"> * 第n次取出的堆顶元素就是第n个丑数</span></span><br><span class="line"><span class="comment"> * */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">nthUglyNumber</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line"><span class="type">int</span>[] factors = &#123;<span class="number">2</span>,<span class="number">3</span>,<span class="number">5</span>&#125;;</span><br><span class="line">PriorityQueue&lt;Long&gt; heap = <span class="keyword">new</span> <span class="title class_">PriorityQueue</span>&lt;Long&gt;();   <span class="comment">//优先级队列的头是队列中最小的元素</span></span><br><span class="line">heap.offer(<span class="number">1L</span>);     <span class="comment">// 初始化最小堆，放入最小丑数1</span></span><br><span class="line"><span class="type">int</span> <span class="variable">ugly</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>; i&lt;n; i++)&#123;</span><br><span class="line"><span class="type">long</span> <span class="variable">cur</span> <span class="operator">=</span> heap.poll();     <span class="comment">//返回并删除队列的头，即最小元素</span></span><br><span class="line">ugly = (<span class="type">int</span>) cur;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> factor : factors)&#123;</span><br><span class="line"><span class="type">long</span> <span class="variable">next</span> <span class="operator">=</span> cur*factor;</span><br><span class="line"><span class="comment">//检查是否有重复元素</span></span><br><span class="line"><span class="keyword">if</span>(!heap.contains(next))&#123;</span><br><span class="line">heap.offer(next);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> ugly;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="数据流中的中位数"><a href="#数据流中的中位数" class="headerlink" title="数据流中的中位数"></a><a href="https://leetcode.cn/problems/shu-ju-liu-zhong-de-zhong-wei-shu-lcof/solution/shu-ju-liu-zhong-de-zhong-wei-shu-by-lee-um4f/">数据流中的中位数</a></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 解题思路：优先队列</span></span><br><span class="line"><span class="comment">* 利用优先队列的特性实现，队头是最大值</span></span><br><span class="line"><span class="comment">* */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MedianFinder</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 初始化两个优先队列，分别存放 小于等于 和 大于 中位数的数值</span></span><br><span class="line">    PriorityQueue&lt;Integer&gt; queueMin;</span><br><span class="line">    PriorityQueue&lt;Integer&gt; queueMax;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** initialize your data structure here. */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MedianFinder</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// queueMin队头为队列最大值，queueMax对头为队列最小值</span></span><br><span class="line">        queueMin = <span class="keyword">new</span> <span class="title class_">PriorityQueue</span>&lt;Integer&gt;((a,b) -&gt;(b-a));</span><br><span class="line">        queueMax = <span class="keyword">new</span> <span class="title class_">PriorityQueue</span>&lt;Integer&gt;((a,b) -&gt;(a-b));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addNum</span><span class="params">(<span class="type">int</span> num)</span> &#123;</span><br><span class="line">        <span class="comment">// num小于等于中位数，则num放入queueMin队列；num大于中位数，则num放入queueMax队列</span></span><br><span class="line">        <span class="comment">// 注意if条件语句的先后顺序很重要</span></span><br><span class="line">        <span class="keyword">if</span> (queueMin.isEmpty() || num &lt;= queueMin.peek()) &#123;</span><br><span class="line">            queueMin.add(num);</span><br><span class="line">            <span class="comment">// queueMin队列大小超出，则将max(queueMin)元素放入queueMax队列</span></span><br><span class="line">            <span class="keyword">if</span> (queueMin.size() &gt; queueMax.size() + <span class="number">1</span>) &#123;</span><br><span class="line">                queueMax.add(queueMin.poll());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            queueMax.add(num);</span><br><span class="line">            <span class="comment">// queueMax队列大小超出，则将min(queueMin)元素放入queueMin队列</span></span><br><span class="line">            <span class="keyword">if</span> (queueMax.size() &gt; queueMin.size()) &#123;</span><br><span class="line">                queueMin.add(queueMax.poll());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">findMedian</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 从数据流中读出奇数个数值</span></span><br><span class="line">        <span class="keyword">if</span> (queueMin.size() &gt; queueMax.size()) &#123;</span><br><span class="line">            <span class="keyword">return</span> queueMin.peek();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 从数据流中读出偶数个数值</span></span><br><span class="line">        <span class="keyword">return</span> (queueMin.peek() + queueMax.peek()) / <span class="number">2.0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Your MedianFinder object will be instantiated and called as such:</span></span><br><span class="line"><span class="comment"> * MedianFinder obj = new MedianFinder();</span></span><br><span class="line"><span class="comment"> * obj.addNum(num);</span></span><br><span class="line"><span class="comment"> * double param_2 = obj.findMedian();</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure><h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><p><a href="https://zhuanlan.zhihu.com/p/39615266">数据结构与算法(4)——优先队列和堆</a> </p><p><a href="https://www.cainiaojc.com/java/java-priorityqueue.html">Java PriorityQueue</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;最近在leetcode刷题的时候，发现很多题推荐解法是用&lt;strong&gt;优先队列&lt;/strong&gt;的特性，比如：&lt;a href=&quot;https://leetcode.cn/problems/hua-dong-chuang-kou-de-zui-da-zhi-lcof/&quot;&gt;滑动</summary>
      
    
    
    
    <category term="题集" scheme="https://llye-hub.github.io/categories/%E9%A2%98%E9%9B%86/"/>
    
    
    <category term="java" scheme="https://llye-hub.github.io/tags/java/"/>
    
    <category term="数据结构" scheme="https://llye-hub.github.io/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"/>
    
  </entry>
  
  <entry>
    <title>hive、Spark和Maxcompute的SQL语法对比分析</title>
    <link href="https://llye-hub.github.io/posts/e6b1209.html"/>
    <id>https://llye-hub.github.io/posts/e6b1209.html</id>
    <published>2023-02-21T02:33:16.000Z</published>
    <updated>2023-02-22T06:42:32.480Z</updated>
    
    <content type="html"><![CDATA[<h1 id="having-差异"><a href="#having-差异" class="headerlink" title="having 差异"></a>having 差异</h1><h4 id="差异点"><a href="#差异点" class="headerlink" title="差异点"></a>差异点</h4><p>hive和spark支持窗口函数后带having<br>maxcomputer 的having语法只支持 在 group 和 distinct 后使用</p><h4 id="举例"><a href="#举例" class="headerlink" title="举例"></a>举例</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> order_id</span><br><span class="line">,<span class="built_in">sum</span>(trd_amt) <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> province) <span class="keyword">as</span> trd_amt_std</span><br><span class="line"><span class="keyword">from</span> <span class="keyword">order</span></span><br><span class="line"><span class="keyword">having</span> trd_amt_std<span class="operator">&gt;</span><span class="number">0</span></span><br></pre></td></tr></table></figure><p>以上sql在hive中可以运行，但是在maxcomputer中会提示错误，错误如下：<br><img src="https://i.328888.xyz/2023/02/21/gtHTp.png" alt="gtHTp.png"></p><h4 id="替换方案"><a href="#替换方案" class="headerlink" title="替换方案"></a>替换方案</h4><p>在语句中使用子查询，将having替换为where</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">(<span class="keyword">select</span> order_id</span><br><span class="line">,<span class="built_in">sum</span>(trd_amt) <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> province) <span class="keyword">as</span> trd_amt_std</span><br><span class="line"><span class="keyword">from</span> <span class="keyword">order</span></span><br><span class="line">) a</span><br><span class="line"><span class="keyword">where</span> a.trd_amt_std<span class="operator">&gt;</span><span class="number">0</span></span><br></pre></td></tr></table></figure><h1 id="maxcomputer-cross-join-超过一定条数后依然会提示笛卡尔积风险"><a href="#maxcomputer-cross-join-超过一定条数后，依然会提示笛卡尔积风险" class="headerlink" title="maxcomputer - cross join 超过一定条数后，依然会提示笛卡尔积风险"></a>maxcomputer - cross join 超过一定条数后，依然会提示笛卡尔积风险</h1><h4 id="差异点"><a href="#差异点-1" class="headerlink" title="差异点"></a>差异点</h4><p>hive可以使用 cross join语法来表示笛卡尔积关联<br>maxcomputer 的cross join，在条数超过一定数据量后，会提示笛卡尔积风险</p><h4 id="举例"><a href="#举例-1" class="headerlink" title="举例"></a>举例</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> a.<span class="operator">*</span>,b.<span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">(<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> table_a</span><br><span class="line">) a</span><br><span class="line"><span class="keyword">cross</span> <span class="keyword">join</span></span><br><span class="line">(<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> table_b</span><br><span class="line">) b</span><br></pre></td></tr></table></figure><p>以上sql在hive中可以运行，但是在maxcomputer中会提示错误，错误如下：<br><img src="https://i.328888.xyz/2023/02/22/xfOrA.png" alt="xfOrA.png"></p><h4 id="替换方案"><a href="#替换方案-1" class="headerlink" title="替换方案"></a>替换方案</h4><p>在左右笛卡尔积表中新增常量字段，用于关联</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> a.<span class="operator">*</span>,b.<span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">(<span class="keyword">select</span> <span class="operator">*</span>,<span class="number">1</span> <span class="keyword">as</span> cro_col <span class="keyword">from</span> table_a</span><br><span class="line">) a</span><br><span class="line"><span class="keyword">cross</span> <span class="keyword">join</span></span><br><span class="line">(<span class="keyword">select</span> <span class="operator">*</span>,<span class="number">1</span> <span class="keyword">as</span> cro_col <span class="keyword">from</span> table_b</span><br><span class="line">) b</span><br><span class="line"><span class="keyword">on</span> a.cro_col<span class="operator">=</span>b.cro_col</span><br></pre></td></tr></table></figure><h1 id="不等值join-差异"><a href="#不等值join-差异" class="headerlink" title="不等值join 差异"></a>不等值join 差异</h1><h4 id="差异点"><a href="#差异点-2" class="headerlink" title="差异点"></a>差异点</h4><p>1、spark 支持不等值join语法<br>2、hive 2.2.0版本之前不支持不等值语法，<a href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual+Joins">2.2.0及以后支持不等值join语法</a><br><img src="https://i.328888.xyz/2023/02/21/gtrN5.png" alt="gtrN5.png"><br>3、<a href="https://help.aliyun.com/document_detail/73783.html">maxcomputer不支持不等值语法</a><br><img src="https://i.328888.xyz/2023/02/21/gt3h8.png" alt="gt3h8.png"></p><h4 id="举例"><a href="#举例-2" class="headerlink" title="举例"></a>举例</h4><p>测试sql</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> table_a <span class="keyword">as</span> (</span><br><span class="line"><span class="keyword">select</span> <span class="number">1</span> <span class="keyword">as</span> id_a</span><br><span class="line">,<span class="string">&#x27;testa&#x27;</span> <span class="keyword">as</span> value_a</span><br><span class="line"></span><br><span class="line">    <span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line"> </span><br><span class="line">    <span class="keyword">select</span> <span class="number">4</span> <span class="keyword">as</span> id_a</span><br><span class="line">    ,<span class="string">&#x27;testd&#x27;</span> <span class="keyword">as</span> value_a</span><br><span class="line">)</span><br><span class="line">,table_b <span class="keyword">as</span> (</span><br><span class="line"><span class="keyword">select</span> <span class="number">3</span> <span class="keyword">as</span> id_b</span><br><span class="line">,<span class="string">&#x27;testc&#x27;</span> <span class="keyword">as</span> value_b</span><br><span class="line"></span><br><span class="line">    <span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line"> </span><br><span class="line">    <span class="keyword">select</span> <span class="number">2</span> <span class="keyword">as</span> id_b</span><br><span class="line">    ,<span class="string">&#x27;testb&#x27;</span> <span class="keyword">as</span> value_b</span><br><span class="line">)</span><br><span class="line"><span class="keyword">select</span> table_a.id_a</span><br><span class="line">,table_a.value_a</span><br><span class="line">,table_b.id_b</span><br><span class="line">,table_b.value_b</span><br><span class="line"><span class="keyword">from</span>  table_a</span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span> table_b</span><br><span class="line"><span class="keyword">on</span> table_a.id_a <span class="operator">&lt;</span> table_b.id_b</span><br></pre></td></tr></table></figure><p>sql说明 :该sql准备了两张表table_a和table_b用于连接测试<br>使用left join on语法，但是关联关系使用的是 &lt; 不等值关联符号</p><p><strong>maxcomputer运行结果</strong><br><img src="https://i.328888.xyz/2023/02/22/xfcBz.png" alt="xfcBz.png"><br>maxcomputer会报异常：  FAILED: ODPS-0130071:[15,4] Semantic analysis exception - expect equality expression (i.e., only use ‘&#x3D;’ and ‘AND’) for join condition without mapjoin hint</p><p>提示的是期望join的是等值表达式</p><p><strong>hive1.2.1运行结果</strong><br><img src="https://i.328888.xyz/2023/02/21/gtmHF.png" alt="gtmHF.png"></p><p>hive会报错： Error while compiling statement: FAILED: SemanticException [Error 10017]: line 15:3 Both left and right aliases encountered in JOIN ‘id_b’</p><p>提示的是在join中遇到左右别名</p><p>不得不说，hive的错误信息有点云里雾里，其实就是不等值join造成的。</p><p><strong>hive2.2.3运行结果</strong><br><img src="https://i.328888.xyz/2023/02/21/gtpeH.png" alt="gtpeH.png"></p><p>hive 2.2.0+版本顺利得到正确结果</p><p><strong>spark运行结果</strong></p><p><img src="https://i.328888.xyz/2023/02/22/xfGXy.png" alt="xfGXy.png"> </p><p>spark2.3也顺利得到结果</p><h4 id="替换方案"><a href="#替换方案-2" class="headerlink" title="替换方案"></a>替换方案</h4><p>针对不等值join的替换方案有两种</p><p>1、针对小表，使用mapjoin，避免join操作</p><p>2、将on的不等值关联语句放入where语句中</p><p>由于mapjoin避免shuffle，性能较好，再可以的情况下，优先使用方案1</p><p><strong>1、针对小表，使用mapjoin，避免join操作</strong><br>maxcomputer中的mapjoin hint语法为： &#x2F;*+ mapjoin(<table_name>) *&#x2F; ，详情请查看<a href="https://help.aliyun.com/document_detail/73785.htm?spm=a2c4g.11186623.0.0.534268c4fHc5iD#concept-bf5-tkb-wdb">mapjoin hint</a></table_name></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> table_a <span class="keyword">as</span> (</span><br><span class="line"><span class="keyword">select</span> <span class="number">1</span> <span class="keyword">as</span> id_a</span><br><span class="line">,<span class="string">&#x27;testa&#x27;</span> <span class="keyword">as</span> value_a</span><br><span class="line">)</span><br><span class="line">,table_b <span class="keyword">as</span> (</span><br><span class="line"><span class="keyword">select</span> <span class="number">2</span> <span class="keyword">as</span> id_b</span><br><span class="line">,<span class="string">&#x27;testb&#x27;</span> <span class="keyword">as</span> value_b</span><br><span class="line">)</span><br><span class="line"><span class="keyword">select</span> <span class="comment">/*+ mapjoin(table_b) */</span></span><br><span class="line">table_a.id_a</span><br><span class="line">,table_a.value_a</span><br><span class="line">,table_b.id_b</span><br><span class="line">,table_b.value_b</span><br><span class="line"><span class="keyword">from</span>  table_a</span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span> table_b</span><br><span class="line"><span class="keyword">on</span> table_a.id_a<span class="operator">&lt;</span>table_b.id_b</span><br></pre></td></tr></table></figure><p>可以看到，使用mapjoin hint语法后，sql在maxcomputer中运行正确，顺利拿到了预期结果<br><img src="https://i.328888.xyz/2023/02/21/gt79P.png" alt="gt79P.png"></p><p><strong>2、将on的不等值关联语句放入where语句中</strong><br>inner join 比较简单</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> table_a <span class="keyword">as</span> (</span><br><span class="line"><span class="keyword">select</span> <span class="number">1</span> <span class="keyword">as</span> id_a</span><br><span class="line">,<span class="string">&#x27;testa&#x27;</span> <span class="keyword">as</span> value_a</span><br><span class="line">,<span class="number">1</span> <span class="keyword">as</span> join_col</span><br><span class="line"></span><br><span class="line">    <span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line"> </span><br><span class="line">    <span class="keyword">select</span> <span class="number">4</span> <span class="keyword">as</span> id_a</span><br><span class="line">    ,<span class="string">&#x27;testd&#x27;</span> <span class="keyword">as</span> value_a</span><br><span class="line">    ,<span class="number">1</span> <span class="keyword">as</span> join_col</span><br><span class="line">)</span><br><span class="line">,table_b <span class="keyword">as</span> (</span><br><span class="line"><span class="keyword">select</span> <span class="number">2</span> <span class="keyword">as</span> id_b</span><br><span class="line">,<span class="string">&#x27;testb&#x27;</span> <span class="keyword">as</span> value_b</span><br><span class="line">,<span class="number">1</span> <span class="keyword">as</span> join_col</span><br><span class="line"></span><br><span class="line">    <span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line"> </span><br><span class="line">    <span class="keyword">select</span> <span class="number">3</span> <span class="keyword">as</span> id_b</span><br><span class="line">    ,<span class="string">&#x27;testc&#x27;</span> <span class="keyword">as</span> value_b</span><br><span class="line">    ,<span class="number">1</span> <span class="keyword">as</span> join_col</span><br><span class="line">)</span><br><span class="line"><span class="keyword">select</span></span><br><span class="line">table_a.id_a</span><br><span class="line">,table_a.value_a</span><br><span class="line">,table_b.id_b</span><br><span class="line">,table_b.value_b</span><br><span class="line"><span class="keyword">from</span>  table_a</span><br><span class="line"><span class="keyword">inner</span> <span class="keyword">join</span> table_b</span><br><span class="line"><span class="keyword">on</span> table_a.join_col<span class="operator">=</span>table_b.join_col</span><br><span class="line"><span class="keyword">where</span> table_a.id_a<span class="operator">&lt;</span>table_b.id_b</span><br></pre></td></tr></table></figure><p>可以看到，将&lt;判断语句放入where后，sql在maxcomputer运行正确，顺利拿到了预期结果<br><img src="https://i.328888.xyz/2023/02/21/gteAX.png" alt="gteAX.png"></p><p>left join 比较复杂，建议使用map hint，实在没办法在使用此方案</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> table_a <span class="keyword">as</span> (</span><br><span class="line"><span class="keyword">select</span> <span class="number">1</span> <span class="keyword">as</span> id_a</span><br><span class="line">,<span class="string">&#x27;testa&#x27;</span> <span class="keyword">as</span> value_a</span><br><span class="line">,<span class="number">1</span> <span class="keyword">as</span> join_col</span><br><span class="line"></span><br><span class="line">    <span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line"> </span><br><span class="line">    <span class="keyword">select</span> <span class="number">4</span> <span class="keyword">as</span> id_a</span><br><span class="line">    ,<span class="string">&#x27;testd&#x27;</span> <span class="keyword">as</span> value_a</span><br><span class="line">    ,<span class="number">1</span> <span class="keyword">as</span> join_col</span><br><span class="line">)</span><br><span class="line">,table_b <span class="keyword">as</span> (</span><br><span class="line"><span class="keyword">select</span> <span class="number">2</span> <span class="keyword">as</span> id_b</span><br><span class="line">,<span class="string">&#x27;testb&#x27;</span> <span class="keyword">as</span> value_b</span><br><span class="line">,<span class="number">1</span> <span class="keyword">as</span> join_col</span><br><span class="line"></span><br><span class="line">    <span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line"> </span><br><span class="line">    <span class="keyword">select</span> <span class="number">3</span> <span class="keyword">as</span> id_b</span><br><span class="line">    ,<span class="string">&#x27;testc&#x27;</span> <span class="keyword">as</span> value_b</span><br><span class="line">    ,<span class="number">1</span> <span class="keyword">as</span> join_col</span><br><span class="line">)</span><br><span class="line"><span class="comment">-- 能关联上的部分</span></span><br><span class="line">,join_part <span class="keyword">as</span> (</span><br><span class="line"><span class="keyword">select</span></span><br><span class="line">table_a.id_a</span><br><span class="line">,table_a.value_a</span><br><span class="line">,table_b.id_b</span><br><span class="line">,table_b.value_b</span><br><span class="line"><span class="keyword">from</span>  table_a</span><br><span class="line"><span class="keyword">inner</span> <span class="keyword">join</span> table_b</span><br><span class="line"><span class="keyword">on</span> table_a.join_col<span class="operator">=</span>table_b.join_col</span><br><span class="line"><span class="keyword">where</span> table_a.id_a<span class="operator">&lt;</span>table_b.id_b</span><br><span class="line">)</span><br><span class="line"><span class="comment">-- 以自己为主表，left join能关联上的部分，实现 left join不等值效果</span></span><br><span class="line"><span class="keyword">select</span> table_a.id_a</span><br><span class="line">,table_a.value_a</span><br><span class="line">,join_part.id_b</span><br><span class="line">,join_part.value_b</span><br><span class="line"><span class="keyword">from</span>  table_a</span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span> join_part</span><br><span class="line"><span class="keyword">on</span> table_a.id_a<span class="operator">=</span>join_part.id_a</span><br></pre></td></tr></table></figure><p>可以看到，将&lt;判断语句放入where后，sql在maxcomputer运行正确，顺利拿到了预期结果<br><img src="https://i.328888.xyz/2023/02/21/gt6hJ.png" alt="gt6hJ.png"></p><h1 id="array_contains-差异"><a href="#array-contains-差异" class="headerlink" title="array_contains 差异"></a>array_contains 差异</h1><h4 id="差异点"><a href="#差异点-3" class="headerlink" title="差异点"></a>差异点</h4><p>spark的array_contains支持类型的隐式转换<br>hive和maxcomputer array_contains不支持，只支持同类型使用</p><h4 id="举例"><a href="#举例-3" class="headerlink" title="举例"></a>举例</h4><p>测试sql</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> array_contains(split(&quot;1,2,3,4&quot;,&quot;,&quot;),<span class="number">1</span>)</span><br></pre></td></tr></table></figure><p><strong>sql说明</strong><br>该sql首先使用split一个字符串获取一个array对象用于测试，之后使用array_contains函数进行判断<br>split后的array对象为一个string数组，而判断被包含的数字【1】为一个int 对象</p><p><strong>maxcomputer运行结果</strong><br><img src="https://i.328888.xyz/2023/02/22/xf5D8.png" alt="xf5D8.png"><br>maxcomputer会报异常：  FAILED: ODPS-0130071:[1,44] Semantic analysis exception - invalid type INT of argument 2 for function array_contains, expect STRING, implicit conversion is not allowed</p><p>提示的是array_contains第二个参数期望的是string，但是传入的是int，隐式类型转换不支持</p><p><strong>hive运行结果</strong><br><img src="https://i.328888.xyz/2023/02/21/gtdOA.png" alt="gtdOA.png"></p><p>hive会报错： Error while compiling statement: FAILED: SemanticException [Error 10016]: line 1:43 Argument type mismatch ‘1’: “string” expected at function ARRAY_CONTAINS, but “int” is found</p><p>提示的是array_contains函数期望的是string，但是传入的是int，类型不匹配</p><p><strong>spark运行结果</strong></p><p><img src="https://i.328888.xyz/2023/02/22/xf1DJ.png" alt="xf1DJ.png"></p><p>spark能顺利产出结果，结果为true，那么为什么spark可以成功呢？</p><p>大概率是spark智能的将1从int转换为了string类型，使得类型得以匹配，通过explain查看物理执行计划来验证</p><p><img src="https://i.328888.xyz/2023/02/21/gtJAq.png" alt="gtJAq.png"></p><p>在上图标红的地方可以看到，spark在物理执行计划层面，将int的1隐式的转换为了string类型，验证了我们一开始的猜想。</p><h4 id="替换方案"><a href="#替换方案-3" class="headerlink" title="替换方案"></a>替换方案</h4><p>既然知道了在hive和maxcomputer中是类型不匹配导致的array_contains函数报错，那么只需要显示的将类型进行转换即可</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> array_contains(split(&quot;1,2,3,4&quot;,&quot;,&quot;),<span class="built_in">cast</span>(<span class="number">1</span> <span class="keyword">as</span> string))</span><br></pre></td></tr></table></figure><h1 id="字段类型转换-arrayltgt-to-string"><a href="#字段类型转换-ARRAY-lt-gt-to-STRING" class="headerlink" title="字段类型转换 ARRAY&lt;&gt; to STRING"></a>字段类型转换 ARRAY&lt;&gt; to STRING</h1><h4 id="差异点"><a href="#差异点-4" class="headerlink" title="差异点"></a>差异点</h4><p>spark的array_contains支持类型的隐式转换</p><p>hive和maxcomputer array_contains不支持，只支持同类型使用</p><h4 id="举例"><a href="#举例-4" class="headerlink" title="举例"></a>举例</h4><p>测试sql</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">cast</span>(<span class="keyword">array</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>) <span class="keyword">as</span> string) <span class="keyword">as</span> array_to_string;</span><br></pre></td></tr></table></figure><p><strong>maxcompute运行结果</strong></p><p><img src="https://i.328888.xyz/2023/02/22/xfQ3c.png" alt="xfQ3c.png"></p><p>maxcompute报异常：FAILED: ODPS-0130141:[1,8] Illegal implicit type cast - cannot cast from ARRAY<int> to STRING</int></p><p>提示的是 ARRAY&lt;&gt;类型字段  不能强制转换为 STRING 类型</p><p><strong>hive运行结果</strong></p><p><img src="https://i.328888.xyz/2023/02/22/xyi6V.png" alt="xyi6V.png"></p><p>hive报异常：SQL语义错误: Error while compiling statement: FAILED: ClassCastException org.apache.hadoop.hive.serde2.typeinfo.ListTypeInfo cannot be cast to org.apache.hadoop.hive.serde2.typeinfo.PrimitiveTypeInfo</p><p>提示的是不同类型不能强转</p><p><strong>spark运行结果</strong></p><p><img src="https://i.328888.xyz/2023/02/21/gtPZa.png" alt="gtPZa.png"></p><p>spark能顺利产出结果</p><p><strong>替换方案</strong><br>使用 <a href="https://help.aliyun.com/document_detail/293597.htm?spm=a2c4g.11186623.0.0.5be36f60Wo6eDb#section-pc4-90e-0rl">array_join函数</a> 将array的元素拼接成字符串，再在首尾加上 ‘[ ‘ 和 ‘]’ 字符可以还原spark上的运行结果</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> concat(<span class="string">&#x27;[&#x27;</span>,array_join(<span class="keyword">array</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>),<span class="string">&#x27;,&#x27;</span>),<span class="string">&#x27;]&#x27;</span>) <span class="keyword">as</span> array_to_string;</span><br></pre></td></tr></table></figure><p><img src="https://i.328888.xyz/2023/02/21/gtTOx.png" alt="gtTOx.png"></p><p>📢注意<br>macxcompute的array_join函数默认会忽略null元素，可在array_join函数中设置 nullreplacement 参数替代NULL元素<br><img src="https://i.328888.xyz/2023/02/21/gtazk.png" alt="gtazk.png"><br><img src="https://i.328888.xyz/2023/02/21/gt1aL.png" alt="gt1aL.png"></p><h1 id="日期格式to_datexxxyyyymmddhhmmss"><a href="#日期格式to-date-‘xxx’-’yyyyMMddHHmmss’" class="headerlink" title="日期格式to_date(‘xxx’,’yyyyMMddHHmmss’)"></a>日期格式to_date(‘xxx’,’yyyyMMddHHmmss’)</h1><h4 id="差异点"><a href="#差异点-5" class="headerlink" title="差异点"></a>差异点</h4><p>hive语法中，to_date函数用法为：to_date(string timestamp)，返回DATE类型，格式为 yyyy-mm-dd ，仅有一个参数，支持用format格式解析</p><p>spark语法中，to_date函数用法为：to_date(date_str[, fmt]) ，返回DATE类型，格式为 yyyy-mm-dd ，支持用format格式解析日期</p><p>maxcompute语法中，to_date函数用法为：to_date(string <date>, string <format>)，返回DATETIME类型，格式为 yyyy-mm-dd hh:mi:ss ，支持用format格式解析日期</format></date></p><p>📢这里要注意的是，虽然spark和maxcompute中，to_date函数都支持用format格式解析日期，format格式是有差异的，主要表现在 分钟 位的格式</p><p>spark的format格式：yyyy为4位数的年，MM为2位数的月，dd为2位数的日，HH为24小时制的时，mm为2位数的分钟，ss为2位数的秒，ff3为3位精度毫秒<br>maxcompute的format格式：yyyy为4位数的年，mm为2位数的月，dd为2位数的日，hh为24小时制的时，mi为2位数的分钟，ss为2位数的秒，ff3为3位精度毫秒</p><h4 id="举例"><a href="#举例-5" class="headerlink" title="举例"></a>举例</h4><p>测试sql</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> to_date(<span class="string">&#x27;20221118123456&#x27;</span>,<span class="string">&#x27;yyyyMMddHHmmss&#x27;</span>),to_date(<span class="string">&#x27;2022-11-18 12:34:56&#x27;</span>,<span class="string">&#x27;yyyy-MM-dd HH:mm:ss&#x27;</span>);</span><br></pre></td></tr></table></figure><p><strong>maxcompute运行结果</strong><br><img src="https://i.328888.xyz/2023/02/21/gtY0p.png" alt="gtY0p.png"></p><p>maxcompute报异常： FAILED: ODPS-0121095:Invalid arguments - format string has second part, but doesn’t have minute part : yyyyMMddHHmmss</p><p><strong>hive运行结果</strong><br><img src="https://i.328888.xyz/2023/02/21/gtqXU.png" alt="gtqXU.png"></p><p>hive报异常： Arguments length mismatch ‘’yyyyMMddhhmmss’’: to_date() requires 1 argument, got 2</p><p>提示的是to_date函数仅有1个参数</p><p>去掉format参数后的运行结果为：<br><img src="https://i.328888.xyz/2023/02/21/gtuJv.png" alt="gtuJv.png"></p><p>从结果可以看到，to_date不能解析 yyyyMMddhhmmss 和 yyyyMMdd 格式</p><p><strong>spark运行结果</strong><br><img src="https://i.328888.xyz/2023/02/21/gWiD3.png" alt="gWiD3.png"></p><p>spark能顺利产出结果</p><h4 id="替换方案"><a href="#替换方案-4" class="headerlink" title="替换方案"></a>替换方案</h4><p>format格式修改：yyyy为4位数的年，mm为2位数的月，dd为2位数的日，hh为24小时制的时，mi为2位数的分钟，ss为2位数的秒，ff3为3位精度毫秒</p><p>修改后的能正常产出结果：<br><img src="https://i.328888.xyz/2023/02/21/gW4i8.png" alt="gW4i8.png"></p><p>另，常见使用to_date报错sql为 date_format(date_add(to_date(pay_time,’yyyyMMddHHmmss’),2),’yyyyMMddHHmmss’) ，解读sql的作用是对 pay_time 加 2 天，建议用 UDF 修改这段sql为 yt_date_add(pay_time,2)，修改后简洁明了</p><h1 id="date日期函数"><a href="#date日期函数" class="headerlink" title="date日期函数"></a>date日期函数</h1><h4 id="差异点"><a href="#差异点-6" class="headerlink" title="差异点"></a>差异点</h4><p>spark和hive的date函数支持将标准的日期string转换为date类型</p><p>maxcomputer date函数只支持标准的日期string，带时分秒的时间string不支持</p><h4 id="举例"><a href="#举例-6" class="headerlink" title="举例"></a>举例</h4><p>测试sql</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="type">date</span>(<span class="string">&#x27;2022-12-21&#x27;</span>),<span class="type">date</span>(<span class="string">&#x27;2022-12-21 01:22:01&#x27;</span>);</span><br></pre></td></tr></table></figure><p><strong>maxcompute运行结果</strong><br><img src="https://i.328888.xyz/2023/02/21/gWt0Q.png" alt="gWt0Q.png"></p><p>maxcomputer对标准的日期string【2022-12-21】转换正确</p><p>但是对带时分秒的string转为错误，直接为null</p><p><strong>hive运行结果</strong><br><img src="https://i.328888.xyz/2023/02/21/gWWXE.png" alt="gWWXE.png"></p><p>结果符合预期</p><p><strong>spark运行结果</strong><br><img src="https://i.328888.xyz/2023/02/21/gWkKC.png" alt="gWkKC.png"></p><p>spark能顺利产出结果</p><h4 id="替换方案"><a href="#替换方案-5" class="headerlink" title="替换方案"></a>替换方案</h4><p>如果是为了格式转换，使用自定义 yt_date_format 函数</p><p>如果是为了获取date类型，使用 to_date函数</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> yt_date_format(<span class="string">&#x27;2022-12-21 01:22:01&#x27;</span>,<span class="string">&#x27;yyyy-MM-dd&#x27;</span>)</span><br><span class="line">,to_date(<span class="string">&#x27;2022-12-21 01:22:01&#x27;</span>);</span><br></pre></td></tr></table></figure><p><img src="https://i.328888.xyz/2023/02/21/gWCDP.png" alt="gWCDP.png"></p><h1 id="from_unixtime函数"><a href="#from-unixtime函数" class="headerlink" title="from_unixtime函数"></a>from_unixtime函数</h1><h4 id="差异点"><a href="#差异点-7" class="headerlink" title="差异点"></a>差异点</h4><p>spark和hive的from_unixtime函数将时间戳转换成格式化string类型，当时间戳为负数时，正常转换</p><p>maxcomputer from_unixtime函数转换负数时间戳时，存在时间便宜</p><h4 id="举例"><a href="#举例-7" class="headerlink" title="举例"></a>举例</h4><p>测试sql<br>select ‘1018-10-15 00:00:00’  – yyyyMMddHHmmss 时间戳<br>,unix_timestamp(‘1018-10-15 00:00:00’) –时间戳<br>,from_unixtime(unix_timestamp(‘1018-10-15 00:00:00’),’yyyyMMddHHmmss’) –转换格式</p><p><strong>maxcompute运行结果</strong><br><img src="https://i.328888.xyz/2023/02/21/gWHiJ.png" alt="gWHiJ.png"></p><p>可以看到，原先日期为 ‘1018-10-15 00:00:00’,转换成yyyyMMddHHmmss格式原本期望为  10181015000000</p><p>但是实际结果为10181008235417,和预期不符合</p><p><strong>hive运行结果</strong><br><img src="https://i.328888.xyz/2023/02/21/gWObc.png" alt="gWObc.png"></p><p>hive结果符合预期</p><p><strong>spark运行结果</strong><br><img src="https://i.328888.xyz/2023/02/21/gWb6A.png" alt="gWb6A.png"></p><p>spark产出结果正确</p><h4 id="替换方案"><a href="#替换方案-6" class="headerlink" title="替换方案"></a>替换方案</h4><p>使用自定义 yt_date_format 函数</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="string">&#x27;1018-10-15 00:00:00&#x27;</span> <span class="comment">-- yyyyMMddHHmmss 时间戳</span></span><br><span class="line">,unix_timestamp(<span class="string">&#x27;1018-10-15 00:00:00&#x27;</span>) <span class="comment">--时间戳</span></span><br><span class="line">,yt_date_format(<span class="string">&#x27;1018-10-15 00:00:00&#x27;</span>,<span class="string">&#x27;yyyyMMddHHmmss&#x27;</span>) <span class="comment">--转换格式</span></span><br></pre></td></tr></table></figure><p><img src="https://i.328888.xyz/2023/02/21/gWICN.png" alt="gWICN.png"><br>使用自定义udf后正确</p><h1 id="concat_ws差异"><a href="#concat-ws差异" class="headerlink" title="concat_ws差异"></a>concat_ws差异</h1><h4 id="差异点"><a href="#差异点-8" class="headerlink" title="差异点"></a>差异点</h4><p>spark的concat_ws会支持类型的隐式转换</p><p>hive和maxcomputer concat_ws不支持，只支持同类型使用</p><h4 id="举例"><a href="#举例-8" class="headerlink" title="举例"></a>举例</h4><p>测试sql</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> concat_ws(&quot;,&quot;,<span class="keyword">array</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>))</span><br></pre></td></tr></table></figure><p><strong>maxcompute运行结果</strong><br><img src="https://i.328888.xyz/2023/02/21/gWNgV.png" alt="gWNgV.png"></p><p>报错提示数据类型不对，concat_ws只能处理ARRAY<string>数据类型，而sql中是ARRAY<int>数据类型，<a href="https://help.aliyun.com/document_detail/455513.html?spm=a2c4g.11186623.0.0.28686fd3N35cvE">官方文档</a> 中有详细说明<br><img src="https://i.328888.xyz/2023/02/21/gWmSz.png" alt="gWmSz.png"></int></string></p><p><strong>hive运行结果</strong><br><img src="https://i.328888.xyz/2023/02/21/gWBVw.png" alt="gWBVw.png"></p><p>报错提示数据类型不对，与maxcompute一个意思，concat_ws传入数组必须是Array<int>类型</int></p><p><strong>spark运行结果</strong></p><p><img src="https://i.328888.xyz/2023/02/21/gWXba.png" alt="gWXba.png"></p><p>spark执行结果符合预期</p><h4 id="替换方案"><a href="#替换方案-7" class="headerlink" title="替换方案"></a>替换方案</h4><p>使用阿里云提供的array_join函数</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> array_join(<span class="keyword">array</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>),&quot;,&quot;);</span><br></pre></td></tr></table></figure><p><img src="https://i.328888.xyz/2023/02/21/gWegp.png" alt="gWegp.png"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;having-差异&quot;&gt;&lt;a href=&quot;#having-差异&quot; class=&quot;headerlink&quot; title=&quot;having 差异&quot;&gt;&lt;/a&gt;having 差异&lt;/h1&gt;&lt;h4 id=&quot;差异点&quot;&gt;&lt;a href=&quot;#差异点&quot; class=&quot;headerlink</summary>
      
    
    
    
    <category term="SQL" scheme="https://llye-hub.github.io/categories/SQL/"/>
    
    
    <category term="Maxcompute" scheme="https://llye-hub.github.io/tags/Maxcompute/"/>
    
  </entry>
  
  <entry>
    <title>mysql和hiveSQL的语法差别</title>
    <link href="https://llye-hub.github.io/posts/e912f2da.html"/>
    <id>https://llye-hub.github.io/posts/e912f2da.html</id>
    <published>2023-02-17T08:06:16.000Z</published>
    <updated>2023-03-02T08:18:42.316Z</updated>
    
    <content type="html"><![CDATA[<p>最近在牛客网上刷sql题，但编程语言居然只支持mysql，一些函数用法上与平时工作使用的hiveSQL有较大差别，所以在这篇博客中整理一下两种语法的函数使用差异</p><p><a href="https://dev.mysql.com/doc/refman/8.0/en/date-and-time-functions.html">mysql内置函数</a></p><p><a href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual+UDF?spm=a2c4g.11186623.0.0.3c267254Ka3fUh#LanguageManualUDF-get_json_object">hive内置函数</a></p><h1 id="日期-时间函数"><a href="#日期、时间函数" class="headerlink" title="日期、时间函数"></a>日期、时间函数</h1><table><thead><tr><th>函数用途</th><th>mysql函数</th><th>mysql用法</th><th>hive函数</th><th>hiveSQL用法</th></tr></thead><tbody><tr><td>日期、时间格式化</td><td>date_format</td><td>date_format(‘2008-08-08 22:23:01’, ‘%Y%m%d%H%i%s’)</td><td>date_format</td><td>date_format(‘2008-08-08 22:23:01’, ‘yyyyMMddHHmmss’)</td></tr><tr><td>日期、时间加</td><td>date_add</td><td>date_add(‘2008-08-08 22:23:01’,interval 1 day&#x2F;hour&#x2F;minute&#x2F;second&#x2F;microsecond&#x2F;week&#x2F;month&#x2F;quarter&#x2F;year)，返回dateTime格式</td><td>date_add</td><td>date_add(‘2008-08-08 22:23:01’,1)，只加days，返回date格式</td></tr><tr><td>日期、时间减</td><td>date_sub</td><td>date_sub(‘2008-08-08 22:23:01’,interval 1 day&#x2F;hour&#x2F;minute&#x2F;second&#x2F;microsecond&#x2F;week&#x2F;month&#x2F;quarter&#x2F;year)，返回dateTime格式</td><td>date_sub</td><td>date_sub(‘2008-08-08 22:23:01’,1)，只加days，返回date格式</td></tr><tr><td>日期相差</td><td>datediff</td><td>datediff(‘2008-08-08 22:22:00’,’2008-08-07 22:23:00’)</td><td>datediff</td><td>datediff(‘2008-08-08 22:22:00’,’2008-08-07 22:23:00’)</td></tr></tbody></table>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;最近在牛客网上刷sql题，但编程语言居然只支持mysql，一些函数用法上与平时工作使用的hiveSQL有较大差别，所以在这篇博客中整理一下两种语法的函数使用差异&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://dev.mysql.com/doc/refman/8.0/en/</summary>
      
    
    
    
    <category term="SQL" scheme="https://llye-hub.github.io/categories/SQL/"/>
    
    
  </entry>
  
</feed>
