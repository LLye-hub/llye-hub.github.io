<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>LLye</title>
  
  
  <link href="https://llye-hub.github.io/atom.xml" rel="self"/>
  
  <link href="https://llye-hub.github.io/"/>
  <updated>2023-02-22T06:42:32.480Z</updated>
  <id>https://llye-hub.github.io/</id>
  
  <author>
    <name>LLye</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>hiveã€Sparkå’ŒMaxcomputeçš„SQLè¯­æ³•å¯¹æ¯”åˆ†æ</title>
    <link href="https://llye-hub.github.io/posts/e6b1209.html"/>
    <id>https://llye-hub.github.io/posts/e6b1209.html</id>
    <published>2023-02-21T02:33:16.000Z</published>
    <updated>2023-02-22T06:42:32.480Z</updated>
    
    <content type="html"><![CDATA[<h1 id="having-å·®å¼‚"><a href="#having-å·®å¼‚" class="headerlink" title="having å·®å¼‚"></a>having å·®å¼‚</h1><h4 id="å·®å¼‚ç‚¹"><a href="#å·®å¼‚ç‚¹" class="headerlink" title="å·®å¼‚ç‚¹"></a>å·®å¼‚ç‚¹</h4><p>hiveå’Œsparkæ”¯æŒçª—å£å‡½æ•°åå¸¦having<br>maxcomputer çš„havingè¯­æ³•åªæ”¯æŒ åœ¨ group å’Œ distinct åä½¿ç”¨</p><h4 id="ä¸¾ä¾‹"><a href="#ä¸¾ä¾‹" class="headerlink" title="ä¸¾ä¾‹"></a>ä¸¾ä¾‹</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> order_id</span><br><span class="line">,<span class="built_in">sum</span>(trd_amt) <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> province) <span class="keyword">as</span> trd_amt_std</span><br><span class="line"><span class="keyword">from</span> <span class="keyword">order</span></span><br><span class="line"><span class="keyword">having</span> trd_amt_std<span class="operator">&gt;</span><span class="number">0</span></span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šsqlåœ¨hiveä¸­å¯ä»¥è¿è¡Œï¼Œä½†æ˜¯åœ¨maxcomputerä¸­ä¼šæç¤ºé”™è¯¯ï¼Œé”™è¯¯å¦‚ä¸‹ï¼š<br><img src="https://i.328888.xyz/2023/02/21/gtHTp.png" alt="gtHTp.png"></p><h4 id="æ›¿æ¢æ–¹æ¡ˆ"><a href="#æ›¿æ¢æ–¹æ¡ˆ" class="headerlink" title="æ›¿æ¢æ–¹æ¡ˆ"></a>æ›¿æ¢æ–¹æ¡ˆ</h4><p>åœ¨è¯­å¥ä¸­ä½¿ç”¨å­æŸ¥è¯¢ï¼Œå°†havingæ›¿æ¢ä¸ºwhere</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">(<span class="keyword">select</span> order_id</span><br><span class="line">,<span class="built_in">sum</span>(trd_amt) <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> province) <span class="keyword">as</span> trd_amt_std</span><br><span class="line"><span class="keyword">from</span> <span class="keyword">order</span></span><br><span class="line">) a</span><br><span class="line"><span class="keyword">where</span> a.trd_amt_std<span class="operator">&gt;</span><span class="number">0</span></span><br></pre></td></tr></table></figure><h1 id="maxcomputer-cross-join-è¶…è¿‡ä¸€å®šæ¡æ•°åï¼Œä¾ç„¶ä¼šæç¤ºç¬›å¡å°”ç§¯é£é™©"><a href="#maxcomputer-cross-join-è¶…è¿‡ä¸€å®šæ¡æ•°åï¼Œä¾ç„¶ä¼šæç¤ºç¬›å¡å°”ç§¯é£é™©" class="headerlink" title="maxcomputer - cross join è¶…è¿‡ä¸€å®šæ¡æ•°åï¼Œä¾ç„¶ä¼šæç¤ºç¬›å¡å°”ç§¯é£é™©"></a>maxcomputer - cross join è¶…è¿‡ä¸€å®šæ¡æ•°åï¼Œä¾ç„¶ä¼šæç¤ºç¬›å¡å°”ç§¯é£é™©</h1><h4 id="å·®å¼‚ç‚¹-1"><a href="#å·®å¼‚ç‚¹-1" class="headerlink" title="å·®å¼‚ç‚¹"></a>å·®å¼‚ç‚¹</h4><p>hiveå¯ä»¥ä½¿ç”¨ cross joinè¯­æ³•æ¥è¡¨ç¤ºç¬›å¡å°”ç§¯å…³è”<br>maxcomputer çš„cross joinï¼Œåœ¨æ¡æ•°è¶…è¿‡ä¸€å®šæ•°æ®é‡åï¼Œä¼šæç¤ºç¬›å¡å°”ç§¯é£é™©</p><h4 id="ä¸¾ä¾‹-1"><a href="#ä¸¾ä¾‹-1" class="headerlink" title="ä¸¾ä¾‹"></a>ä¸¾ä¾‹</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> a.<span class="operator">*</span>,b.<span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">(<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> table_a</span><br><span class="line">) a</span><br><span class="line"><span class="keyword">cross</span> <span class="keyword">join</span></span><br><span class="line">(<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> table_b</span><br><span class="line">) b</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šsqlåœ¨hiveä¸­å¯ä»¥è¿è¡Œï¼Œä½†æ˜¯åœ¨maxcomputerä¸­ä¼šæç¤ºé”™è¯¯ï¼Œé”™è¯¯å¦‚ä¸‹ï¼š<br><img src="https://i.328888.xyz/2023/02/22/xfOrA.png" alt="xfOrA.png"></p><h4 id="æ›¿æ¢æ–¹æ¡ˆ-1"><a href="#æ›¿æ¢æ–¹æ¡ˆ-1" class="headerlink" title="æ›¿æ¢æ–¹æ¡ˆ"></a>æ›¿æ¢æ–¹æ¡ˆ</h4><p>åœ¨å·¦å³ç¬›å¡å°”ç§¯è¡¨ä¸­æ–°å¢å¸¸é‡å­—æ®µï¼Œç”¨äºå…³è”</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> a.<span class="operator">*</span>,b.<span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">(<span class="keyword">select</span> <span class="operator">*</span>,<span class="number">1</span> <span class="keyword">as</span> cro_col <span class="keyword">from</span> table_a</span><br><span class="line">) a</span><br><span class="line"><span class="keyword">cross</span> <span class="keyword">join</span></span><br><span class="line">(<span class="keyword">select</span> <span class="operator">*</span>,<span class="number">1</span> <span class="keyword">as</span> cro_col <span class="keyword">from</span> table_b</span><br><span class="line">) b</span><br><span class="line"><span class="keyword">on</span> a.cro_col<span class="operator">=</span>b.cro_col</span><br></pre></td></tr></table></figure><h1 id="ä¸ç­‰å€¼join-å·®å¼‚"><a href="#ä¸ç­‰å€¼join-å·®å¼‚" class="headerlink" title="ä¸ç­‰å€¼join å·®å¼‚"></a>ä¸ç­‰å€¼join å·®å¼‚</h1><h4 id="å·®å¼‚ç‚¹-2"><a href="#å·®å¼‚ç‚¹-2" class="headerlink" title="å·®å¼‚ç‚¹"></a>å·®å¼‚ç‚¹</h4><p>1ã€spark æ”¯æŒä¸ç­‰å€¼joinè¯­æ³•<br>2ã€hive 2.2.0ç‰ˆæœ¬ä¹‹å‰ä¸æ”¯æŒä¸ç­‰å€¼è¯­æ³•ï¼Œ<a href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual+Joins">2.2.0åŠä»¥åæ”¯æŒä¸ç­‰å€¼joinè¯­æ³•</a><br><img src="https://i.328888.xyz/2023/02/21/gtrN5.png" alt="gtrN5.png"><br>3ã€<a href="https://help.aliyun.com/document_detail/73783.html">maxcomputerä¸æ”¯æŒä¸ç­‰å€¼è¯­æ³•</a><br><img src="https://i.328888.xyz/2023/02/21/gt3h8.png" alt="gt3h8.png"></p><h4 id="ä¸¾ä¾‹-2"><a href="#ä¸¾ä¾‹-2" class="headerlink" title="ä¸¾ä¾‹"></a>ä¸¾ä¾‹</h4><p>æµ‹è¯•sql</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> table_a <span class="keyword">as</span> (</span><br><span class="line"><span class="keyword">select</span> <span class="number">1</span> <span class="keyword">as</span> id_a</span><br><span class="line">,<span class="string">&#x27;testa&#x27;</span> <span class="keyword">as</span> value_a</span><br><span class="line"></span><br><span class="line">    <span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line"> </span><br><span class="line">    <span class="keyword">select</span> <span class="number">4</span> <span class="keyword">as</span> id_a</span><br><span class="line">    ,<span class="string">&#x27;testd&#x27;</span> <span class="keyword">as</span> value_a</span><br><span class="line">)</span><br><span class="line">,table_b <span class="keyword">as</span> (</span><br><span class="line"><span class="keyword">select</span> <span class="number">3</span> <span class="keyword">as</span> id_b</span><br><span class="line">,<span class="string">&#x27;testc&#x27;</span> <span class="keyword">as</span> value_b</span><br><span class="line"></span><br><span class="line">    <span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line"> </span><br><span class="line">    <span class="keyword">select</span> <span class="number">2</span> <span class="keyword">as</span> id_b</span><br><span class="line">    ,<span class="string">&#x27;testb&#x27;</span> <span class="keyword">as</span> value_b</span><br><span class="line">)</span><br><span class="line"><span class="keyword">select</span> table_a.id_a</span><br><span class="line">,table_a.value_a</span><br><span class="line">,table_b.id_b</span><br><span class="line">,table_b.value_b</span><br><span class="line"><span class="keyword">from</span>  table_a</span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span> table_b</span><br><span class="line"><span class="keyword">on</span> table_a.id_a <span class="operator">&lt;</span> table_b.id_b</span><br></pre></td></tr></table></figure><p>sqlè¯´æ˜ :è¯¥sqlå‡†å¤‡äº†ä¸¤å¼ è¡¨table_aå’Œtable_bç”¨äºè¿æ¥æµ‹è¯•<br>ä½¿ç”¨left join onè¯­æ³•ï¼Œä½†æ˜¯å…³è”å…³ç³»ä½¿ç”¨çš„æ˜¯ &lt; ä¸ç­‰å€¼å…³è”ç¬¦å·</p><p><strong>maxcomputerè¿è¡Œç»“æœ</strong><br><img src="https://i.328888.xyz/2023/02/22/xfcBz.png" alt="xfcBz.png"><br>maxcomputerä¼šæŠ¥å¼‚å¸¸ï¼š  FAILED: ODPS-0130071:[15,4] Semantic analysis exception - expect equality expression (i.e., only use â€˜&#x3D;â€™ and â€˜ANDâ€™) for join condition without mapjoin hint</p><p>æç¤ºçš„æ˜¯æœŸæœ›joinçš„æ˜¯ç­‰å€¼è¡¨è¾¾å¼</p><p><strong>hive1.2.1è¿è¡Œç»“æœ</strong><br><img src="https://i.328888.xyz/2023/02/21/gtmHF.png" alt="gtmHF.png"></p><p>hiveä¼šæŠ¥é”™ï¼š Error while compiling statement: FAILED: SemanticException [Error 10017]: line 15:3 Both left and right aliases encountered in JOIN â€˜id_bâ€™</p><p>æç¤ºçš„æ˜¯åœ¨joinä¸­é‡åˆ°å·¦å³åˆ«å</p><p>ä¸å¾—ä¸è¯´ï¼Œhiveçš„é”™è¯¯ä¿¡æ¯æœ‰ç‚¹äº‘é‡Œé›¾é‡Œï¼Œå…¶å®å°±æ˜¯ä¸ç­‰å€¼joiné€ æˆçš„ã€‚</p><p><strong>hive2.2.3è¿è¡Œç»“æœ</strong><br><img src="https://i.328888.xyz/2023/02/21/gtpeH.png" alt="gtpeH.png"></p><p>hive 2.2.0+ç‰ˆæœ¬é¡ºåˆ©å¾—åˆ°æ­£ç¡®ç»“æœ</p><p><strong>sparkè¿è¡Œç»“æœ</strong></p><p><img src="https://i.328888.xyz/2023/02/22/xfGXy.png" alt="xfGXy.png"> </p><p>spark2.3ä¹Ÿé¡ºåˆ©å¾—åˆ°ç»“æœ</p><h4 id="æ›¿æ¢æ–¹æ¡ˆ-2"><a href="#æ›¿æ¢æ–¹æ¡ˆ-2" class="headerlink" title="æ›¿æ¢æ–¹æ¡ˆ"></a>æ›¿æ¢æ–¹æ¡ˆ</h4><p>é’ˆå¯¹ä¸ç­‰å€¼joinçš„æ›¿æ¢æ–¹æ¡ˆæœ‰ä¸¤ç§</p><p>1ã€é’ˆå¯¹å°è¡¨ï¼Œä½¿ç”¨mapjoinï¼Œé¿å…joinæ“ä½œ</p><p>2ã€å°†onçš„ä¸ç­‰å€¼å…³è”è¯­å¥æ”¾å…¥whereè¯­å¥ä¸­</p><p>ç”±äºmapjoiné¿å…shuffleï¼Œæ€§èƒ½è¾ƒå¥½ï¼Œå†å¯ä»¥çš„æƒ…å†µä¸‹ï¼Œä¼˜å…ˆä½¿ç”¨æ–¹æ¡ˆ1</p><p><strong>1ã€é’ˆå¯¹å°è¡¨ï¼Œä½¿ç”¨mapjoinï¼Œé¿å…joinæ“ä½œ</strong><br>maxcomputerä¸­çš„mapjoin hintè¯­æ³•ä¸ºï¼š &#x2F;*+ mapjoin(<table_name>) *&#x2F; ï¼Œè¯¦æƒ…è¯·æŸ¥çœ‹<a href="https://help.aliyun.com/document_detail/73785.htm?spm=a2c4g.11186623.0.0.534268c4fHc5iD#concept-bf5-tkb-wdb">mapjoin hint</a></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> table_a <span class="keyword">as</span> (</span><br><span class="line"><span class="keyword">select</span> <span class="number">1</span> <span class="keyword">as</span> id_a</span><br><span class="line">,<span class="string">&#x27;testa&#x27;</span> <span class="keyword">as</span> value_a</span><br><span class="line">)</span><br><span class="line">,table_b <span class="keyword">as</span> (</span><br><span class="line"><span class="keyword">select</span> <span class="number">2</span> <span class="keyword">as</span> id_b</span><br><span class="line">,<span class="string">&#x27;testb&#x27;</span> <span class="keyword">as</span> value_b</span><br><span class="line">)</span><br><span class="line"><span class="keyword">select</span> <span class="comment">/*+ mapjoin(table_b) */</span></span><br><span class="line">table_a.id_a</span><br><span class="line">,table_a.value_a</span><br><span class="line">,table_b.id_b</span><br><span class="line">,table_b.value_b</span><br><span class="line"><span class="keyword">from</span>  table_a</span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span> table_b</span><br><span class="line"><span class="keyword">on</span> table_a.id_a<span class="operator">&lt;</span>table_b.id_b</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œä½¿ç”¨mapjoin hintè¯­æ³•åï¼Œsqlåœ¨maxcomputerä¸­è¿è¡Œæ­£ç¡®ï¼Œé¡ºåˆ©æ‹¿åˆ°äº†é¢„æœŸç»“æœ<br><img src="https://i.328888.xyz/2023/02/21/gt79P.png" alt="gt79P.png"></p><p><strong>2ã€å°†onçš„ä¸ç­‰å€¼å…³è”è¯­å¥æ”¾å…¥whereè¯­å¥ä¸­</strong><br>inner join æ¯”è¾ƒç®€å•</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> table_a <span class="keyword">as</span> (</span><br><span class="line"><span class="keyword">select</span> <span class="number">1</span> <span class="keyword">as</span> id_a</span><br><span class="line">,<span class="string">&#x27;testa&#x27;</span> <span class="keyword">as</span> value_a</span><br><span class="line">,<span class="number">1</span> <span class="keyword">as</span> join_col</span><br><span class="line"></span><br><span class="line">    <span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line"> </span><br><span class="line">    <span class="keyword">select</span> <span class="number">4</span> <span class="keyword">as</span> id_a</span><br><span class="line">    ,<span class="string">&#x27;testd&#x27;</span> <span class="keyword">as</span> value_a</span><br><span class="line">    ,<span class="number">1</span> <span class="keyword">as</span> join_col</span><br><span class="line">)</span><br><span class="line">,table_b <span class="keyword">as</span> (</span><br><span class="line"><span class="keyword">select</span> <span class="number">2</span> <span class="keyword">as</span> id_b</span><br><span class="line">,<span class="string">&#x27;testb&#x27;</span> <span class="keyword">as</span> value_b</span><br><span class="line">,<span class="number">1</span> <span class="keyword">as</span> join_col</span><br><span class="line"></span><br><span class="line">    <span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line"> </span><br><span class="line">    <span class="keyword">select</span> <span class="number">3</span> <span class="keyword">as</span> id_b</span><br><span class="line">    ,<span class="string">&#x27;testc&#x27;</span> <span class="keyword">as</span> value_b</span><br><span class="line">    ,<span class="number">1</span> <span class="keyword">as</span> join_col</span><br><span class="line">)</span><br><span class="line"><span class="keyword">select</span></span><br><span class="line">table_a.id_a</span><br><span class="line">,table_a.value_a</span><br><span class="line">,table_b.id_b</span><br><span class="line">,table_b.value_b</span><br><span class="line"><span class="keyword">from</span>  table_a</span><br><span class="line"><span class="keyword">inner</span> <span class="keyword">join</span> table_b</span><br><span class="line"><span class="keyword">on</span> table_a.join_col<span class="operator">=</span>table_b.join_col</span><br><span class="line"><span class="keyword">where</span> table_a.id_a<span class="operator">&lt;</span>table_b.id_b</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œå°†&lt;åˆ¤æ–­è¯­å¥æ”¾å…¥whereåï¼Œsqlåœ¨maxcomputerè¿è¡Œæ­£ç¡®ï¼Œé¡ºåˆ©æ‹¿åˆ°äº†é¢„æœŸç»“æœ<br><img src="https://i.328888.xyz/2023/02/21/gteAX.png" alt="gteAX.png"></p><p>left join æ¯”è¾ƒå¤æ‚ï¼Œå»ºè®®ä½¿ç”¨map hintï¼Œå®åœ¨æ²¡åŠæ³•åœ¨ä½¿ç”¨æ­¤æ–¹æ¡ˆ</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> table_a <span class="keyword">as</span> (</span><br><span class="line"><span class="keyword">select</span> <span class="number">1</span> <span class="keyword">as</span> id_a</span><br><span class="line">,<span class="string">&#x27;testa&#x27;</span> <span class="keyword">as</span> value_a</span><br><span class="line">,<span class="number">1</span> <span class="keyword">as</span> join_col</span><br><span class="line"></span><br><span class="line">    <span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line"> </span><br><span class="line">    <span class="keyword">select</span> <span class="number">4</span> <span class="keyword">as</span> id_a</span><br><span class="line">    ,<span class="string">&#x27;testd&#x27;</span> <span class="keyword">as</span> value_a</span><br><span class="line">    ,<span class="number">1</span> <span class="keyword">as</span> join_col</span><br><span class="line">)</span><br><span class="line">,table_b <span class="keyword">as</span> (</span><br><span class="line"><span class="keyword">select</span> <span class="number">2</span> <span class="keyword">as</span> id_b</span><br><span class="line">,<span class="string">&#x27;testb&#x27;</span> <span class="keyword">as</span> value_b</span><br><span class="line">,<span class="number">1</span> <span class="keyword">as</span> join_col</span><br><span class="line"></span><br><span class="line">    <span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line"> </span><br><span class="line">    <span class="keyword">select</span> <span class="number">3</span> <span class="keyword">as</span> id_b</span><br><span class="line">    ,<span class="string">&#x27;testc&#x27;</span> <span class="keyword">as</span> value_b</span><br><span class="line">    ,<span class="number">1</span> <span class="keyword">as</span> join_col</span><br><span class="line">)</span><br><span class="line"><span class="comment">-- èƒ½å…³è”ä¸Šçš„éƒ¨åˆ†</span></span><br><span class="line">,join_part <span class="keyword">as</span> (</span><br><span class="line"><span class="keyword">select</span></span><br><span class="line">table_a.id_a</span><br><span class="line">,table_a.value_a</span><br><span class="line">,table_b.id_b</span><br><span class="line">,table_b.value_b</span><br><span class="line"><span class="keyword">from</span>  table_a</span><br><span class="line"><span class="keyword">inner</span> <span class="keyword">join</span> table_b</span><br><span class="line"><span class="keyword">on</span> table_a.join_col<span class="operator">=</span>table_b.join_col</span><br><span class="line"><span class="keyword">where</span> table_a.id_a<span class="operator">&lt;</span>table_b.id_b</span><br><span class="line">)</span><br><span class="line"><span class="comment">-- ä»¥è‡ªå·±ä¸ºä¸»è¡¨ï¼Œleft joinèƒ½å…³è”ä¸Šçš„éƒ¨åˆ†ï¼Œå®ç° left joinä¸ç­‰å€¼æ•ˆæœ</span></span><br><span class="line"><span class="keyword">select</span> table_a.id_a</span><br><span class="line">,table_a.value_a</span><br><span class="line">,join_part.id_b</span><br><span class="line">,join_part.value_b</span><br><span class="line"><span class="keyword">from</span>  table_a</span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span> join_part</span><br><span class="line"><span class="keyword">on</span> table_a.id_a<span class="operator">=</span>join_part.id_a</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œå°†&lt;åˆ¤æ–­è¯­å¥æ”¾å…¥whereåï¼Œsqlåœ¨maxcomputerè¿è¡Œæ­£ç¡®ï¼Œé¡ºåˆ©æ‹¿åˆ°äº†é¢„æœŸç»“æœ<br><img src="https://i.328888.xyz/2023/02/21/gt6hJ.png" alt="gt6hJ.png"></p><h1 id="array-contains-å·®å¼‚"><a href="#array-contains-å·®å¼‚" class="headerlink" title="array_contains å·®å¼‚"></a>array_contains å·®å¼‚</h1><h4 id="å·®å¼‚ç‚¹-3"><a href="#å·®å¼‚ç‚¹-3" class="headerlink" title="å·®å¼‚ç‚¹"></a>å·®å¼‚ç‚¹</h4><p>sparkçš„array_containsæ”¯æŒç±»å‹çš„éšå¼è½¬æ¢<br>hiveå’Œmaxcomputer array_containsä¸æ”¯æŒï¼Œåªæ”¯æŒåŒç±»å‹ä½¿ç”¨</p><h4 id="ä¸¾ä¾‹-3"><a href="#ä¸¾ä¾‹-3" class="headerlink" title="ä¸¾ä¾‹"></a>ä¸¾ä¾‹</h4><p>æµ‹è¯•sql</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> array_contains(split(&quot;1,2,3,4&quot;,&quot;,&quot;),<span class="number">1</span>)</span><br></pre></td></tr></table></figure><p><strong>sqlè¯´æ˜</strong><br>è¯¥sqlé¦–å…ˆä½¿ç”¨splitä¸€ä¸ªå­—ç¬¦ä¸²è·å–ä¸€ä¸ªarrayå¯¹è±¡ç”¨äºæµ‹è¯•ï¼Œä¹‹åä½¿ç”¨array_containså‡½æ•°è¿›è¡Œåˆ¤æ–­<br>splitåçš„arrayå¯¹è±¡ä¸ºä¸€ä¸ªstringæ•°ç»„ï¼Œè€Œåˆ¤æ–­è¢«åŒ…å«çš„æ•°å­—ã€1ã€‘ä¸ºä¸€ä¸ªint å¯¹è±¡</p><p><strong>maxcomputerè¿è¡Œç»“æœ</strong><br><img src="https://i.328888.xyz/2023/02/22/xf5D8.png" alt="xf5D8.png"><br>maxcomputerä¼šæŠ¥å¼‚å¸¸ï¼š  FAILED: ODPS-0130071:[1,44] Semantic analysis exception - invalid type INT of argument 2 for function array_contains, expect STRING, implicit conversion is not allowed</p><p>æç¤ºçš„æ˜¯array_containsç¬¬äºŒä¸ªå‚æ•°æœŸæœ›çš„æ˜¯stringï¼Œä½†æ˜¯ä¼ å…¥çš„æ˜¯intï¼Œéšå¼ç±»å‹è½¬æ¢ä¸æ”¯æŒ</p><p><strong>hiveè¿è¡Œç»“æœ</strong><br><img src="https://i.328888.xyz/2023/02/21/gtdOA.png" alt="gtdOA.png"></p><p>hiveä¼šæŠ¥é”™ï¼š Error while compiling statement: FAILED: SemanticException [Error 10016]: line 1:43 Argument type mismatch â€˜1â€™: â€œstringâ€ expected at function ARRAY_CONTAINS, but â€œintâ€ is found</p><p>æç¤ºçš„æ˜¯array_containså‡½æ•°æœŸæœ›çš„æ˜¯stringï¼Œä½†æ˜¯ä¼ å…¥çš„æ˜¯intï¼Œç±»å‹ä¸åŒ¹é…</p><p><strong>sparkè¿è¡Œç»“æœ</strong></p><p><img src="https://i.328888.xyz/2023/02/22/xf1DJ.png" alt="xf1DJ.png"></p><p>sparkèƒ½é¡ºåˆ©äº§å‡ºç»“æœï¼Œç»“æœä¸ºtrueï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆsparkå¯ä»¥æˆåŠŸå‘¢ï¼Ÿ</p><p>å¤§æ¦‚ç‡æ˜¯sparkæ™ºèƒ½çš„å°†1ä»intè½¬æ¢ä¸ºäº†stringç±»å‹ï¼Œä½¿å¾—ç±»å‹å¾—ä»¥åŒ¹é…ï¼Œé€šè¿‡explainæŸ¥çœ‹ç‰©ç†æ‰§è¡Œè®¡åˆ’æ¥éªŒè¯</p><p><img src="https://i.328888.xyz/2023/02/21/gtJAq.png" alt="gtJAq.png"></p><p>åœ¨ä¸Šå›¾æ ‡çº¢çš„åœ°æ–¹å¯ä»¥çœ‹åˆ°ï¼Œsparkåœ¨ç‰©ç†æ‰§è¡Œè®¡åˆ’å±‚é¢ï¼Œå°†intçš„1éšå¼çš„è½¬æ¢ä¸ºäº†stringç±»å‹ï¼ŒéªŒè¯äº†æˆ‘ä»¬ä¸€å¼€å§‹çš„çŒœæƒ³ã€‚</p><h4 id="æ›¿æ¢æ–¹æ¡ˆ-3"><a href="#æ›¿æ¢æ–¹æ¡ˆ-3" class="headerlink" title="æ›¿æ¢æ–¹æ¡ˆ"></a>æ›¿æ¢æ–¹æ¡ˆ</h4><p>æ—¢ç„¶çŸ¥é“äº†åœ¨hiveå’Œmaxcomputerä¸­æ˜¯ç±»å‹ä¸åŒ¹é…å¯¼è‡´çš„array_containså‡½æ•°æŠ¥é”™ï¼Œé‚£ä¹ˆåªéœ€è¦æ˜¾ç¤ºçš„å°†ç±»å‹è¿›è¡Œè½¬æ¢å³å¯</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> array_contains(split(&quot;1,2,3,4&quot;,&quot;,&quot;),<span class="built_in">cast</span>(<span class="number">1</span> <span class="keyword">as</span> string))</span><br></pre></td></tr></table></figure><h1 id="å­—æ®µç±»å‹è½¬æ¢-ARRAY-lt-gt-to-STRING"><a href="#å­—æ®µç±»å‹è½¬æ¢-ARRAY-lt-gt-to-STRING" class="headerlink" title="å­—æ®µç±»å‹è½¬æ¢ ARRAY&lt;&gt; to STRING"></a>å­—æ®µç±»å‹è½¬æ¢ ARRAY&lt;&gt; to STRING</h1><h4 id="å·®å¼‚ç‚¹-4"><a href="#å·®å¼‚ç‚¹-4" class="headerlink" title="å·®å¼‚ç‚¹"></a>å·®å¼‚ç‚¹</h4><p>sparkçš„array_containsæ”¯æŒç±»å‹çš„éšå¼è½¬æ¢</p><p>hiveå’Œmaxcomputer array_containsä¸æ”¯æŒï¼Œåªæ”¯æŒåŒç±»å‹ä½¿ç”¨</p><h4 id="ä¸¾ä¾‹-4"><a href="#ä¸¾ä¾‹-4" class="headerlink" title="ä¸¾ä¾‹"></a>ä¸¾ä¾‹</h4><p>æµ‹è¯•sql</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">cast</span>(<span class="keyword">array</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>) <span class="keyword">as</span> string) <span class="keyword">as</span> array_to_string;</span><br></pre></td></tr></table></figure><p><strong>maxcomputeè¿è¡Œç»“æœ</strong></p><p><img src="https://i.328888.xyz/2023/02/22/xfQ3c.png" alt="xfQ3c.png"></p><p>maxcomputeæŠ¥å¼‚å¸¸ï¼šFAILED: ODPS-0130141:[1,8] Illegal implicit type cast - cannot cast from ARRAY<INT> to STRING</p><p>æç¤ºçš„æ˜¯ ARRAY&lt;&gt;ç±»å‹å­—æ®µ  ä¸èƒ½å¼ºåˆ¶è½¬æ¢ä¸º STRING ç±»å‹</p><p><strong>hiveè¿è¡Œç»“æœ</strong></p><p><img src="https://i.328888.xyz/2023/02/22/xyi6V.png" alt="xyi6V.png"></p><p>hiveæŠ¥å¼‚å¸¸ï¼šSQLè¯­ä¹‰é”™è¯¯: Error while compiling statement: FAILED: ClassCastException org.apache.hadoop.hive.serde2.typeinfo.ListTypeInfo cannot be cast to org.apache.hadoop.hive.serde2.typeinfo.PrimitiveTypeInfo</p><p>æç¤ºçš„æ˜¯ä¸åŒç±»å‹ä¸èƒ½å¼ºè½¬</p><p><strong>sparkè¿è¡Œç»“æœ</strong></p><p><img src="https://i.328888.xyz/2023/02/21/gtPZa.png" alt="gtPZa.png"></p><p>sparkèƒ½é¡ºåˆ©äº§å‡ºç»“æœ</p><p><strong>æ›¿æ¢æ–¹æ¡ˆ</strong><br>ä½¿ç”¨ <a href="https://help.aliyun.com/document_detail/293597.htm?spm=a2c4g.11186623.0.0.5be36f60Wo6eDb#section-pc4-90e-0rl">array_joinå‡½æ•°</a> å°†arrayçš„å…ƒç´ æ‹¼æ¥æˆå­—ç¬¦ä¸²ï¼Œå†åœ¨é¦–å°¾åŠ ä¸Š â€˜[ â€˜ å’Œ â€˜]â€™ å­—ç¬¦å¯ä»¥è¿˜åŸsparkä¸Šçš„è¿è¡Œç»“æœ</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> concat(<span class="string">&#x27;[&#x27;</span>,array_join(<span class="keyword">array</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>),<span class="string">&#x27;,&#x27;</span>),<span class="string">&#x27;]&#x27;</span>) <span class="keyword">as</span> array_to_string;</span><br></pre></td></tr></table></figure><p><img src="https://i.328888.xyz/2023/02/21/gtTOx.png" alt="gtTOx.png"></p><p>ğŸ“¢æ³¨æ„<br>macxcomputeçš„array_joinå‡½æ•°é»˜è®¤ä¼šå¿½ç•¥nullå…ƒç´ ï¼Œå¯åœ¨array_joinå‡½æ•°ä¸­è®¾ç½® nullreplacement å‚æ•°æ›¿ä»£NULLå…ƒç´ <br><img src="https://i.328888.xyz/2023/02/21/gtazk.png" alt="gtazk.png"><br><img src="https://i.328888.xyz/2023/02/21/gt1aL.png" alt="gt1aL.png"></p><h1 id="æ—¥æœŸæ ¼å¼to-date-â€˜xxxâ€™-â€™yyyyMMddHHmmssâ€™"><a href="#æ—¥æœŸæ ¼å¼to-date-â€˜xxxâ€™-â€™yyyyMMddHHmmssâ€™" class="headerlink" title="æ—¥æœŸæ ¼å¼to_date(â€˜xxxâ€™,â€™yyyyMMddHHmmssâ€™)"></a>æ—¥æœŸæ ¼å¼to_date(â€˜xxxâ€™,â€™yyyyMMddHHmmssâ€™)</h1><h4 id="å·®å¼‚ç‚¹-5"><a href="#å·®å¼‚ç‚¹-5" class="headerlink" title="å·®å¼‚ç‚¹"></a>å·®å¼‚ç‚¹</h4><p>hiveè¯­æ³•ä¸­ï¼Œto_dateå‡½æ•°ç”¨æ³•ä¸ºï¼što_date(string timestamp)ï¼Œè¿”å›DATEç±»å‹ï¼Œæ ¼å¼ä¸º yyyy-mm-dd ï¼Œä»…æœ‰ä¸€ä¸ªå‚æ•°ï¼Œæ”¯æŒç”¨formatæ ¼å¼è§£æ</p><p>sparkè¯­æ³•ä¸­ï¼Œto_dateå‡½æ•°ç”¨æ³•ä¸ºï¼što_date(date_str[, fmt]) ï¼Œè¿”å›DATEç±»å‹ï¼Œæ ¼å¼ä¸º yyyy-mm-dd ï¼Œæ”¯æŒç”¨formatæ ¼å¼è§£ææ—¥æœŸ</p><p>maxcomputeè¯­æ³•ä¸­ï¼Œto_dateå‡½æ•°ç”¨æ³•ä¸ºï¼što_date(string <date>, string <format>)ï¼Œè¿”å›DATETIMEç±»å‹ï¼Œæ ¼å¼ä¸º yyyy-mm-dd hh:mi:ss ï¼Œæ”¯æŒç”¨formatæ ¼å¼è§£ææ—¥æœŸ</p><p>ğŸ“¢è¿™é‡Œè¦æ³¨æ„çš„æ˜¯ï¼Œè™½ç„¶sparkå’Œmaxcomputeä¸­ï¼Œto_dateå‡½æ•°éƒ½æ”¯æŒç”¨formatæ ¼å¼è§£ææ—¥æœŸï¼Œformatæ ¼å¼æ˜¯æœ‰å·®å¼‚çš„ï¼Œä¸»è¦è¡¨ç°åœ¨ åˆ†é’Ÿ ä½çš„æ ¼å¼</p><p>sparkçš„formatæ ¼å¼ï¼šyyyyä¸º4ä½æ•°çš„å¹´ï¼ŒMMä¸º2ä½æ•°çš„æœˆï¼Œddä¸º2ä½æ•°çš„æ—¥ï¼ŒHHä¸º24å°æ—¶åˆ¶çš„æ—¶ï¼Œmmä¸º2ä½æ•°çš„åˆ†é’Ÿï¼Œssä¸º2ä½æ•°çš„ç§’ï¼Œff3ä¸º3ä½ç²¾åº¦æ¯«ç§’<br>maxcomputeçš„formatæ ¼å¼ï¼šyyyyä¸º4ä½æ•°çš„å¹´ï¼Œmmä¸º2ä½æ•°çš„æœˆï¼Œddä¸º2ä½æ•°çš„æ—¥ï¼Œhhä¸º24å°æ—¶åˆ¶çš„æ—¶ï¼Œmiä¸º2ä½æ•°çš„åˆ†é’Ÿï¼Œssä¸º2ä½æ•°çš„ç§’ï¼Œff3ä¸º3ä½ç²¾åº¦æ¯«ç§’</p><h4 id="ä¸¾ä¾‹-5"><a href="#ä¸¾ä¾‹-5" class="headerlink" title="ä¸¾ä¾‹"></a>ä¸¾ä¾‹</h4><p>æµ‹è¯•sql</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> to_date(<span class="string">&#x27;20221118123456&#x27;</span>,<span class="string">&#x27;yyyyMMddHHmmss&#x27;</span>),to_date(<span class="string">&#x27;2022-11-18 12:34:56&#x27;</span>,<span class="string">&#x27;yyyy-MM-dd HH:mm:ss&#x27;</span>);</span><br></pre></td></tr></table></figure><p><strong>maxcomputeè¿è¡Œç»“æœ</strong><br><img src="https://i.328888.xyz/2023/02/21/gtY0p.png" alt="gtY0p.png"></p><p>maxcomputeæŠ¥å¼‚å¸¸ï¼š FAILED: ODPS-0121095:Invalid arguments - format string has second part, but doesnâ€™t have minute part : yyyyMMddHHmmss</p><p><strong>hiveè¿è¡Œç»“æœ</strong><br><img src="https://i.328888.xyz/2023/02/21/gtqXU.png" alt="gtqXU.png"></p><p>hiveæŠ¥å¼‚å¸¸ï¼š Arguments length mismatch â€˜â€™yyyyMMddhhmmssâ€™â€™: to_date() requires 1 argument, got 2</p><p>æç¤ºçš„æ˜¯to_dateå‡½æ•°ä»…æœ‰1ä¸ªå‚æ•°</p><p>å»æ‰formatå‚æ•°åçš„è¿è¡Œç»“æœä¸ºï¼š<br><img src="https://i.328888.xyz/2023/02/21/gtuJv.png" alt="gtuJv.png"></p><p>ä»ç»“æœå¯ä»¥çœ‹åˆ°ï¼Œto_dateä¸èƒ½è§£æ yyyyMMddhhmmss å’Œ yyyyMMdd æ ¼å¼</p><p><strong>sparkè¿è¡Œç»“æœ</strong><br><img src="https://i.328888.xyz/2023/02/21/gWiD3.png" alt="gWiD3.png"></p><p>sparkèƒ½é¡ºåˆ©äº§å‡ºç»“æœ</p><h4 id="æ›¿æ¢æ–¹æ¡ˆ-4"><a href="#æ›¿æ¢æ–¹æ¡ˆ-4" class="headerlink" title="æ›¿æ¢æ–¹æ¡ˆ"></a>æ›¿æ¢æ–¹æ¡ˆ</h4><p>formatæ ¼å¼ä¿®æ”¹ï¼šyyyyä¸º4ä½æ•°çš„å¹´ï¼Œmmä¸º2ä½æ•°çš„æœˆï¼Œddä¸º2ä½æ•°çš„æ—¥ï¼Œhhä¸º24å°æ—¶åˆ¶çš„æ—¶ï¼Œmiä¸º2ä½æ•°çš„åˆ†é’Ÿï¼Œssä¸º2ä½æ•°çš„ç§’ï¼Œff3ä¸º3ä½ç²¾åº¦æ¯«ç§’</p><p>ä¿®æ”¹åçš„èƒ½æ­£å¸¸äº§å‡ºç»“æœï¼š<br><img src="https://i.328888.xyz/2023/02/21/gW4i8.png" alt="gW4i8.png"></p><p>å¦ï¼Œå¸¸è§ä½¿ç”¨to_dateæŠ¥é”™sqlä¸º date_format(date_add(to_date(pay_time,â€™yyyyMMddHHmmssâ€™),2),â€™yyyyMMddHHmmssâ€™) ï¼Œè§£è¯»sqlçš„ä½œç”¨æ˜¯å¯¹ pay_time åŠ  2 å¤©ï¼Œå»ºè®®ç”¨ UDF ä¿®æ”¹è¿™æ®µsqlä¸º yt_date_add(pay_time,2)ï¼Œä¿®æ”¹åç®€æ´æ˜äº†</p><h1 id="dateæ—¥æœŸå‡½æ•°"><a href="#dateæ—¥æœŸå‡½æ•°" class="headerlink" title="dateæ—¥æœŸå‡½æ•°"></a>dateæ—¥æœŸå‡½æ•°</h1><h4 id="å·®å¼‚ç‚¹-6"><a href="#å·®å¼‚ç‚¹-6" class="headerlink" title="å·®å¼‚ç‚¹"></a>å·®å¼‚ç‚¹</h4><p>sparkå’Œhiveçš„dateå‡½æ•°æ”¯æŒå°†æ ‡å‡†çš„æ—¥æœŸstringè½¬æ¢ä¸ºdateç±»å‹</p><p>maxcomputer dateå‡½æ•°åªæ”¯æŒæ ‡å‡†çš„æ—¥æœŸstringï¼Œå¸¦æ—¶åˆ†ç§’çš„æ—¶é—´stringä¸æ”¯æŒ</p><h4 id="ä¸¾ä¾‹-6"><a href="#ä¸¾ä¾‹-6" class="headerlink" title="ä¸¾ä¾‹"></a>ä¸¾ä¾‹</h4><p>æµ‹è¯•sql</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="type">date</span>(<span class="string">&#x27;2022-12-21&#x27;</span>),<span class="type">date</span>(<span class="string">&#x27;2022-12-21 01:22:01&#x27;</span>);</span><br></pre></td></tr></table></figure><p><strong>maxcomputeè¿è¡Œç»“æœ</strong><br><img src="https://i.328888.xyz/2023/02/21/gWt0Q.png" alt="gWt0Q.png"></p><p>maxcomputerå¯¹æ ‡å‡†çš„æ—¥æœŸstringã€2022-12-21ã€‘è½¬æ¢æ­£ç¡®</p><p>ä½†æ˜¯å¯¹å¸¦æ—¶åˆ†ç§’çš„stringè½¬ä¸ºé”™è¯¯ï¼Œç›´æ¥ä¸ºnull</p><p><strong>hiveè¿è¡Œç»“æœ</strong><br><img src="https://i.328888.xyz/2023/02/21/gWWXE.png" alt="gWWXE.png"></p><p>ç»“æœç¬¦åˆé¢„æœŸ</p><p><strong>sparkè¿è¡Œç»“æœ</strong><br><img src="https://i.328888.xyz/2023/02/21/gWkKC.png" alt="gWkKC.png"></p><p>sparkèƒ½é¡ºåˆ©äº§å‡ºç»“æœ</p><h4 id="æ›¿æ¢æ–¹æ¡ˆ-5"><a href="#æ›¿æ¢æ–¹æ¡ˆ-5" class="headerlink" title="æ›¿æ¢æ–¹æ¡ˆ"></a>æ›¿æ¢æ–¹æ¡ˆ</h4><p>å¦‚æœæ˜¯ä¸ºäº†æ ¼å¼è½¬æ¢ï¼Œä½¿ç”¨è‡ªå®šä¹‰ yt_date_format å‡½æ•°</p><p>å¦‚æœæ˜¯ä¸ºäº†è·å–dateç±»å‹ï¼Œä½¿ç”¨ to_dateå‡½æ•°</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> yt_date_format(<span class="string">&#x27;2022-12-21 01:22:01&#x27;</span>,<span class="string">&#x27;yyyy-MM-dd&#x27;</span>)</span><br><span class="line">,to_date(<span class="string">&#x27;2022-12-21 01:22:01&#x27;</span>);</span><br></pre></td></tr></table></figure><p><img src="https://i.328888.xyz/2023/02/21/gWCDP.png" alt="gWCDP.png"></p><h1 id="from-unixtimeå‡½æ•°"><a href="#from-unixtimeå‡½æ•°" class="headerlink" title="from_unixtimeå‡½æ•°"></a>from_unixtimeå‡½æ•°</h1><h4 id="å·®å¼‚ç‚¹-7"><a href="#å·®å¼‚ç‚¹-7" class="headerlink" title="å·®å¼‚ç‚¹"></a>å·®å¼‚ç‚¹</h4><p>sparkå’Œhiveçš„from_unixtimeå‡½æ•°å°†æ—¶é—´æˆ³è½¬æ¢æˆæ ¼å¼åŒ–stringç±»å‹ï¼Œå½“æ—¶é—´æˆ³ä¸ºè´Ÿæ•°æ—¶ï¼Œæ­£å¸¸è½¬æ¢</p><p>maxcomputer from_unixtimeå‡½æ•°è½¬æ¢è´Ÿæ•°æ—¶é—´æˆ³æ—¶ï¼Œå­˜åœ¨æ—¶é—´ä¾¿å®œ</p><h4 id="ä¸¾ä¾‹-7"><a href="#ä¸¾ä¾‹-7" class="headerlink" title="ä¸¾ä¾‹"></a>ä¸¾ä¾‹</h4><p>æµ‹è¯•sql<br>select â€˜1018-10-15 00:00:00â€™  â€“ yyyyMMddHHmmss æ—¶é—´æˆ³<br>,unix_timestamp(â€˜1018-10-15 00:00:00â€™) â€“æ—¶é—´æˆ³<br>,from_unixtime(unix_timestamp(â€˜1018-10-15 00:00:00â€™),â€™yyyyMMddHHmmssâ€™) â€“è½¬æ¢æ ¼å¼</p><p><strong>maxcomputeè¿è¡Œç»“æœ</strong><br><img src="https://i.328888.xyz/2023/02/21/gWHiJ.png" alt="gWHiJ.png"></p><p>å¯ä»¥çœ‹åˆ°ï¼ŒåŸå…ˆæ—¥æœŸä¸º â€˜1018-10-15 00:00:00â€™,è½¬æ¢æˆyyyyMMddHHmmssæ ¼å¼åŸæœ¬æœŸæœ›ä¸º  10181015000000</p><p>ä½†æ˜¯å®é™…ç»“æœä¸º10181008235417,å’Œé¢„æœŸä¸ç¬¦åˆ</p><p><strong>hiveè¿è¡Œç»“æœ</strong><br><img src="https://i.328888.xyz/2023/02/21/gWObc.png" alt="gWObc.png"></p><p>hiveç»“æœç¬¦åˆé¢„æœŸ</p><p><strong>sparkè¿è¡Œç»“æœ</strong><br><img src="https://i.328888.xyz/2023/02/21/gWb6A.png" alt="gWb6A.png"></p><p>sparkäº§å‡ºç»“æœæ­£ç¡®</p><h4 id="æ›¿æ¢æ–¹æ¡ˆ-6"><a href="#æ›¿æ¢æ–¹æ¡ˆ-6" class="headerlink" title="æ›¿æ¢æ–¹æ¡ˆ"></a>æ›¿æ¢æ–¹æ¡ˆ</h4><p>ä½¿ç”¨è‡ªå®šä¹‰ yt_date_format å‡½æ•°</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="string">&#x27;1018-10-15 00:00:00&#x27;</span> <span class="comment">-- yyyyMMddHHmmss æ—¶é—´æˆ³</span></span><br><span class="line">,unix_timestamp(<span class="string">&#x27;1018-10-15 00:00:00&#x27;</span>) <span class="comment">--æ—¶é—´æˆ³</span></span><br><span class="line">,yt_date_format(<span class="string">&#x27;1018-10-15 00:00:00&#x27;</span>,<span class="string">&#x27;yyyyMMddHHmmss&#x27;</span>) <span class="comment">--è½¬æ¢æ ¼å¼</span></span><br></pre></td></tr></table></figure><p><img src="https://i.328888.xyz/2023/02/21/gWICN.png" alt="gWICN.png"><br>ä½¿ç”¨è‡ªå®šä¹‰udfåæ­£ç¡®</p><h1 id="concat-wså·®å¼‚"><a href="#concat-wså·®å¼‚" class="headerlink" title="concat_wså·®å¼‚"></a>concat_wså·®å¼‚</h1><h4 id="å·®å¼‚ç‚¹-8"><a href="#å·®å¼‚ç‚¹-8" class="headerlink" title="å·®å¼‚ç‚¹"></a>å·®å¼‚ç‚¹</h4><p>sparkçš„concat_wsä¼šæ”¯æŒç±»å‹çš„éšå¼è½¬æ¢</p><p>hiveå’Œmaxcomputer concat_wsä¸æ”¯æŒï¼Œåªæ”¯æŒåŒç±»å‹ä½¿ç”¨</p><h4 id="ä¸¾ä¾‹-8"><a href="#ä¸¾ä¾‹-8" class="headerlink" title="ä¸¾ä¾‹"></a>ä¸¾ä¾‹</h4><p>æµ‹è¯•sql</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> concat_ws(&quot;,&quot;,<span class="keyword">array</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>))</span><br></pre></td></tr></table></figure><p><strong>maxcomputeè¿è¡Œç»“æœ</strong><br><img src="https://i.328888.xyz/2023/02/21/gWNgV.png" alt="gWNgV.png"></p><p>æŠ¥é”™æç¤ºæ•°æ®ç±»å‹ä¸å¯¹ï¼Œconcat_wsåªèƒ½å¤„ç†ARRAY<STRING>æ•°æ®ç±»å‹ï¼Œè€Œsqlä¸­æ˜¯ARRAY<INT>æ•°æ®ç±»å‹ï¼Œ<a href="https://help.aliyun.com/document_detail/455513.html?spm=a2c4g.11186623.0.0.28686fd3N35cvE">å®˜æ–¹æ–‡æ¡£</a> ä¸­æœ‰è¯¦ç»†è¯´æ˜<br><img src="https://i.328888.xyz/2023/02/21/gWmSz.png" alt="gWmSz.png"></p><p><strong>hiveè¿è¡Œç»“æœ</strong><br><img src="https://i.328888.xyz/2023/02/21/gWBVw.png" alt="gWBVw.png"></p><p>æŠ¥é”™æç¤ºæ•°æ®ç±»å‹ä¸å¯¹ï¼Œä¸maxcomputeä¸€ä¸ªæ„æ€ï¼Œconcat_wsä¼ å…¥æ•°ç»„å¿…é¡»æ˜¯Array<int>ç±»å‹</p><p><strong>sparkè¿è¡Œç»“æœ</strong></p><p><img src="https://i.328888.xyz/2023/02/21/gWXba.png" alt="gWXba.png"></p><p>sparkæ‰§è¡Œç»“æœç¬¦åˆé¢„æœŸ</p><h4 id="æ›¿æ¢æ–¹æ¡ˆ-7"><a href="#æ›¿æ¢æ–¹æ¡ˆ-7" class="headerlink" title="æ›¿æ¢æ–¹æ¡ˆ"></a>æ›¿æ¢æ–¹æ¡ˆ</h4><p>ä½¿ç”¨é˜¿é‡Œäº‘æä¾›çš„array_joinå‡½æ•°</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> array_join(<span class="keyword">array</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>),&quot;,&quot;);</span><br></pre></td></tr></table></figure><p><img src="https://i.328888.xyz/2023/02/21/gWegp.png" alt="gWegp.png"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;having-å·®å¼‚&quot;&gt;&lt;a href=&quot;#having-å·®å¼‚&quot; class=&quot;headerlink&quot; title=&quot;having å·®å¼‚&quot;&gt;&lt;/a&gt;having å·®å¼‚&lt;/h1&gt;&lt;h4 id=&quot;å·®å¼‚ç‚¹&quot;&gt;&lt;a href=&quot;#å·®å¼‚ç‚¹&quot; class=&quot;headerlink</summary>
      
    
    
    
    <category term="SQL" scheme="https://llye-hub.github.io/categories/SQL/"/>
    
    
    <category term="Maxcompute" scheme="https://llye-hub.github.io/tags/Maxcompute/"/>
    
  </entry>
  
  <entry>
    <title>mysqlå’ŒhiveSQLçš„è¯­æ³•å·®åˆ«</title>
    <link href="https://llye-hub.github.io/posts/e912f2da.html"/>
    <id>https://llye-hub.github.io/posts/e912f2da.html</id>
    <published>2023-02-17T08:06:16.000Z</published>
    <updated>2023-02-21T06:25:32.460Z</updated>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘åœ¨ç‰›å®¢ç½‘ä¸Šåˆ·sqlé¢˜ï¼Œä½†ç¼–ç¨‹è¯­è¨€å±…ç„¶åªæ”¯æŒmysqlï¼Œä¸€äº›å‡½æ•°ç”¨æ³•ä¸Šä¸å¹³æ—¶å·¥ä½œä½¿ç”¨çš„hiveSQLæœ‰è¾ƒå¤§å·®åˆ«ï¼Œæ‰€ä»¥åœ¨è¿™ç¯‡åšå®¢ä¸­æ•´ç†ä¸€ä¸‹ä¸¤ç§è¯­æ³•çš„å‡½æ•°ä½¿ç”¨å·®å¼‚</p><p><a href="">mysqlå†…ç½®å‡½æ•°</a></p><p><a href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual+UDF?spm=a2c4g.11186623.0.0.3c267254Ka3fUh#LanguageManualUDF-get_json_object">hiveå†…ç½®å‡½æ•°</a></p><h1 id="æ—¥æœŸã€æ—¶é—´å‡½æ•°"><a href="#æ—¥æœŸã€æ—¶é—´å‡½æ•°" class="headerlink" title="æ—¥æœŸã€æ—¶é—´å‡½æ•°"></a>æ—¥æœŸã€æ—¶é—´å‡½æ•°</h1><table><thead><tr><th>å‡½æ•°ç”¨é€”</th><th>mysqlå‡½æ•°</th><th>mysqlç”¨æ³•</th><th>hiveå‡½æ•°</th><th>hiveSQLç”¨æ³•</th></tr></thead><tbody><tr><td>æ—¥æœŸã€æ—¶é—´æ ¼å¼åŒ–</td><td>date_format</td><td>date_format(â€˜2008-08-08 22:23:01â€™, â€˜%Y%m%d%H%i%sâ€™)</td><td>date_format</td><td>date_format(â€˜2008-08-08 22:23:01â€™, â€˜yyyyMMddHHmmssâ€™)</td></tr><tr><td>æ—¥æœŸã€æ—¶é—´åŠ </td><td>date_add</td><td>date_add(â€˜2008-08-08 22:23:01â€™,interval 1 day&#x2F;hour&#x2F;minute&#x2F;second&#x2F;microsecond&#x2F;week&#x2F;month&#x2F;quarter&#x2F;year)ï¼Œè¿”å›dateTimeæ ¼å¼</td><td>date_add</td><td>date_add(â€˜2008-08-08 22:23:01â€™,1)ï¼ŒåªåŠ daysï¼Œè¿”å›dateæ ¼å¼</td></tr><tr><td>æ—¥æœŸã€æ—¶é—´å‡</td><td>date_sub</td><td>date_sub(â€˜2008-08-08 22:23:01â€™,interval 1 day&#x2F;hour&#x2F;minute&#x2F;second&#x2F;microsecond&#x2F;week&#x2F;month&#x2F;quarter&#x2F;year)ï¼Œè¿”å›dateTimeæ ¼å¼</td><td>date_sub</td><td>date_sub(â€˜2008-08-08 22:23:01â€™,1)ï¼ŒåªåŠ daysï¼Œè¿”å›dateæ ¼å¼</td></tr><tr><td>æ—¥æœŸç›¸å·®</td><td>datediff</td><td>datediff(â€˜2008-08-08 22:22:00â€™,â€™2008-08-07 22:23:00â€™)</td><td>datediff</td><td>datediff(â€˜2008-08-08 22:22:00â€™,â€™2008-08-07 22:23:00â€™)</td></tr></tbody></table>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;æœ€è¿‘åœ¨ç‰›å®¢ç½‘ä¸Šåˆ·sqlé¢˜ï¼Œä½†ç¼–ç¨‹è¯­è¨€å±…ç„¶åªæ”¯æŒmysqlï¼Œä¸€äº›å‡½æ•°ç”¨æ³•ä¸Šä¸å¹³æ—¶å·¥ä½œä½¿ç”¨çš„hiveSQLæœ‰è¾ƒå¤§å·®åˆ«ï¼Œæ‰€ä»¥åœ¨è¿™ç¯‡åšå®¢ä¸­æ•´ç†ä¸€ä¸‹ä¸¤ç§è¯­æ³•çš„å‡½æ•°ä½¿ç”¨å·®å¼‚&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;&quot;&gt;mysqlå†…ç½®å‡½æ•°&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://</summary>
      
    
    
    
    <category term="SQL" scheme="https://llye-hub.github.io/categories/SQL/"/>
    
    
  </entry>
  
  <entry>
    <title>æ’åºç®—æ³•</title>
    <link href="https://llye-hub.github.io/posts/735e5788.html"/>
    <id>https://llye-hub.github.io/posts/735e5788.html</id>
    <published>2023-02-17T05:46:19.000Z</published>
    <updated>2023-02-17T05:59:36.946Z</updated>
    
    <content type="html"><![CDATA[<p>æ•´ç†ä¸€äº›æ•°æ®ç»“æ„ä¸­å¸¸ç”¨çš„æ’åºç®—æ³•åŸç†å’Œjavaå®ç°</p><h1><span id="å¿«é€Ÿæ’åº">å¿«é€Ÿæ’åº</span></h1><h2><span id="åŸç†">åŸç†</span></h2><p>åœ¨æ•°ç»„ä¸­æ‰¾åˆ°ä¸€ä¸ªåŸºå‡†å€¼<code>t</code>ï¼Œå°†å°äº<code>t</code>çš„å€¼æ”¾å®ƒå‰é¢ï¼Œå¤§äº<code>t</code>çš„å€¼æ”¾å®ƒåé¢ï¼Œå†ä»¥æ­¤æ–¹æ³•å¯¹å­æ•°ç»„é€’å½’è¿›è¡Œå¿«é€Ÿæ’åº</p><h2><span id="javaä»£ç ">javaä»£ç </span></h2>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;æ•´ç†ä¸€äº›æ•°æ®ç»“æ„ä¸­å¸¸ç”¨çš„æ’åºç®—æ³•åŸç†å’Œjavaå®ç°&lt;/p&gt;
&lt;h1&gt;&lt;span id=&quot;å¿«é€Ÿæ’åº&quot;&gt;å¿«é€Ÿæ’åº&lt;/span&gt;&lt;/h1&gt;&lt;h2&gt;&lt;span id=&quot;åŸç†&quot;&gt;åŸç†&lt;/span&gt;&lt;/h2&gt;&lt;p&gt;åœ¨æ•°ç»„ä¸­æ‰¾åˆ°ä¸€ä¸ªåŸºå‡†å€¼&lt;code&gt;t&lt;/code&gt;ï¼Œå°†å°äº&lt;code&gt;t</summary>
      
    
    
    
    <category term="åˆ·é¢˜" scheme="https://llye-hub.github.io/categories/%E5%88%B7%E9%A2%98/"/>
    
    
  </entry>
  
  <entry>
    <title>è§£é¢˜æ€è·¯ä¹‹åŠ¨æ€è§„åˆ’</title>
    <link href="https://llye-hub.github.io/posts/d6cdfd6a.html"/>
    <id>https://llye-hub.github.io/posts/d6cdfd6a.html</id>
    <published>2023-02-16T09:11:19.000Z</published>
    <updated>2023-02-20T09:07:20.705Z</updated>
    
    <content type="html"><![CDATA[<h1><span id="ä»€ä¹ˆæ˜¯åŠ¨æ€è§„åˆ’">ä»€ä¹ˆæ˜¯åŠ¨æ€è§„åˆ’</span></h1><p>åŠ¨æ€è§„åˆ’ï¼Œè‹±æ–‡ï¼šDynamic Programmingï¼Œç®€ç§°DPã€‚<br>ç®€å•ç†è§£ï¼ŒåŠ¨æ€è§„åˆ’çš„æ¯ä¸€ä¸ªçŠ¶æ€éƒ½èƒ½ç”±ä¸Šä¸€ä¸ªçŠ¶æ€æ¨å¯¼è€Œæ¥</p><h1><span id="è§£é¢˜æ­¥éª¤">è§£é¢˜æ­¥éª¤</span></h1><p>ä»¥æ–æ³¢é‚£å¥‘æ•°åˆ—ä¸ºä¾‹ï¼ŒåŠ¨æ€è§„åˆ’é—®é¢˜å¯ä»¥æ‹†è§£ä¸ºäº”æ­¥æ›²ï¼š</p><p>1ã€ç¡®å®šdpæ•°ç»„å’Œä¸‹æ ‡å«ä¹‰ï¼šç¬¬nä¸ªæ–æ³¢é‚£å¥‘æ•°æ˜¯<code>dp[n]</code></p><p>2ã€ç¡®å®šé€’æ¨å…¬å¼ï¼ˆä¹Ÿå¯å«çŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼‰ï¼š<code>dp[n] = dp[n-1] + dp[n-2]</code></p><p>3ã€dpæ•°ç»„åˆå§‹åŒ–ï¼š<code>dp[0] = 0; dp[1] = 1</code></p><p>4ã€ç¡®å®šéå†é¡ºåºï¼šä»å‰åˆ°åéå†ï¼Œ<code>dp[n]</code>ä¾èµ–<code>dp[n-1]</code>å’Œ<code>dp[n-2]</code></p><p>5ã€ä¸¾ä¾‹æ¨å¯¼dpæ•°ç»„ï¼šå½“<code>n=10</code>æ—¶ï¼Œdpæ•°ç»„åº”è¯¥ä¸ºï¼š<code>0 1 1 2 3 5 8 13 21 34 55</code></p><h1><span id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</span></h1><p><a href="https://programmercarl.com/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92%E7%90%86%E8%AE%BA%E5%9F%BA%E7%A1%80.html#%E4%BB%80%E4%B9%88%E6%98%AF%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92">ä»£ç éšæƒ³å½•ä¹‹åŠ¨æ€è§„åˆ’</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1&gt;&lt;span id=&quot;ä»€ä¹ˆæ˜¯åŠ¨æ€è§„åˆ’&quot;&gt;ä»€ä¹ˆæ˜¯åŠ¨æ€è§„åˆ’&lt;/span&gt;&lt;/h1&gt;&lt;p&gt;åŠ¨æ€è§„åˆ’ï¼Œè‹±æ–‡ï¼šDynamic Programmingï¼Œç®€ç§°DPã€‚&lt;br&gt;ç®€å•ç†è§£ï¼ŒåŠ¨æ€è§„åˆ’çš„æ¯ä¸€ä¸ªçŠ¶æ€éƒ½èƒ½ç”±ä¸Šä¸€ä¸ªçŠ¶æ€æ¨å¯¼è€Œæ¥&lt;/p&gt;
&lt;h1&gt;&lt;span id=&quot;è§£é¢˜æ­¥éª¤&quot;&gt;è§£é¢˜æ­¥éª¤&lt;/</summary>
      
    
    
    
    <category term="åˆ·é¢˜" scheme="https://llye-hub.github.io/categories/%E5%88%B7%E9%A2%98/"/>
    
    
    <category term="LeetCode" scheme="https://llye-hub.github.io/tags/LeetCode/"/>
    
  </entry>
  
  <entry>
    <title>SparkSQLä¼˜åŒ–ä¹‹æ•°æ®å€¾æ–œ</title>
    <link href="https://llye-hub.github.io/posts/faab1ad7.html"/>
    <id>https://llye-hub.github.io/posts/faab1ad7.html</id>
    <published>2023-02-09T02:19:52.000Z</published>
    <updated>2023-02-15T06:12:42.997Z</updated>
    
    <content type="html"><![CDATA[<h1><span id="å‰è¨€">å‰è¨€</span></h1><p>åœ¨Sparkä½œä¸šä¼˜åŒ–åœºæ™¯ä¸­ï¼Œæœ€å¸¸è§ä¸”æ¯”è¾ƒæ£˜æ‰‹çš„å°±æ˜¯æ•°æ®å€¾æ–œé—®é¢˜ã€‚ä¸ªäººè®¤ä¸ºï¼Œå…·å¤‡æ•°æ®å€¾æ–œè°ƒä¼˜èƒ½åŠ›å¯¹ä»äº‹æ•°ä»“å¼€å‘äººå‘˜æ˜¯å¿…å¤‡çš„åŸºæœ¬è¦æ±‚ã€‚å½“ç„¶ï¼Œæ•°æ®å€¾æ–œçš„åœºæ™¯æ˜¯æ¯”è¾ƒå¤æ‚çš„ï¼Œé’ˆå¯¹ä¸åŒçš„æ•°æ®å€¾æ–œæœ‰ä¸åŒçš„å¤„ç†æ–¹æ¡ˆã€‚</p><h1><span id="å¦‚ä½•è¾¨åˆ«å’Œå®šä½æ•°æ®å€¾æ–œ">å¦‚ä½•è¾¨åˆ«å’Œå®šä½æ•°æ®å€¾æ–œ</span></h1><p>ä»Sparkä½œä¸šçš„æ‰§è¡Œè®¡åˆ’çœ‹ï¼Œè‹¥å‡ºç°æŸä¸ªtaskä»»åŠ¡æ¯”å…¶ä»–taskä»»åŠ¡æ‰§è¡Œè€—æ—¶æå…¶ä¹…ï¼Œæ¯”å¦‚ï¼šæŸä¸ªstageæœ‰100ä¸ªtaskï¼Œå…¶ä¸­99ä¸ªtaskåœ¨1minå·¦å³å°±æ‰§è¡ŒæˆåŠŸï¼Œä½†æ˜¯æœ‰1ä¸ªtaskå´æ‰§è¡Œäº†1ä¸ªå°æ—¶ç”šè‡³æ›´ä¹…ï¼Œè¿™ç§æƒ…å†µæ˜¾ç„¶æ˜¯å‡ºç°äº†æ•°æ®å€¾æ–œã€‚</p><p>æ•°æ®å€¾æ–œé—®é¢˜ä»…å‡ºç°åœ¨shuffleè¿‡ç¨‹ï¼Œä¸€äº›ä¼šè§¦å‘shuffleçš„ç®—å­ï¼šdistinctã€groupByKeyã€reduceByKeyã€aggregateByKeyã€countByKeyã€joinã€cogroupã€repartitionç­‰ã€‚<br>å¯¹åº”æäº¤çš„SparkSQLä¸­å¯èƒ½æœ‰distinctã€count(distinct)ã€group byã€partition byã€joinç­‰å…³é”®è¯ã€‚</p><h1><span id="å¸¸è§çš„æ•°æ®å€¾æ–œåœºæ™¯åŠè§£å†³æ–¹æ¡ˆ">å¸¸è§çš„æ•°æ®å€¾æ–œåœºæ™¯åŠè§£å†³æ–¹æ¡ˆ</span></h1><h1><span id="ç¢°åˆ°çš„æ•°æ®å€¾æ–œæ¡ˆä¾‹">ç¢°åˆ°çš„æ•°æ®å€¾æ–œæ¡ˆä¾‹</span></h1><h2><span id="çª—å£åˆ†ç»„æ•°æ®å€¾æ–œ">çª—å£åˆ†ç»„æ•°æ®å€¾æ–œ</span></h2><p><strong>å€¾æ–œåœºæ™¯</strong><br>ä¸šåŠ¡ä¸Šæœ‰ä¸€å¼ æ¶ˆæ¯è®°å½•è¡¨msg_recordsï¼Œsqlè¦æ±‚æ˜¯å–ä¸‹ä¸€æ¬¡å›å¤æ¶ˆæ¯</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">WITH</span> msg_tmp <span class="keyword">as</span></span><br><span class="line">(</span><br><span class="line">    <span class="keyword">select</span>  id                  <span class="comment">-- å”¯ä¸€é”®ï¼Œæ¶ˆæ¯id</span></span><br><span class="line">           ,from_chat_id        <span class="comment">-- æ¶ˆæ¯å‘é€è€…id</span></span><br><span class="line">           ,to_chat_id          <span class="comment">-- æ¶ˆæ¯æ¥å—è€…id</span></span><br><span class="line">           ,msg_time            <span class="comment">-- æ¶ˆæ¯æ—¶é—´</span></span><br><span class="line">    <span class="keyword">from</span> msg_records</span><br><span class="line">)</span><br><span class="line"><span class="keyword">select</span>  id</span><br><span class="line">       ,msg_time</span><br><span class="line">       ,<span class="built_in">first_value</span>(if(type <span class="operator">=</span> <span class="string">&#x27;reply&#x27;</span>,id,<span class="keyword">null</span>),<span class="literal">true</span>) <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> from_chat_id,to_chat_id <span class="keyword">order</span> <span class="keyword">by</span> msg_time,id <span class="keyword">rows</span> <span class="keyword">between</span> <span class="number">1</span> following <span class="keyword">and</span> unbounded following) <span class="keyword">as</span> reply_msg_id_n1t <span class="comment">-- å–ä¸‹ä¸€æ¬¡å›å¤æ¶ˆæ¯</span></span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">(</span><br><span class="line">    <span class="keyword">select</span>  id</span><br><span class="line">           ,from_chat_id</span><br><span class="line">           ,to_chat_id</span><br><span class="line">           ,msg_time</span><br><span class="line">           ,<span class="string">&#x27;send&#x27;</span> <span class="keyword">as</span> type</span><br><span class="line">    <span class="keyword">from</span> msg_tmp</span><br><span class="line">    <span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line">    <span class="comment">-- è°ƒè½¬ï¼Œå–è¿”å›æ¶ˆæ¯</span></span><br><span class="line">    <span class="keyword">select</span>  id</span><br><span class="line">           ,to_chat_id   <span class="keyword">as</span> from_chat_id</span><br><span class="line">           ,from_chat_id <span class="keyword">as</span> to_chat_id</span><br><span class="line">           ,msg_time</span><br><span class="line">           ,<span class="string">&#x27;reply&#x27;</span>      <span class="keyword">as</span> type</span><br><span class="line">    <span class="keyword">from</span> msg_tmp</span><br><span class="line">) t1</span><br></pre></td></tr></table></figure><p><strong>sqlæ‰§è¡Œåˆ†æ</strong><br>æœ‰ä¸€ä¸ªtaskæ‰§è¡Œè€—æ—¶1h<br><img src="https://i.328888.xyz/2023/02/10/R2j3w.png" alt="R2j3w.png"></p><p><strong>æ•°æ®å€¾æ–œåˆ†æ</strong><br>æ ¹æ®çª—å£å‡½æ•°çš„åˆ†ç»„<code>from_chat_id + to_chat_id</code>åˆ†æï¼Œæ•°æ®é‡å‡ºç°ä¸¥é‡å€¾æ–œï¼Œè¡¨æ€»æ•°æ®é‡1äº¿å¤šï¼Œå…¶ä¸­ï¼Œåˆ†ç»„<code>from_chat_id=12 and to_chat_id=81867</code>çš„æ•°æ®é‡æœ‰30wï¼Œå…¶ä»–åˆ†ç»„æ•°æ®é‡è‡³å¤š3wã€‚</p><p>å¦å¤–ï¼Œåˆ†ç»„<code>from_chat_id=12 and to_chat_id=81867</code>çš„æ•°æ®åœ¨ä¸šåŠ¡ä¸Šå¯å®šä¹‰ä¸ºè„æ•°æ®ï¼Œä¸”first_value()å‡½æ•°è®¡ç®—å‡ºçš„å€¼å…¨ä¸ºnullã€‚</p><p>ç»è¿‡æµ‹è¯•éªŒè¯å‘ç°ï¼Œæ²¡æœ‰ <strong>rows betweenè¯­å¥</strong> æˆ–æ˜¯ <strong>è¿‡æ»¤å€¾æ–œæ•°æ®</strong> æ—¶ï¼ŒSQLæ‰§è¡Œå¾ˆå¿«</p><p>ç»¼ä¸Šåˆ†æï¼Œå†å¯¹ç…§sparkæ‰§è¡Œè®¡åˆ’åŸºæœ¬å¯ä»¥å®šä½å€¾æ–œåŸå› ä¸º<strong>çª—å£æ•°æ®å€¾æ–œå’Œrows betweenè®¡ç®—è€—æ—¶</strong></p><p><strong>è§£å†³æ–¹æ¡ˆ</strong><br>ç»“åˆä¸šåŠ¡çŸ¥è¯†ï¼Œåœ¨sqlé€»è¾‘ä¸­è¿‡æ»¤<code>from_chat_id=12 and to_chat_id=81867</code>çš„æ•°æ®</p><p>æœ€ç»ˆï¼Œä»»åŠ¡æ‰§è¡Œè€—æ—¶ä»<code>1h</code>ä¼˜åŒ–è‡³<code>10min</code></p><h1><span id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</span></h1><p><a href="https://tech.meituan.com/2016/05/12/spark-tuning-pro.html">ç¾å›¢æŠ€æœ¯å›¢é˜Ÿï¼šSparkæ€§èƒ½ä¼˜åŒ–æŒ‡å—â€”â€”é«˜çº§ç¯‡</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1&gt;&lt;span id=&quot;å‰è¨€&quot;&gt;å‰è¨€&lt;/span&gt;&lt;/h1&gt;&lt;p&gt;åœ¨Sparkä½œä¸šä¼˜åŒ–åœºæ™¯ä¸­ï¼Œæœ€å¸¸è§ä¸”æ¯”è¾ƒæ£˜æ‰‹çš„å°±æ˜¯æ•°æ®å€¾æ–œé—®é¢˜ã€‚ä¸ªäººè®¤ä¸ºï¼Œå…·å¤‡æ•°æ®å€¾æ–œè°ƒä¼˜èƒ½åŠ›å¯¹ä»äº‹æ•°ä»“å¼€å‘äººå‘˜æ˜¯å¿…å¤‡çš„åŸºæœ¬è¦æ±‚ã€‚å½“ç„¶ï¼Œæ•°æ®å€¾æ–œçš„åœºæ™¯æ˜¯æ¯”è¾ƒå¤æ‚çš„ï¼Œé’ˆå¯¹ä¸åŒçš„æ•°æ®å€¾æ–œæœ‰ä¸åŒçš„å¤„ç†æ–¹æ¡ˆã€‚&lt;/p&gt;
</summary>
      
    
    
    
    <category term="SQLä¼˜åŒ–" scheme="https://llye-hub.github.io/categories/SQL%E4%BC%98%E5%8C%96/"/>
    
    
    <category term="æ•°æ®å€¾æ–œ" scheme="https://llye-hub.github.io/tags/%E6%95%B0%E6%8D%AE%E5%80%BE%E6%96%9C/"/>
    
  </entry>
  
  <entry>
    <title>hiveSQLä¹‹ç”Ÿæˆè¿ç»­æ•°å­—</title>
    <link href="https://llye-hub.github.io/posts/3ce3d37f.html"/>
    <id>https://llye-hub.github.io/posts/3ce3d37f.html</id>
    <published>2023-02-08T08:03:36.000Z</published>
    <updated>2023-02-20T03:39:51.495Z</updated>
    
    <content type="html"><![CDATA[<h1><span id="sqlè¦æ±‚">sqlè¦æ±‚</span></h1><p>ç”Ÿæˆ100ä»¥å†…çš„å…¨éƒ¨æ•´æ•°</p><h1><span id="æ¶‰åŠudtfå‡½æ•°">æ¶‰åŠudtfå‡½æ•°</span></h1><p><strong>posexplode</strong>(ARRAY&lt;T&gt; a) <a href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual+UDF?spm=a2c4g.11186623.0.0.3c267254Ka3fUh#LanguageManualUDF-posexplode(array)">å®˜æ–¹è¯´æ˜</a><br><strong>Return</strong>: Returns a row-set with two columns (pos int,val T), one row for each element from the array.<br><strong>Description</strong>: posexplode() is similar to explode but instead of just returning the elements of the array it returns the element as well as its position in the original array.</p><p><strong>ç”¨æ³•ç¤ºä¾‹</strong>ï¼š<br>æœ‰å¦‚ä¸‹ä¸€å¼ è¡¨myTable</p><table><thead><tr><th align="center">(array&lt;int&gt;)myCol</th></tr></thead><tbody><tr><td align="center">[100,200,300]</td></tr><tr><td align="center">[400,500,600]</td></tr></tbody></table><p>æ‰§è¡Œhive sql</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- é€ æ•°æ®</span></span><br><span class="line"><span class="keyword">with</span> myTable <span class="keyword">as</span> (</span><br><span class="line">    <span class="keyword">select</span> <span class="keyword">array</span>(<span class="number">100</span>,<span class="number">200</span>,<span class="number">300</span>) <span class="keyword">as</span> myCol</span><br><span class="line">    <span class="keyword">union</span> <span class="keyword">all</span> </span><br><span class="line">    <span class="keyword">select</span> <span class="keyword">array</span>(<span class="number">300</span>,<span class="number">400</span>,<span class="number">500</span>) <span class="keyword">as</span> myCol</span><br><span class="line">)</span><br><span class="line"><span class="comment">-- æŸ¥è¯¢sql</span></span><br><span class="line"><span class="keyword">SELECT</span> posexplode(myCol) <span class="keyword">AS</span> (pos, val) <span class="keyword">FROM</span> myTable</span><br></pre></td></tr></table></figure><p>å¾—åˆ°ç»“æœä¸ºï¼š</p><table><thead><tr><th align="center">(int)pos</th><th align="center">(int)val</th></tr></thead><tbody><tr><td align="center">0</td><td align="center">100</td></tr><tr><td align="center">1</td><td align="center">200</td></tr><tr><td align="center">2</td><td align="center">300</td></tr><tr><td align="center">0</td><td align="center">400</td></tr><tr><td align="center">1</td><td align="center">500</td></tr><tr><td align="center">2</td><td align="center">600</td></tr></tbody></table><h1><span id="sqlå®ç°">sqlå®ç°</span></h1><p>å€ŸåŠ©posexplodeè¿”å›çš„poså³å¯å®ç°</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> posexplode(split(space(<span class="number">99</span>), <span class="string">&#x27; &#x27;</span>)) <span class="keyword">as</span> (pos, val)</span><br><span class="line"><span class="comment">-- è¿”å›çš„poså­—æ®µå³ä¸º[0,99]åŒºé—´çš„100ä¸ªæ•´æ•°</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- æˆ–è€…ä¸‹é¢è¿™ç§å†™æ³•</span></span><br><span class="line"><span class="keyword">select</span> posexplode(split(repeat(<span class="string">&#x27;,&#x27;</span>,<span class="number">99</span>), <span class="string">&#x27;,&#x27;</span>)) <span class="keyword">as</span> (pos, val)</span><br></pre></td></tr></table></figure><h1><span id="å®ä¾‹åœºæ™¯">å®ä¾‹åœºæ™¯</span></h1><h2><span id="æ•°æ®é‡å¤æ‰©å®¹10å€">æ•°æ®é‡å¤æ‰©å®¹10å€</span></h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- é€ æ•°æ®</span></span><br><span class="line"><span class="keyword">with</span> myTable <span class="keyword">as</span> (</span><br><span class="line">    <span class="keyword">select</span> <span class="string">&#x27;å¼ ä¸‰&#x27;</span> <span class="keyword">as</span> name</span><br><span class="line">    <span class="keyword">union</span> <span class="keyword">all</span> </span><br><span class="line">    <span class="keyword">select</span> <span class="string">&#x27;æå››&#x27;</span> <span class="keyword">as</span> name</span><br><span class="line">)</span><br><span class="line"><span class="comment">-- å°†myTableçš„æ¯è¡Œæ•°æ®é‡å¤å¤åˆ¶ä¸º5è¡Œ</span></span><br><span class="line"><span class="keyword">SELECT</span> name</span><br><span class="line">       ,posexplode(split(space(<span class="number">4</span>), <span class="string">&#x27; &#x27;</span>)) <span class="keyword">AS</span> (pos, val) </span><br><span class="line"><span class="keyword">FROM</span> myTable</span><br></pre></td></tr></table></figure><p>å¾—åˆ°ç»“æœä¸ºï¼š</p><table><thead><tr><th align="center">name</th><th align="center">pos</th><th align="center">val</th></tr></thead><tbody><tr><td align="center">å¼ ä¸‰</td><td align="center">0</td><td align="center"></td></tr><tr><td align="center">å¼ ä¸‰</td><td align="center">1</td><td align="center"></td></tr><tr><td align="center">å¼ ä¸‰</td><td align="center">2</td><td align="center"></td></tr><tr><td align="center">å¼ ä¸‰</td><td align="center">3</td><td align="center"></td></tr><tr><td align="center">å¼ ä¸‰</td><td align="center">4</td><td align="center"></td></tr><tr><td align="center">æå››</td><td align="center">0</td><td align="center"></td></tr><tr><td align="center">æå››</td><td align="center">1</td><td align="center"></td></tr><tr><td align="center">æå››</td><td align="center">2</td><td align="center"></td></tr><tr><td align="center">æå››</td><td align="center">3</td><td align="center"></td></tr><tr><td align="center">æå››</td><td align="center">4</td><td align="center"></td></tr></tbody></table><h2><span id="ç”ŸæˆæŒ‡å®šèŒƒå›´å†…çš„è¿ç»­æ—¥æœŸ">ç”ŸæˆæŒ‡å®šèŒƒå›´å†…çš„è¿ç»­æ—¥æœŸ</span></h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> subquery <span class="keyword">as</span>  (</span><br><span class="line">    <span class="keyword">select</span> split(space(datediff(<span class="string">&#x27;2023-1-31&#x27;</span>,<span class="string">&#x27;2022-11-30&#x27;</span>)), <span class="string">&#x27; &#x27;</span>)  <span class="keyword">as</span> x</span><br><span class="line">) </span><br><span class="line"><span class="keyword">select</span> </span><br><span class="line">    date_add(<span class="string">&#x27;2022-11-30&#x27;</span>, pos) <span class="keyword">as</span> new_date</span><br><span class="line"><span class="keyword">from</span>  </span><br><span class="line">    subquery t</span><br><span class="line">    <span class="keyword">lateral</span> <span class="keyword">view</span> </span><br><span class="line">    posexplode(x) pe <span class="keyword">as</span> pos, val</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1&gt;&lt;span id=&quot;sqlè¦æ±‚&quot;&gt;sqlè¦æ±‚&lt;/span&gt;&lt;/h1&gt;&lt;p&gt;ç”Ÿæˆ100ä»¥å†…çš„å…¨éƒ¨æ•´æ•°&lt;/p&gt;
&lt;h1&gt;&lt;span id=&quot;æ¶‰åŠudtfå‡½æ•°&quot;&gt;æ¶‰åŠudtfå‡½æ•°&lt;/span&gt;&lt;/h1&gt;&lt;p&gt;&lt;strong&gt;posexplode&lt;/strong&gt;(ARRAY&amp;l</summary>
      
    
    
    
    <category term="SQL" scheme="https://llye-hub.github.io/categories/SQL/"/>
    
    
    <category term="SQLé«˜çº§è¯­æ³•" scheme="https://llye-hub.github.io/tags/SQL%E9%AB%98%E7%BA%A7%E8%AF%AD%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>SparkSQLä¹‹confå‚æ•°</title>
    <link href="https://llye-hub.github.io/posts/5e220c44.html"/>
    <id>https://llye-hub.github.io/posts/5e220c44.html</id>
    <published>2023-02-03T08:15:46.000Z</published>
    <updated>2023-02-20T05:44:02.740Z</updated>
    
    <content type="html"><![CDATA[<h1><span id="å®˜æ–¹è¯´æ˜ä¼ é€é—¨"></span></h1><h1><span id="èµ„æºå‚æ•°">èµ„æºå‚æ•°</span></h1><h2><span id="num-executors">num-executors</span></h2><ul><li>å‚æ•°è¯´æ˜ï¼šè¯¥å‚æ•°ç”¨äºè®¾ç½®Sparkä½œä¸šæ€»å…±è¦ç”¨å¤šå°‘ä¸ªExecutorè¿›ç¨‹æ¥æ‰§è¡Œã€‚Driveråœ¨å‘YARNé›†ç¾¤ç®¡ç†å™¨ç”³è¯·èµ„æºæ—¶ï¼ŒYARNé›†ç¾¤ç®¡ç†å™¨ä¼šå°½å¯èƒ½æŒ‰ç…§ä½ çš„è®¾ç½®æ¥åœ¨é›†ç¾¤çš„å„ä¸ªå·¥ä½œèŠ‚ç‚¹ä¸Šï¼Œå¯åŠ¨ç›¸åº”æ•°é‡çš„Executorè¿›ç¨‹ã€‚è¿™ä¸ªå‚æ•°éå¸¸ä¹‹é‡è¦ï¼Œå¦‚æœä¸è®¾ç½®çš„è¯ï¼Œé»˜è®¤åªä¼šç»™ä½ å¯åŠ¨å°‘é‡çš„Executorè¿›ç¨‹ï¼Œæ­¤æ—¶ä½ çš„Sparkä½œä¸šçš„è¿è¡Œé€Ÿåº¦æ˜¯éå¸¸æ…¢çš„ã€‚</li><li>å‚æ•°è°ƒä¼˜å»ºè®®ï¼šæ¯ä¸ªSparkä½œä¸šçš„è¿è¡Œä¸€èˆ¬è®¾ç½®50~100ä¸ªå·¦å³çš„Executorè¿›ç¨‹æ¯”è¾ƒåˆé€‚ï¼Œè®¾ç½®å¤ªå°‘æˆ–å¤ªå¤šçš„Executorè¿›ç¨‹éƒ½ä¸å¥½ã€‚è®¾ç½®çš„å¤ªå°‘ï¼Œæ— æ³•å……åˆ†åˆ©ç”¨é›†ç¾¤èµ„æºï¼›è®¾ç½®çš„å¤ªå¤šçš„è¯ï¼Œå¤§éƒ¨åˆ†é˜Ÿåˆ—å¯èƒ½æ— æ³•ç»™äºˆå……åˆ†çš„èµ„æºã€‚</li></ul><h2><span id="executor-memory">executor-memory</span></h2><ul><li>å‚æ•°è¯´æ˜ï¼šè¯¥å‚æ•°ç”¨äºè®¾ç½®æ¯ä¸ªExecutorè¿›ç¨‹çš„å†…å­˜ã€‚Executorå†…å­˜çš„å¤§å°ï¼Œå¾ˆå¤šæ—¶å€™ç›´æ¥å†³å®šäº†Sparkä½œä¸šçš„æ€§èƒ½ï¼Œè€Œä¸”è·Ÿå¸¸è§çš„JVM OOMå¼‚å¸¸ï¼Œä¹Ÿæœ‰ç›´æ¥çš„å…³è”ã€‚</li><li>å‚æ•°è°ƒä¼˜å»ºè®®ï¼šæ¯ä¸ªExecutorè¿›ç¨‹çš„å†…å­˜è®¾ç½®4G~8Gè¾ƒä¸ºåˆé€‚ã€‚ä½†æ˜¯è¿™åªæ˜¯ä¸€ä¸ªå‚è€ƒå€¼ï¼Œå…·ä½“çš„è®¾ç½®è¿˜æ˜¯å¾—æ ¹æ®ä¸åŒéƒ¨é—¨çš„èµ„æºé˜Ÿåˆ—æ¥å®šã€‚å¯ä»¥çœ‹çœ‹è‡ªå·±å›¢é˜Ÿçš„èµ„æºé˜Ÿåˆ—çš„æœ€å¤§å†…å­˜é™åˆ¶æ˜¯å¤šå°‘ï¼Œnum-executorsä¹˜ä»¥executor-memoryï¼Œæ˜¯ä¸èƒ½è¶…è¿‡é˜Ÿåˆ—çš„æœ€å¤§å†…å­˜é‡çš„ã€‚æ­¤å¤–ï¼Œå¦‚æœä½ æ˜¯è·Ÿå›¢é˜Ÿé‡Œå…¶ä»–äººå…±äº«è¿™ä¸ªèµ„æºé˜Ÿåˆ—ï¼Œé‚£ä¹ˆç”³è¯·çš„å†…å­˜é‡æœ€å¥½ä¸è¦è¶…è¿‡èµ„æºé˜Ÿåˆ—æœ€å¤§æ€»å†…å­˜çš„1&#x2F;3~1&#x2F;2ï¼Œé¿å…ä½ è‡ªå·±çš„Sparkä½œä¸šå ç”¨äº†é˜Ÿåˆ—æ‰€æœ‰çš„èµ„æºï¼Œå¯¼è‡´åˆ«çš„åŒå­¦çš„ä½œä¸šæ— æ³•è¿è¡Œã€‚</li></ul><p>##executor-cores</p><ul><li>å‚æ•°è¯´æ˜ï¼šè¯¥å‚æ•°ç”¨äºè®¾ç½®æ¯ä¸ªExecutorè¿›ç¨‹çš„CPU coreæ•°é‡ã€‚è¿™ä¸ªå‚æ•°å†³å®šäº†æ¯ä¸ªExecutorè¿›ç¨‹å¹¶è¡Œæ‰§è¡Œtaskçº¿ç¨‹çš„èƒ½åŠ›ã€‚å› ä¸ºæ¯ä¸ªCPU coreåŒä¸€æ—¶é—´åªèƒ½æ‰§è¡Œä¸€ä¸ªtaskçº¿ç¨‹ï¼Œå› æ­¤æ¯ä¸ªExecutorè¿›ç¨‹çš„CPU coreæ•°é‡è¶Šå¤šï¼Œè¶Šèƒ½å¤Ÿå¿«é€Ÿåœ°æ‰§è¡Œå®Œåˆ†é…ç»™è‡ªå·±çš„æ‰€æœ‰taskçº¿ç¨‹ã€‚</li><li>å‚æ•°è°ƒä¼˜å»ºè®®ï¼šExecutorçš„CPU coreæ•°é‡è®¾ç½®ä¸º2~4ä¸ªè¾ƒä¸ºåˆé€‚ã€‚åŒæ ·å¾—æ ¹æ®ä¸åŒéƒ¨é—¨çš„èµ„æºé˜Ÿåˆ—æ¥å®šï¼Œå¯ä»¥çœ‹çœ‹è‡ªå·±çš„èµ„æºé˜Ÿåˆ—çš„æœ€å¤§CPU coreé™åˆ¶æ˜¯å¤šå°‘ï¼Œå†ä¾æ®è®¾ç½®çš„Executoræ•°é‡ï¼Œæ¥å†³å®šæ¯ä¸ªExecutorè¿›ç¨‹å¯ä»¥åˆ†é…åˆ°å‡ ä¸ªCPU coreã€‚åŒæ ·å»ºè®®ï¼Œå¦‚æœæ˜¯è·Ÿä»–äººå…±äº«è¿™ä¸ªé˜Ÿåˆ—ï¼Œé‚£ä¹ˆnum-executors * executor-coresä¸è¦è¶…è¿‡é˜Ÿåˆ—æ€»CPU coreçš„1&#x2F;3~1&#x2F;2å·¦å³æ¯”è¾ƒåˆé€‚ï¼Œä¹Ÿæ˜¯é¿å…å½±å“å…¶ä»–åŒå­¦çš„ä½œä¸šè¿è¡Œã€‚</li></ul><h2><span id="driver-memory">driver-memory</span></h2><ul><li>å‚æ•°è¯´æ˜ï¼šè¯¥å‚æ•°ç”¨äºè®¾ç½®Driverè¿›ç¨‹çš„å†…å­˜ã€‚</li><li>å‚æ•°è°ƒä¼˜å»ºè®®ï¼šDriverçš„å†…å­˜é€šå¸¸æ¥è¯´ä¸è®¾ç½®ï¼Œæˆ–è€…è®¾ç½®1Gå·¦å³åº”è¯¥å°±å¤Ÿäº†ã€‚å”¯ä¸€éœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼Œå¦‚æœéœ€è¦ä½¿ç”¨collectç®—å­å°†RDDçš„æ•°æ®å…¨éƒ¨æ‹‰å–åˆ°Driverä¸Šè¿›è¡Œå¤„ç†ï¼Œé‚£ä¹ˆå¿…é¡»ç¡®ä¿Driverçš„å†…å­˜è¶³å¤Ÿå¤§ï¼Œå¦åˆ™ä¼šå‡ºç°OOMå†…å­˜æº¢å‡ºçš„é—®é¢˜ã€‚</li></ul><h2><span id="sparkdefaultparallelism">spark.default.parallelism</span></h2><ul><li>å‚æ•°è¯´æ˜ï¼šè¯¥å‚æ•°ç”¨äºè®¾ç½®æ¯ä¸ªstageçš„é»˜è®¤taskæ•°é‡ã€‚è¿™ä¸ªå‚æ•°æä¸ºé‡è¦ï¼Œå¦‚æœä¸è®¾ç½®å¯èƒ½ä¼šç›´æ¥å½±å“ä½ çš„Sparkä½œä¸šæ€§èƒ½ã€‚</li><li>å‚æ•°è°ƒä¼˜å»ºè®®ï¼šSparkä½œä¸šçš„é»˜è®¤taskæ•°é‡ä¸º500~1000ä¸ªè¾ƒä¸ºåˆé€‚ã€‚å¾ˆå¤šåŒå­¦å¸¸çŠ¯çš„ä¸€ä¸ªé”™è¯¯å°±æ˜¯ä¸å»è®¾ç½®è¿™ä¸ªå‚æ•°ï¼Œé‚£ä¹ˆæ­¤æ—¶å°±ä¼šå¯¼è‡´Sparkè‡ªå·±æ ¹æ®åº•å±‚HDFSçš„blockæ•°é‡æ¥è®¾ç½®taskçš„æ•°é‡ï¼Œé»˜è®¤æ˜¯ä¸€ä¸ªHDFS blockå¯¹åº”ä¸€ä¸ªtaskã€‚é€šå¸¸æ¥è¯´ï¼ŒSparké»˜è®¤è®¾ç½®çš„æ•°é‡æ˜¯åå°‘çš„ï¼ˆæ¯”å¦‚å°±å‡ åä¸ªtaskï¼‰ï¼Œå¦‚æœtaskæ•°é‡åå°‘çš„è¯ï¼Œå°±ä¼šå¯¼è‡´ä½ å‰é¢è®¾ç½®å¥½çš„Executorçš„å‚æ•°éƒ½å‰åŠŸå°½å¼ƒã€‚è¯•æƒ³ä¸€ä¸‹ï¼Œæ— è®ºä½ çš„Executorè¿›ç¨‹æœ‰å¤šå°‘ä¸ªï¼Œå†…å­˜å’ŒCPUæœ‰å¤šå¤§ï¼Œä½†æ˜¯taskåªæœ‰1ä¸ªæˆ–è€…10ä¸ªï¼Œé‚£ä¹ˆ90%çš„Executorè¿›ç¨‹å¯èƒ½æ ¹æœ¬å°±æ²¡æœ‰taskæ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯ç™½ç™½æµªè´¹äº†èµ„æºï¼å› æ­¤Sparkå®˜ç½‘å»ºè®®çš„è®¾ç½®åŸåˆ™æ˜¯ï¼Œè®¾ç½®è¯¥å‚æ•°ä¸ºnum-executors * executor-coresçš„2~3å€è¾ƒä¸ºåˆé€‚ï¼Œæ¯”å¦‚Executorçš„æ€»CPU coreæ•°é‡ä¸º300ä¸ªï¼Œé‚£ä¹ˆè®¾ç½®1000ä¸ªtaskæ˜¯å¯ä»¥çš„ï¼Œæ­¤æ—¶å¯ä»¥å……åˆ†åœ°åˆ©ç”¨Sparké›†ç¾¤çš„èµ„æºã€‚</li></ul><h2><span id="sparkstoragememoryfraction">spark.storage.memoryFraction</span></h2><ul><li>å‚æ•°è¯´æ˜ï¼šè¯¥å‚æ•°ç”¨äºè®¾ç½®RDDæŒä¹…åŒ–æ•°æ®åœ¨Executorå†…å­˜ä¸­èƒ½å çš„æ¯”ä¾‹ï¼Œé»˜è®¤æ˜¯0.6ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œé»˜è®¤Executor 60%çš„å†…å­˜ï¼Œå¯ä»¥ç”¨æ¥ä¿å­˜æŒä¹…åŒ–çš„RDDæ•°æ®ã€‚æ ¹æ®ä½ é€‰æ‹©çš„ä¸åŒçš„æŒä¹…åŒ–ç­–ç•¥ï¼Œå¦‚æœå†…å­˜ä¸å¤Ÿæ—¶ï¼Œå¯èƒ½æ•°æ®å°±ä¸ä¼šæŒä¹…åŒ–ï¼Œæˆ–è€…æ•°æ®ä¼šå†™å…¥ç£ç›˜ã€‚</li><li>å‚æ•°è°ƒä¼˜å»ºè®®ï¼šå¦‚æœSparkä½œä¸šä¸­ï¼Œæœ‰è¾ƒå¤šçš„RDDæŒä¹…åŒ–æ“ä½œï¼Œè¯¥å‚æ•°çš„å€¼å¯ä»¥é€‚å½“æé«˜ä¸€äº›ï¼Œä¿è¯æŒä¹…åŒ–çš„æ•°æ®èƒ½å¤Ÿå®¹çº³åœ¨å†…å­˜ä¸­ã€‚é¿å…å†…å­˜ä¸å¤Ÿç¼“å­˜æ‰€æœ‰çš„æ•°æ®ï¼Œå¯¼è‡´æ•°æ®åªèƒ½å†™å…¥ç£ç›˜ä¸­ï¼Œé™ä½äº†æ€§èƒ½ã€‚ä½†æ˜¯å¦‚æœSparkä½œä¸šä¸­çš„shuffleç±»æ“ä½œæ¯”è¾ƒå¤šï¼Œè€ŒæŒä¹…åŒ–æ“ä½œæ¯”è¾ƒå°‘ï¼Œé‚£ä¹ˆè¿™ä¸ªå‚æ•°çš„å€¼é€‚å½“é™ä½ä¸€äº›æ¯”è¾ƒåˆé€‚ã€‚æ­¤å¤–ï¼Œå¦‚æœå‘ç°ä½œä¸šç”±äºé¢‘ç¹çš„gcå¯¼è‡´è¿è¡Œç¼“æ…¢ï¼ˆé€šè¿‡spark web uiå¯ä»¥è§‚å¯Ÿåˆ°ä½œä¸šçš„gcè€—æ—¶ï¼‰ï¼Œæ„å‘³ç€taskæ‰§è¡Œç”¨æˆ·ä»£ç çš„å†…å­˜ä¸å¤Ÿç”¨ï¼Œé‚£ä¹ˆåŒæ ·å»ºè®®è°ƒä½è¿™ä¸ªå‚æ•°çš„å€¼ã€‚</li></ul><h2><span id="sparkshufflememoryfraction">spark.shuffle.memoryFraction</span></h2><ul><li>å‚æ•°è¯´æ˜ï¼šè¯¥å‚æ•°ç”¨äºè®¾ç½®shuffleè¿‡ç¨‹ä¸­ä¸€ä¸ªtaskæ‹‰å–åˆ°ä¸Šä¸ªstageçš„taskçš„è¾“å‡ºåï¼Œè¿›è¡Œèšåˆæ“ä½œæ—¶èƒ½å¤Ÿä½¿ç”¨çš„Executorå†…å­˜çš„æ¯”ä¾‹ï¼Œé»˜è®¤æ˜¯0.2ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒExecutoré»˜è®¤åªæœ‰20%çš„å†…å­˜ç”¨æ¥è¿›è¡Œè¯¥æ“ä½œã€‚shuffleæ“ä½œåœ¨è¿›è¡Œèšåˆæ—¶ï¼Œå¦‚æœå‘ç°ä½¿ç”¨çš„å†…å­˜è¶…å‡ºäº†è¿™ä¸ª20%çš„é™åˆ¶ï¼Œé‚£ä¹ˆå¤šä½™çš„æ•°æ®å°±ä¼šæº¢å†™åˆ°ç£ç›˜æ–‡ä»¶ä¸­å»ï¼Œæ­¤æ—¶å°±ä¼šæå¤§åœ°é™ä½æ€§èƒ½ã€‚</li><li>å‚æ•°è°ƒä¼˜å»ºè®®ï¼šå¦‚æœSparkä½œä¸šä¸­çš„RDDæŒä¹…åŒ–æ“ä½œè¾ƒå°‘ï¼Œshuffleæ“ä½œè¾ƒå¤šæ—¶ï¼Œå»ºè®®é™ä½æŒä¹…åŒ–æ“ä½œçš„å†…å­˜å æ¯”ï¼Œæé«˜shuffleæ“ä½œçš„å†…å­˜å æ¯”æ¯”ä¾‹ï¼Œé¿å…shuffleè¿‡ç¨‹ä¸­æ•°æ®è¿‡å¤šæ—¶å†…å­˜ä¸å¤Ÿç”¨ï¼Œå¿…é¡»æº¢å†™åˆ°ç£ç›˜ä¸Šï¼Œé™ä½äº†æ€§èƒ½ã€‚æ­¤å¤–ï¼Œå¦‚æœå‘ç°ä½œä¸šç”±äºé¢‘ç¹çš„gcå¯¼è‡´è¿è¡Œç¼“æ…¢ï¼Œæ„å‘³ç€taskæ‰§è¡Œç”¨æˆ·ä»£ç çš„å†…å­˜ä¸å¤Ÿç”¨ï¼Œé‚£ä¹ˆåŒæ ·å»ºè®®è°ƒä½è¿™ä¸ªå‚æ•°çš„å€¼ã€‚</li></ul><h1><span id="å¹¿æ’­ç›¸å…³">å¹¿æ’­ç›¸å…³</span></h1><h2><span id="sparksqlbroadcasttimeout">spark.sql.broadcastTimeout</span></h2><h2><span id="sparkkryoserializerbuffermaxx3d128m">spark.kryoserializer.buffer.max&#x3D;128M</span></h2><h2><span id="sparksqlshufflepartitionsx3d1000">spark.sql.shuffle.partitions&#x3D;1000</span></h2><h2><span id="sparksqlorccompressioncodecx3dzlib">spark.sql.orc.compression.codec&#x3D;zlib</span></h2><h2><span id="sparksqlfilesmaxpartitionbytesx3d65536">spark.sql.files.maxPartitionBytes&#x3D;65536</span></h2>]]></content>
    
    
      
      
    <summary type="html">&lt;h1&gt;&lt;span id=&quot;å®˜æ–¹è¯´æ˜ä¼ é€é—¨&quot;&gt;&lt;/span&gt;&lt;/h1&gt;&lt;h1&gt;&lt;span id=&quot;èµ„æºå‚æ•°&quot;&gt;èµ„æºå‚æ•°&lt;/span&gt;&lt;/h1&gt;&lt;h2&gt;&lt;span id=&quot;num-executors&quot;&gt;num-executors&lt;/span&gt;&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;å‚æ•°è¯´æ˜ï¼šè¯¥</summary>
      
    
    
    
    <category term="SQL" scheme="https://llye-hub.github.io/categories/SQL/"/>
    
    
  </entry>
  
  <entry>
    <title>hiveSQLä¹‹setå‚æ•°</title>
    <link href="https://llye-hub.github.io/posts/4547a6e2.html"/>
    <id>https://llye-hub.github.io/posts/4547a6e2.html</id>
    <published>2023-02-03T08:14:57.000Z</published>
    <updated>2023-02-20T07:52:21.554Z</updated>
    
    <content type="html"><![CDATA[<h1><span id="å®˜æ–¹ä¼ é€é—¨"></span></h1><h2><span id="hivemergemapfiles">hive.merge.mapfiles</span></h2><p>Default Value: true<br>map-onlyä»»åŠ¡ç»“æŸæ—¶åˆå¹¶å°æ–‡ä»¶</p><h2><span id="hivemergemapredfiles">hive.merge.mapredfiles</span></h2><p>Default Value: true<br>map-reduceä»»åŠ¡ç»“æŸæ—¶åˆå¹¶å°æ–‡ä»¶</p><h2><span id="hiveoptimizectematerializethreshold">hive.optimize.cte.materialize.threshold</span></h2><p>é»˜è®¤æƒ…å†µä¸‹æ˜¯-1ï¼ˆå…³é—­ï¼‰ï¼›å½“å¼€å¯ï¼ˆå¤§äº0ï¼‰ï¼Œæ¯”å¦‚è®¾ç½®ä¸º2ï¼Œåˆ™å¦‚æœwith..asè¯­å¥è¢«å¼•ç”¨2æ¬¡åŠä»¥ä¸Šæ—¶ï¼Œä¼šæŠŠwith..asè¯­å¥ç”Ÿæˆçš„tableç‰©åŒ–ï¼Œä»è€Œåšåˆ°with..asè¯­å¥åªæ‰§è¡Œä¸€æ¬¡ï¼Œæ¥æé«˜æ•ˆç‡</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1&gt;&lt;span id=&quot;å®˜æ–¹ä¼ é€é—¨&quot;&gt;&lt;/span&gt;&lt;/h1&gt;&lt;h2&gt;&lt;span id=&quot;hivemergemapfiles&quot;&gt;hive.merge.mapfiles&lt;/span&gt;&lt;/h2&gt;&lt;p&gt;Default Value: true&lt;br&gt;map-onlyä»»åŠ¡ç»“æŸæ—¶åˆå¹¶å°æ–‡</summary>
      
    
    
    
    <category term="SQL" scheme="https://llye-hub.github.io/categories/SQL/"/>
    
    
  </entry>
  
  <entry>
    <title>hiveSQLå‘½ä»¤ä¹‹alter partition</title>
    <link href="https://llye-hub.github.io/posts/8a94c1da.html"/>
    <id>https://llye-hub.github.io/posts/8a94c1da.html</id>
    <published>2023-02-02T06:02:26.000Z</published>
    <updated>2023-02-21T06:18:34.677Z</updated>
    
    <content type="html"><![CDATA[<p>msck repair table</p><p><a href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual+DDL#LanguageManualDDL-ExchangePartition">https://cwiki.apache.org/confluence/display/Hive/LanguageManual+DDL#LanguageManualDDL-ExchangePartition</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;msck repair table&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://cwiki.apache.org/confluence/display/Hive/LanguageManual+DDL#LanguageManualDDL-ExchangePartition</summary>
      
    
    
    
    <category term="SQL" scheme="https://llye-hub.github.io/categories/SQL/"/>
    
    
    <category term="æ”¹åˆ†åŒº" scheme="https://llye-hub.github.io/tags/%E6%94%B9%E5%88%86%E5%8C%BA/"/>
    
  </entry>
  
  <entry>
    <title>hadoopå‘½ä»¤ä¹‹distcpåˆ†å¸ƒå¼æ‹·è´</title>
    <link href="https://llye-hub.github.io/posts/bcc5bdf2.html"/>
    <id>https://llye-hub.github.io/posts/bcc5bdf2.html</id>
    <published>2023-02-01T02:06:03.000Z</published>
    <updated>2023-02-20T08:58:42.949Z</updated>
    
    <content type="html"><![CDATA[<h1><span id="distcpç”¨é€”">distcpç”¨é€”</span></h1><p>DistCpï¼ˆåˆ†å¸ƒå¼æ‹·è´ï¼‰æ˜¯ç”¨äºå¤§è§„æ¨¡é›†ç¾¤å†…éƒ¨å’Œé›†ç¾¤ä¹‹é—´æ‹·è´çš„å·¥å…·ã€‚<br>ä½¿ç”¨Map&#x2F;Reduceå®ç°æ–‡ä»¶åˆ†å‘ï¼Œé”™è¯¯å¤„ç†å’Œæ¢å¤ï¼Œä»¥åŠæŠ¥å‘Šç”Ÿæˆã€‚<br>DistCpå°†æ–‡ä»¶å’Œç›®å½•çš„åˆ—è¡¨ä½œä¸ºmapä»»åŠ¡çš„è¾“å…¥ï¼Œæ¯ä¸ªä»»åŠ¡ä¼šå®Œæˆæºåˆ—è¡¨ä¸­éƒ¨åˆ†æ–‡ä»¶çš„æ‹·è´ã€‚ </p><h1><span id="distcpç”¨æ³•">distcpç”¨æ³•</span></h1><p>å‘½ä»¤è¡Œä¸­å¯ä»¥æŒ‡å®šå¤šä¸ªæºç›®å½•</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># </span></span><br><span class="line">hadoop distcp source_dir1 [source_dir2 source_dir3â€¦â€¦] target_dir</span><br></pre></td></tr></table></figure><p>é›†ç¾¤å†…æ‹·è´</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># </span></span><br><span class="line">hadoop distcp [hdfs://nn:8020]/db/table_a/partition=1 [hdfs://nn:8020]/db/table_b/partition=1</span><br></pre></td></tr></table></figure><p>ä¸åŒé›†ç¾¤é—´æ‹·è´ï¼ŒDistCpå¿…é¡»è¿è¡Œåœ¨ç›®æ ‡ç«¯é›†ç¾¤ä¸Š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># </span></span><br><span class="line">hadoop distcp hdfs://nn1:8020/db/table_a/partition=1 hdfs://nn2:8020/db/table_b/partition=1</span><br></pre></td></tr></table></figure><h1><span id="å¸¸ç”¨å‚æ•°é€‰é¡¹">å¸¸ç”¨å‚æ•°é€‰é¡¹</span></h1><h2><span id="-overwrite">-overwrite</span></h2><p>æºæ–‡ä»¶è¦†ç›–åŒåç›®æ ‡æ–‡ä»¶</p><h2><span id="-update">-update</span></h2><p>æ‹·è´ç›®æ ‡ç›®å½•ä¸‹ä¸å­˜åœ¨è€Œæºç›®å½•ä¸‹å­˜åœ¨çš„æ–‡ä»¶ï¼Œå½“æ–‡ä»¶å¤§å°ä¸ä¸€è‡´æ—¶ï¼Œæºæ–‡ä»¶è¦†ç›–åŒåç›®æ ‡æ–‡ä»¶</p><h2><span id="-delete">-delete</span></h2><p>åˆ é™¤ç›®æ ‡ç›®å½•ä¸‹å­˜åœ¨ï¼Œä½†æºç›®å½•ä¸‹ä¸å­˜åœ¨çš„æ–‡ä»¶ï¼Œéœ€è¦é…åˆ<code>-update</code>æˆ–<code>-overwrite</code>ä½¿ç”¨</p><h2><span id="-prbugpcaxt">-p[rbugpcaxt]</span></h2><p>æ§åˆ¶æ˜¯å¦ä¿ç•™æºæ–‡ä»¶çš„å±æ€§ï¼Œ<code>-p</code>é»˜è®¤å…¨éƒ¨ä¿ç•™ï¼Œå¸¸ç”¨çš„ä¸º<code>-pbugp</code>ã€‚<br>ä¿®æ”¹æ¬¡æ•°ä¸ä¼šè¢«ä¿ç•™ã€‚å¹¶ä¸”å½“æŒ‡å®š -update æ—¶ï¼Œæ›´æ–°çš„çŠ¶æ€ä¸ä¼š è¢«åŒæ­¥ï¼Œé™¤éæ–‡ä»¶å¤§å°ä¸åŒï¼ˆæ¯”å¦‚æ–‡ä»¶è¢«é‡æ–°åˆ›å»ºï¼‰ã€‚</p><table><thead><tr><th>æ ‡è¯†</th><th>å«ä¹‰</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td>r</td><td>replication number</td><td>æ–‡ä»¶å‰¯æœ¬æ•°</td></tr><tr><td>b</td><td>block size</td><td>æ–‡ä»¶å—å¤§å°</td></tr><tr><td>u</td><td>user</td><td>ç”¨æˆ·</td></tr><tr><td>g</td><td>group</td><td>ç»„</td></tr><tr><td>p</td><td>permission</td><td>æ–‡ä»¶æƒé™</td></tr><tr><td>c</td><td>checksum-type</td><td>æ ¡éªŒå’Œç±»å‹</td></tr><tr><td>a</td><td>acl</td><td></td></tr><tr><td>x</td><td>xattr</td><td></td></tr><tr><td>t</td><td>timestamp</td><td>æ—¶é—´æˆ³</td></tr></tbody></table><h2><span id="-m">-m</span></h2><p>æ§åˆ¶æ‹·è´æ—¶çš„mapä»»åŠ¡æœ€å¤§ä¸ªæ•°<br>å¦‚æœæ²¡ä½¿ç”¨-mé€‰é¡¹ï¼ŒDistCpä¼šå°è¯•åœ¨è°ƒåº¦å·¥ä½œæ—¶æŒ‡å®šmapæ•°ç›®&#x3D;min(total_bytes&#x2F;bytes.per.map,20*num_task_trackers)ï¼Œ å…¶ä¸­bytes.per.mapé»˜è®¤æ˜¯256MBã€‚</p><h1><span id="åº”ç”¨å®ä¾‹">åº”ç”¨å®ä¾‹</span></h1><h2><span id="è¡¨ç»“æ„ä¸€è‡´çš„ä¸¤è¡¨äº’ç›¸æ‹·è´æ•°æ®">è¡¨ç»“æ„ä¸€è‡´çš„ä¸¤è¡¨äº’ç›¸æ‹·è´æ•°æ®</span></h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#********************************************************************************</span></span><br><span class="line"><span class="comment"># **  åŠŸèƒ½æè¿°ï¼šé€šè¿‡hdfsæ–‡ä»¶è·¯å¾„æ‹·è´çš„æ–¹å¼ï¼Œå®ç°è¡¨ç»“æ„å®Œå…¨ç›¸åŒçš„è¡¨äº’ç›¸æ‹·è´æ•°æ®</span></span><br><span class="line"><span class="comment">#********************************************************************************</span></span><br><span class="line"><span class="comment"># æŒ‡å®šæºè·¯å¾„ã€ç›®æ ‡è·¯å¾„</span></span><br><span class="line">source_dir=/db/table_a/partition=1</span><br><span class="line">target_dir=/db/table_b/partition=1</span><br><span class="line">db_name=db_a</span><br><span class="line">target_tbl_name=db_a.table_b</span><br><span class="line"><span class="comment"># åˆ¤æ–­æºè·¯å¾„æ˜¯å¦å­˜åœ¨ï¼Œä¸å­˜åœ¨åˆ™è¿”å›</span></span><br><span class="line">hadoop fs -<span class="built_in">test</span> -e <span class="variable">$source_dir</span></span><br><span class="line"><span class="keyword">if</span> [ $? -ne 0 ];<span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;æºè·¯å¾„<span class="variable">$source_dir</span>ä¸å­˜åœ¨&quot;</span></span><br><span class="line">  <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="comment"># åˆ¤æ–­ç›®æ ‡è·¯å¾„æ˜¯å¦å­˜åœ¨ï¼Œä¸å­˜åœ¨åˆ™åˆ›å»º</span></span><br><span class="line">hadoop fs -<span class="built_in">test</span> -e <span class="variable">$target_dir</span></span><br><span class="line"><span class="keyword">if</span> [ $? -ne 0 ];<span class="keyword">then</span></span><br><span class="line">  hadoop fs -<span class="built_in">mkdir</span> <span class="variable">$target_dir</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;ç›®æ ‡è·¯å¾„<span class="variable">$target_dir</span>ä¸å­˜åœ¨ï¼Œåˆ›å»ºæˆåŠŸ&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="comment"># å¼€å§‹æ‹·è´</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;å¼€å§‹hdfsæ–‡ä»¶æ‹·è´ï¼Œsource_dir=<span class="variable">$source_dir</span>ï¼Œtarget_dir=<span class="variable">$target_dir</span>&quot;</span></span><br><span class="line">hadoop distcp -overwrite -delete -pbugp <span class="variable">$source_dir</span> <span class="variable">$target_dir</span></span><br><span class="line"><span class="keyword">if</span> [ $? -eq 0 ];<span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;hdfsæ–‡ä»¶æ‹·è´æˆåŠŸ&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;hdfsæ–‡ä»¶æ‹·è´å¤±è´¥&quot;</span></span><br><span class="line">  <span class="built_in">exit</span> -1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="comment"># åˆ·æ–°ç›®æ ‡è¡¨çš„metastoreä¿¡æ¯</span></span><br><span class="line">hive -database <span class="variable">$db_name</span> -v -e <span class="string">&quot;msck repair table <span class="variable">$target_tbl_name</span>;&quot;</span></span><br><span class="line"><span class="keyword">if</span> [ $? -eq 0 ];<span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$target_tbl_name</span>è¡¨çš„metastoreä¿¡æ¯åˆ·æ–°æˆåŠŸ&quot;</span></span><br><span class="line">  <span class="built_in">exit</span> 0</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure><h1><span id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</span></h1><p><a href="https://hadoop.apache.org/docs/r1.0.4/cn/distcp.html">DistCpä½¿ç”¨æŒ‡å—</a><br><a href="https://hadoop.org.cn/docs/hadoop-distcp/DistCp.html">Hadoopä¸­æ–‡ç½‘ï¼šDistCp</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1&gt;&lt;span id=&quot;distcpç”¨é€”&quot;&gt;distcpç”¨é€”&lt;/span&gt;&lt;/h1&gt;&lt;p&gt;DistCpï¼ˆåˆ†å¸ƒå¼æ‹·è´ï¼‰æ˜¯ç”¨äºå¤§è§„æ¨¡é›†ç¾¤å†…éƒ¨å’Œé›†ç¾¤ä¹‹é—´æ‹·è´çš„å·¥å…·ã€‚&lt;br&gt;ä½¿ç”¨Map&amp;#x2F;Reduceå®ç°æ–‡ä»¶åˆ†å‘ï¼Œé”™è¯¯å¤„ç†å’Œæ¢å¤ï¼Œä»¥åŠæŠ¥å‘Šç”Ÿæˆã€‚&lt;br&gt;DistCpå°†æ–‡ä»¶å’Œç›®å½•</summary>
      
    
    
    
    <category term="hadoop" scheme="https://llye-hub.github.io/categories/hadoop/"/>
    
    
    <category term="hadoopå‘½ä»¤" scheme="https://llye-hub.github.io/tags/hadoop%E5%91%BD%E4%BB%A4/"/>
    
    <category term="hdfsæ–‡ä»¶æ‹·è´" scheme="https://llye-hub.github.io/tags/hdfs%E6%96%87%E4%BB%B6%E6%8B%B7%E8%B4%9D/"/>
    
  </entry>
  
  <entry>
    <title>Shellå‘½ä»¤ä¹‹set-e</title>
    <link href="https://llye-hub.github.io/posts/ba81765c.html"/>
    <id>https://llye-hub.github.io/posts/ba81765c.html</id>
    <published>2023-01-31T09:26:54.000Z</published>
    <updated>2023-02-20T08:35:55.810Z</updated>
    
    
    
    
    <category term="shell" scheme="https://llye-hub.github.io/categories/shell/"/>
    
    
    <category term="shellå‘½ä»¤" scheme="https://llye-hub.github.io/tags/shell%E5%91%BD%E4%BB%A4/"/>
    
  </entry>
  
  <entry>
    <title>hadoopåŸºæœ¬å‘½ä»¤</title>
    <link href="https://llye-hub.github.io/posts/b24f0feb.html"/>
    <id>https://llye-hub.github.io/posts/b24f0feb.html</id>
    <published>2023-01-31T09:10:11.000Z</published>
    <updated>2023-02-20T08:35:55.810Z</updated>
    
    <content type="html"><![CDATA[<p>hadoop fs -cp<br>hadoop fs -rm -r<br>hadoop distcp -overwrite -delete -p<br>hadoop fs -mkdir -p</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;hadoop fs -cp&lt;br&gt;hadoop fs -rm -r&lt;br&gt;hadoop distcp -overwrite -delete -p&lt;br&gt;hadoop fs -mkdir -p&lt;/p&gt;
</summary>
      
    
    
    
    <category term="hadoop" scheme="https://llye-hub.github.io/categories/hadoop/"/>
    
    
    <category term="hadoopå‘½ä»¤" scheme="https://llye-hub.github.io/tags/hadoop%E5%91%BD%E4%BB%A4/"/>
    
  </entry>
  
  <entry>
    <title>hiveåŠ¨æ€åˆ†åŒº</title>
    <link href="https://llye-hub.github.io/posts/44d3528f.html"/>
    <id>https://llye-hub.github.io/posts/44d3528f.html</id>
    <published>2023-01-30T09:01:49.000Z</published>
    <updated>2023-02-20T08:35:55.811Z</updated>
    
    
    
    
    <category term="hive" scheme="https://llye-hub.github.io/categories/hive/"/>
    
    
    <category term="åŠ¨æ€åˆ†åŒº" scheme="https://llye-hub.github.io/tags/%E5%8A%A8%E6%80%81%E5%88%86%E5%8C%BA/"/>
    
  </entry>
  
  <entry>
    <title>SparkSQLæ— æ³•å¤„ç†hiveè¡¨ä¸­çš„ç©ºORCæ–‡ä»¶</title>
    <link href="https://llye-hub.github.io/posts/1f69e18b.html"/>
    <id>https://llye-hub.github.io/posts/1f69e18b.html</id>
    <published>2022-12-16T09:56:46.000Z</published>
    <updated>2023-02-20T03:40:11.835Z</updated>
    
    <content type="html"><![CDATA[<h1><span id="ç¢°åˆ°äº†ä»€ä¹ˆé—®é¢˜">ç¢°åˆ°äº†ä»€ä¹ˆé—®é¢˜</span></h1><p>èµ·å› æ˜¯åœ¨ä½¿ç”¨SparkSQLæŸ¥è¯¢è¡¨æ—¶ï¼Œé‡åˆ°æŠ¥é”™ï¼šjava.lang.RuntimeException: serious problem at OrcInputFormat.generateSplitsInfo<br><img src="https://i.328888.xyz/2022/12/19/AfHSH.png" alt="AfHSH.png"><br><img src="https://i.328888.xyz/2022/12/19/AfbiQ.png" alt="AfbiQ.png"><br>ä¹‹åï¼Œæ¢äº†hiveSQLæ‰§è¡ŒæˆåŠŸï¼Œä½†è¿™å¹¶ä¸ç®—æ’æŸ¥æˆåŠŸï¼Œæ’æŸ¥åº”å°½å¯èƒ½è¿½æ ¹ç©¶åº•ï¼Œä»¥åæ‰èƒ½åšåˆ°ä¸¾ä¸€åä¸‰ï¼Œæ‰€ä»¥åŸºäºç½‘ä¸Šèµ„æ–™å’Œä¸ªäººç†è§£å†™äº†è¿™ç¯‡åšå®¢</p><h1><span id="é—®é¢˜åˆ†æ">é—®é¢˜åˆ†æ</span></h1><h2><span id="å®šä½é—®é¢˜">å®šä½é—®é¢˜</span></h2><p>æ ¹æ®æŠ¥é”™çš„javaç±»å+æ–¹æ³•åï¼ˆOrcInputFormat.generateSplitsInfoï¼‰ï¼Œå¯ä»¥åˆ¤æ–­é—®é¢˜å‡ºç°åœ¨è¯»å–orcæ–‡ä»¶é˜¶æ®µã€‚</p><h2><span id="æŸ¥çœ‹hdfsæ–‡ä»¶">æŸ¥çœ‹HDFSæ–‡ä»¶</span></h2><p>æŸ¥çœ‹è¡¨å­˜å‚¨è·¯å¾„ä¸‹çš„æ–‡ä»¶ï¼Œå‘ç°æœ‰1ä¸ªç©ºæ–‡ä»¶<br><img src="https://i.328888.xyz/2022/12/19/AfjbE.png" alt="AfjbE.png"></p><h2><span id="ä¸ºä»€ä¹ˆä¼šæœ‰ç©ºæ–‡ä»¶">ä¸ºä»€ä¹ˆä¼šæœ‰ç©ºæ–‡ä»¶</span></h2><p>1ã€sparkSQLå»ºè¡¨<br>2ã€è¡¨å†™å…¥æ•°æ®æ—¶ï¼Œsqlæœ€ååšäº†distribute byæ“ä½œï¼Œäº§ç”Ÿäº†ç©ºæ–‡ä»¶</p><p>sparksqlè¯»å–ç©ºæ–‡ä»¶çš„æ—¶å€™ï¼Œå› ä¸ºè¡¨æ˜¯orcæ ¼å¼çš„ï¼Œå¯¼è‡´sparkSQLè§£æorcæ–‡ä»¶å‡ºé”™ã€‚ä½†æ˜¯ç”¨hiveå´å¯ä»¥æ­£å¸¸è¯»å–ã€‚</p><h2><span id="ç½‘ä¸Šæœç½—çš„è§£å†³åŠæ³•">ç½‘ä¸Šæœç½—çš„è§£å†³åŠæ³•</span></h2><p>é—®é¢˜åŸå› åŸºæœ¬æ¸…æ™°äº†ï¼Œå°±æ˜¯è¯»å–ç©ºæ–‡ä»¶å¯¼è‡´çš„æŠ¥é”™ï¼Œå¦‚æœéå¾—ç”¨SparkSQLæ‰§è¡ŒæŸ¥è¯¢è¯­å¥ï¼Œè¿™é‡Œæä¾›å‡ ç§è§£å†³æ–¹æ¡ˆï¼š</p><h4><span id="1-ä¿®æ”¹è¡¨å­˜å‚¨æ ¼å¼ä¸ºparquet">1ã€ä¿®æ”¹è¡¨å­˜å‚¨æ ¼å¼ä¸ºparquet</span></h4><p>è¿™ç§æ–¹æ³•æ˜¯ç½‘ä¸ŠæŸ¥è¯¢åˆ°çš„ï¼Œä½†åœ¨å®é™…æ•°ä»“å·¥ä½œä¸­ï¼Œå¯¹äºå·²åœ¨ä½¿ç”¨ä¸­çš„è¡¨æ¥è¯´ï¼Œåˆ è¡¨é‡å»ºæ“ä½œæ˜¯ä¸å…è®¸çš„ï¼Œæ‰€ä»¥ä¸æ¨è</p><h4><span id="2-å‚æ•°è®¾ç½®set-hiveexecorcsplitstrategyetl">2ã€å‚æ•°è®¾ç½®ï¼š<code>set hive.exec.orc.split.strategy=ETL</code></span></h4><p>æ—¢ç„¶å·²ç»å®šä½åˆ°æ˜¯ç©ºæ–‡ä»¶è¯»å–çš„é—®é¢˜ï¼Œé‚£å°±ä»æ–‡ä»¶è¯»å–å±‚é¢è§£å†³ã€‚</p><p>è‡ªå»ºé›†ç¾¤<code>Spark</code>æºç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// org/apache/hadoop/hive/ql/io/orc/OrcInputFormat.java</span></span><br><span class="line"><span class="keyword">switch</span>(context.splitStrategyKind) &#123;</span><br><span class="line">    <span class="keyword">case</span> BI:</span><br><span class="line">    <span class="comment">// BI strategy requested through config</span></span><br><span class="line">    splitStrategy = <span class="keyword">new</span> <span class="title class_">BISplitStrategy</span>(context, fs, dir, children, isOriginal,</span><br><span class="line">        deltas, covered);</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> ETL:</span><br><span class="line">    <span class="comment">// ETL strategy requested through config</span></span><br><span class="line">    splitStrategy = <span class="keyword">new</span> <span class="title class_">ETLSplitStrategy</span>(context, fs, dir, children, isOriginal,</span><br><span class="line">        deltas, covered);</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">    <span class="comment">// HYBRID strategy</span></span><br><span class="line">    <span class="keyword">if</span> (avgFileSize &gt; context.maxSize) &#123;</span><br><span class="line">        splitStrategy = <span class="keyword">new</span> <span class="title class_">ETLSplitStrategy</span>(context, fs, dir, children, isOriginal, deltas,</span><br><span class="line">            covered);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        splitStrategy = <span class="keyword">new</span> <span class="title class_">BISplitStrategy</span>(context, fs, dir, children, isOriginal, deltas,</span><br><span class="line">            covered);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ./repository/org/spark-project/hive/hive-exec/1.2.1.spark2/hive-exec-1.2.1.spark2.jar!/org/apache/hadoop/hive/conf/HiveConf.class</span></span><br><span class="line">HIVE_ORC_SPLIT_STRATEGY(<span class="string">&quot;hive.exec.orc.split.strategy&quot;</span>, <span class="string">&quot;HYBRID&quot;</span>, <span class="keyword">new</span> <span class="title class_">StringSet</span>(<span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;HYBRID&quot;</span>, <span class="string">&quot;BI&quot;</span>, <span class="string">&quot;ETL&quot;</span>&#125;), <span class="string">&quot;This is not a user level config. BI strategy is used when the requirement is to spend less time in split generation as opposed to query execution (split generation does not read or cache file footers). ETL strategy is used when spending little more time in split generation is acceptable (split generation reads and caches file footers). HYBRID chooses between the above strategies based on heuristics.&quot;</span>)      </span><br><span class="line">  </span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œé»˜è®¤æ˜¯HYBRIDï¼ˆæ··åˆæ¨¡å¼è¯»å–ï¼Œæ ¹æ®å¹³å‡æ–‡ä»¶å¤§å°å’Œæ–‡ä»¶ä¸ªæ•°é€‰æ‹©ETLè¿˜æ˜¯BIæ¨¡å¼ï¼‰ã€‚</p><ul><li>BIç­–ç•¥ä»¥æ–‡ä»¶ä¸ºç²’åº¦è¿›è¡Œsplitåˆ’åˆ†</li><li>ETLç­–ç•¥ä¼šå°†æ–‡ä»¶è¿›è¡Œåˆ‡åˆ†ï¼Œå¤šä¸ªstripeç»„æˆä¸€ä¸ªsplit</li><li>HYBRIDç­–ç•¥ä¸ºï¼šå½“æ–‡ä»¶çš„å¹³å‡å¤§å°å¤§äºhadoopæœ€å¤§splitå€¼ï¼ˆé»˜è®¤256 * 1024 * 1024ï¼‰æ—¶ä½¿ç”¨ETLç­–ç•¥ï¼Œå¦åˆ™ä½¿ç”¨BIç­–ç•¥ã€‚</li></ul><p>ETLSplitStrategyå’ŒBISplitStrategyä¸¤ç§ç­–ç•¥åœ¨å¯¹getSplitsæ–¹æ³•é‡‡ç”¨äº†ä¸åŒçš„å®ç°æ–¹å¼ï¼ŒBISplitStrategyåœ¨é¢å¯¹ç©ºæ–‡ä»¶æ—¶ä¼šå‡ºç°ç©ºæŒ‡é’ˆå¼‚å¸¸ï¼ŒETLSplitStrategyåˆ™å¸®æˆ‘ä»¬è¿‡æ»¤äº†ç©ºæ–‡ä»¶ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// org.apache.hadoop.hive.ql.io.orc.OrcInputFormat.BISplitStrategy#getSplits</span></span><br><span class="line"><span class="keyword">public</span> List&lt;OrcSplit&gt; <span class="title function_">getSplits</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">  List&lt;OrcSplit&gt; splits = Lists.newArrayList();</span><br><span class="line">  <span class="keyword">for</span> (FileStatus fileStatus : fileStatuses) &#123;</span><br><span class="line">    String[] hosts = SHIMS</span><br><span class="line">        .getLocationsWithOffset(fs, fileStatus) <span class="comment">// å¯¹ç©ºæ–‡ä»¶ä¼šè¿”å›ä¸€ä¸ªç©ºçš„TreeMap</span></span><br><span class="line">        .firstEntry()  <span class="comment">// null</span></span><br><span class="line">        .getValue()    <span class="comment">// NPE</span></span><br><span class="line">        .getHosts();</span><br><span class="line">    <span class="type">OrcSplit</span> <span class="variable">orcSplit</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OrcSplit</span>(fileStatus.getPath(), <span class="number">0</span>, fileStatus.getLen(), hosts,</span><br><span class="line">                                     <span class="literal">null</span>, isOriginal, <span class="literal">true</span>, deltas, -<span class="number">1</span>);</span><br><span class="line">    splits.add(orcSplit);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// add uncovered ACID delta splits</span></span><br><span class="line">  splits.addAll(<span class="built_in">super</span>.getSplits());</span><br><span class="line">  <span class="keyword">return</span> splits;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// org.apache.hadoop.hive.ql.io.orc.OrcInputFormat.ETLSplitStrategy#getSplits</span></span><br><span class="line"><span class="keyword">public</span> List&lt;SplitInfo&gt; <span class="title function_">getSplits</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    List&lt;SplitInfo&gt; result = Lists.newArrayList();</span><br><span class="line">    <span class="keyword">for</span> (FileStatus file : files) &#123;</span><br><span class="line">    <span class="type">FileInfo</span> <span class="variable">info</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">if</span> (context.cacheStripeDetails) &#123;</span><br><span class="line">        info = verifyCachedFileInfo(file);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ignore files of 0 lengthï¼ˆæ­¤å¤„å¯¹ç©ºæ–‡ä»¶åšäº†è¿‡æ»¤ï¼‰</span></span><br><span class="line">    <span class="keyword">if</span> (file.getLen() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        result.add(<span class="keyword">new</span> <span class="title class_">SplitInfo</span>(context, fs, file, info, isOriginal, deltas, <span class="literal">true</span>, dir, covered));</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p> æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªBUGï¼Œ<code>Spark2.4</code>ç‰ˆæœ¬ä¸­è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// org.apache.hadoop.hive.ql.io.orc.OrcInputFormat.BISplitStrategy#getSplits</span></span><br><span class="line"><span class="keyword">public</span> List&lt;OrcSplit&gt; <span class="title function_">getSplits</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    List&lt;OrcSplit&gt; splits = Lists.newArrayList();</span><br><span class="line">    <span class="keyword">for</span> (FileStatus fileStatus : fileStatuses) &#123;</span><br><span class="line">    String[] hosts = SHIMS.getLocationsWithOffset(fs, fileStatus).firstEntry().getValue()</span><br><span class="line">        .getHosts();</span><br><span class="line">    <span class="type">OrcSplit</span> <span class="variable">orcSplit</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OrcSplit</span>(fileStatus.getPath(), <span class="number">0</span>, fileStatus.getLen(), hosts,</span><br><span class="line">        <span class="literal">null</span>, isOriginal, <span class="literal">true</span>, deltas, -<span class="number">1</span>);</span><br><span class="line">    splits.add(orcSplit);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// add uncovered ACID delta splits</span></span><br><span class="line">    splits.addAll(<span class="built_in">super</span>.getSplits());</span><br><span class="line">    <span class="keyword">return</span> splits;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>äº†è§£äº†sparkè¯»å–orcæ–‡ä»¶ç­–ç•¥ï¼Œé‚£ä¹ˆå°±è®¾ç½®é¿å…æ··åˆæ¨¡å¼ä½¿ç”¨æ ¹æ®æ–‡ä»¶å¤§å°åˆ†å‰²è¯»å–ï¼Œä¸æ ¹æ®æ–‡ä»¶æ¥è¯»å–</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> hive.exec.orc.split.strategy<span class="operator">=</span>ETL</span><br></pre></td></tr></table></figure><p>ç»æµ‹è¯•æ— æ•ˆã€‚åŸå› åˆ†æï¼š<br>1ã€å‚æ•°æœªç”Ÿæ•ˆ<br>2ã€hdfsæ–‡ä»¶æœ‰ä¸¤ä¸ªï¼Œå¤§å°ä¸º49Bå’Œ7.45Gï¼Œæ–‡ä»¶çš„å¹³å‡å¤§å°è‚¯å®šæ˜¯å¤§äº256Mçš„ï¼Œæ‰€ä»¥æŒ‰é»˜è®¤HYBRIDç­–ç•¥è§„åˆ™åº”æœ¬å°±æ˜¯é‡‡å–çš„ETLç­–ç•¥split ORCæ–‡ä»¶</p><h4><span id="3-å‚æ•°è®¾ç½®sparksqlhiveconvertmetastoreorctrue">3ã€å‚æ•°è®¾ç½®ï¼š<code>spark.sql.hive.convertMetastoreOrc=true</code></span></h4><p>å…³äºå‚æ•°çš„<a href="https://spark.apache.org/docs/2.3.3/sql-programming-guide.html#orc-files">å®˜æ–¹ä»‹ç»</a></p><blockquote><p>Since Spark 2.3, Spark supports a vectorized ORC reader with a new ORC file format for ORC files. To do that, the following configurations are newly added. The vectorized reader is used for the native ORC tables (e.g., the ones created using the clause USING ORC) when spark.sql.orc.impl is set to native and spark.sql.orc.enableVectorizedReader is set to true. For the Hive ORC serde tables (e.g., the ones created using the clause USING HIVE OPTIONS (fileFormat â€˜ORCâ€™)), the vectorized reader is used when spark.sql.hive.convertMetastoreOrc is also set to true.</p></blockquote><p>ç»æµ‹è¯•æœ‰æ•ˆã€‚è‹¥ä»æŠ¥é”™ï¼Œå¯å°è¯•æ­é…spark.sql.orc.impl&#x3D;nativeä½¿ç”¨ã€‚</p><h1><span id="è¡¥å……çŸ¥è¯†">è¡¥å……çŸ¥è¯†</span></h1><p><img src="https://i.328888.xyz/2022/12/19/Af23F.jpeg" alt="Af23F.jpeg"><br>hive.exec.orc.split.strategyå‚æ•°æ§åˆ¶åœ¨è¯»å–ORCè¡¨æ—¶ç”Ÿæˆsplitçš„ç­–ç•¥ã€‚å¯¹äºä¸€äº›è¾ƒå¤§çš„ORCè¡¨ï¼Œå¯èƒ½å…¶footerè¾ƒå¤§ï¼ŒETLç­–ç•¥å¯èƒ½ä¼šå¯¼è‡´å…¶ä»hdfsæ‹‰å–å¤§é‡çš„æ•°æ®æ¥åˆ‡åˆ†splitï¼Œç”šè‡³ä¼šå¯¼è‡´driverç«¯OOMï¼Œå› æ­¤è¿™ç±»è¡¨çš„è¯»å–å»ºè®®ä½¿ç”¨BIç­–ç•¥ã€‚å¯¹äºä¸€äº›è¾ƒå°çš„å°¤å…¶æœ‰æ•°æ®å€¾æ–œçš„è¡¨ï¼ˆè¿™é‡Œçš„æ•°æ®å€¾æ–œæŒ‡å¤§é‡stripeå­˜å‚¨äºå°‘æ•°æ–‡ä»¶ä¸­ï¼‰ï¼Œå»ºè®®ä½¿ç”¨ETLç­–ç•¥ã€‚<br>å¦å¤–ï¼Œspark.hadoop.mapreduce.input.fileinputformat.split.minsizeå‚æ•°å¯ä»¥æ§åˆ¶åœ¨ORCåˆ‡åˆ†æ—¶stripeçš„åˆå¹¶å¤„ç†ã€‚å…·ä½“é€»è¾‘æ˜¯ï¼Œå½“å‡ ä¸ªstripeçš„å¤§å°å°äºspark.hadoop.mapreduce.input.fileinputformat.split.minsizeæ—¶ï¼Œä¼šåˆå¹¶åˆ°ä¸€ä¸ªtaskä¸­å¤„ç†ã€‚å¯ä»¥é€‚å½“è°ƒå°è¯¥å€¼ï¼Œä»¥æ­¤å¢å¤§è¯»ORCè¡¨çš„å¹¶å‘ã€‚</p><h1><span id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</span></h1><p><a href="https://www.freesion.com/article/8054484645/">SPARKæŸ¥ORCæ ¼å¼HIVEæ•°æ®æŠ¥é”™NULLPOINTEREXCEPTION</a><br><a href="https://blog.csdn.net/weixin_45240507/article/details/124689323?spm=1001.2101.3001.6650.7&utm_medium=distribute.pc_relevant.none-task-blog-2~default~BlogCommendFromBaidu~Rate-7-124689323-blog-100524131.pc_relevant_default&depth_1-utm_source=distribute.pc_relevant.none-task-blog-2~default~BlogCommendFromBaidu~Rate-7-124689323-blog-100524131.pc_relevant_default&utm_relevant_index=7">SparkSQLè¯»å–ORCè¡¨æ—¶é‡åˆ°ç©ºæ–‡ä»¶</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1&gt;&lt;span id=&quot;ç¢°åˆ°äº†ä»€ä¹ˆé—®é¢˜&quot;&gt;ç¢°åˆ°äº†ä»€ä¹ˆé—®é¢˜&lt;/span&gt;&lt;/h1&gt;&lt;p&gt;èµ·å› æ˜¯åœ¨ä½¿ç”¨SparkSQLæŸ¥è¯¢è¡¨æ—¶ï¼Œé‡åˆ°æŠ¥é”™ï¼šjava.lang.RuntimeException: serious problem at OrcInputFormat.generateS</summary>
      
    
    
    
    <category term="SQL" scheme="https://llye-hub.github.io/categories/SQL/"/>
    
    
    <category term="ORC" scheme="https://llye-hub.github.io/tags/ORC/"/>
    
  </entry>
  
  <entry>
    <title>get_json_objectåœ¨sqlä¸­çš„é«˜çº§ç”¨æ³•</title>
    <link href="https://llye-hub.github.io/posts/5f45fcd7.html"/>
    <id>https://llye-hub.github.io/posts/5f45fcd7.html</id>
    <published>2022-12-16T03:46:24.000Z</published>
    <updated>2023-02-20T03:39:56.457Z</updated>
    
    <content type="html"><![CDATA[<h2><span id="è¯­æ³•ä»‹ç»">è¯­æ³•ä»‹ç»</span></h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">get_json_object(String json_string, String path)</span><br><span class="line"><span class="comment">-- return string</span></span><br></pre></td></tr></table></figure><p>get_json_objectå‡½æ•°æ˜¯ç”¨æ¥æ ¹æ®æŒ‡å®šè·¯å¾„æå–jsonå­—ç¬¦ä¸²ä¸­çš„jsonå¯¹è±¡ï¼Œå¹¶è¿”å›jsonå¯¹è±¡çš„jsonå­—ç¬¦ä¸²</p><h2><span id="ç°æœ‰å›°æƒ‘">ç°æœ‰å›°æƒ‘</span></h2><p>å…³äºè¿™ä¸ªå‡½æ•°æœ€å¸¸è§çš„ç”¨æ³•å°±æ˜¯<code>get_json_object(&#39;&#123;&quot;a&quot;:&quot;b&quot;&#125;&#39;, &#39;$.a&#39;)</code>ï¼Œè¿”å›ç»“æœ<code>b</code><br>ä½†<code>$.a</code>è¿™ç§pathå†™æ³•ä»…é€‚ç”¨äºç®€å•çš„å¤šå±‚åµŒå¥—jsonå­—ç¬¦ä¸²è§£æï¼Œç¢°åˆ°åµŒå¥—å±‚æœ‰jsonæ•°ç»„æ—¶å°±éš¾ä»¥è§£æäº†<br>æ¯”å¦‚ï¼Œè¦æå–ä¸‹é¢è¿™æ®µjsonä¸­çš„æ‰€æœ‰<code>weight</code>å¯¹è±¡çš„å€¼</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"> <span class="attr">&quot;store&quot;</span><span class="punctuation">:</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">         <span class="attr">&quot;fruit&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="attr">&quot;weight&quot;</span><span class="punctuation">:</span><span class="number">8</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span><span class="string">&quot;apple&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span> <span class="punctuation">&#123;</span><span class="attr">&quot;weight&quot;</span><span class="punctuation">:</span><span class="number">9</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span><span class="string">&quot;pear&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">,</span>  <span class="comment">//jsonæ•°ç»„</span></span><br><span class="line">         <span class="attr">&quot;bicycle&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;price&quot;</span><span class="punctuation">:</span><span class="number">19.95</span><span class="punctuation">,</span><span class="attr">&quot;color&quot;</span><span class="punctuation">:</span><span class="string">&quot;red&quot;</span><span class="punctuation">&#125;</span></span><br><span class="line">         <span class="punctuation">&#125;</span><span class="punctuation">,</span> </span><br><span class="line"> <span class="attr">&quot;email&quot;</span><span class="punctuation">:</span><span class="string">&quot;amy@only_for_json_udf_test.net&quot;</span><span class="punctuation">,</span> </span><br><span class="line"> <span class="attr">&quot;owner&quot;</span><span class="punctuation">:</span><span class="string">&quot;amy&quot;</span> </span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>é€šè¿‡<code>$.store.fruit.weight</code>è·¯å¾„æ˜¯æ— æ³•æå–çš„ï¼Œ<code>$.store.fruit[0].weight</code>è¿™ç§å†™æ³•ä»…èƒ½è·å–jsonæ•°ç»„ä¸­ç¬¬ä¸€ä¸ªjsonå­—ç¬¦ä¸²ä¸­<code>weight</code>å¯¹è±¡çš„å€¼ï¼Œä¹Ÿæ€»ä¸èƒ½ç”¨<code>[0]ã€[1]ã€[2]â€¦â€¦</code>çš„æ–¹å¼æ— ç©·å°½å–å€¼å§</p><p>åˆ°è¿™é‡Œæ€ç»´å°±é™åˆ¶ä½äº†ï¼Œé‡åˆ°è¿™ç§æƒ…å†µæ—¶ï¼Œä»¥å‰çš„æ–¹å¼æ˜¯é€šè¿‡æ­£åˆ™è¡¨è¾¾å¼å¤„ç†<br>å…·ä½“å®ç°å¦‚ä¸‹ï¼š<br>é¦–å…ˆå°†<code>item_properties</code>æŒ‰æŒ‡å®šåˆ†éš”ç¬¦splitä¸ºarrayæ•°ç»„ï¼Œå†åˆ©ç”¨explodeå‡½æ•°å°†arrayæ•°ç»„çš„å…ƒç´ é€è¡Œè¾“å‡ºï¼Œæœ€ç»ˆå¾—åˆ°çš„<code>item_propertie</code>å³ä¸ºå•ä¸ªjsonå­—ç¬¦ä¸²ï¼Œå¯æ ¹æ®<code>$.</code>æå–æŒ‡å®šjsonå¯¹è±¡çš„å€¼ï¼Œ</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- item_properties = [&#123;&quot;id&quot;:42,&quot;name&quot;:&quot;åŒ…è£…&quot;,&quot;sort&quot;:0,&quot;type&quot;:1&#125;</span></span><br><span class="line"><span class="comment">--                   ,&#123;&quot;id&quot;:43,&quot;name&quot;:&quot;ç§ç±»&quot;,&quot;sort&quot;:0,&quot;type&quot;:1&#125;</span></span><br><span class="line"><span class="comment">--                   ,&#123;&quot;id&quot;:44,&quot;name&quot;:&quot;è§„æ ¼&quot;,&quot;sort&quot;:0,&quot;type&quot;:2&#125;</span></span><br><span class="line"><span class="comment">--                   ,&#123;&quot;id&quot;:63,&quot;name&quot;:&quot;ä¿è´¨æœŸ(å¤©)&quot;,&quot;sort&quot;:0,&quot;type&quot;:2&#125;</span></span><br><span class="line"><span class="comment">--                   ,&#123;&quot;id&quot;:100,&quot;name&quot;:&quot;é€‚ç”¨å¹´é¾„&quot;,&quot;sort&quot;:0,&quot;type&quot;:2&#125;</span></span><br><span class="line"><span class="comment">--                   ,&#123;&quot;id&quot;:101,&quot;name&quot;:&quot;å‚¨å­˜æ¡ä»¶&quot;,&quot;sort&quot;:0,&quot;type&quot;:2&#125;]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> get_json_object(item_propertie,<span class="string">&#x27;$.id&#x27;</span>)</span><br><span class="line"><span class="keyword">from</span> table_a</span><br><span class="line"><span class="keyword">lateral</span> <span class="keyword">view</span> explode(split(regexp_replace(substr(item_properties,<span class="number">2</span>,length(item_properties)<span class="number">-2</span>),<span class="string">&#x27;\\&#125;\\,\\&#123;&#x27;</span>,<span class="string">&#x27;\\&#125;\\|\\|\\&#123;&#x27;</span>),<span class="string">&#x27;\\|\\|&#x27;</span>)) tmp <span class="keyword">as</span> item_propertie</span><br></pre></td></tr></table></figure><p>ä½†ä¸Šé¢è¿™ç§å¤„ç†æ–¹å¼å­˜åœ¨bugï¼Œå°†jsonæ•°æ®splitä¸ºarrayæ•°ç»„æ—¶ï¼Œå¿…é¡»ä¿è¯æŒ‡å®šåˆ†éš”ç¬¦ä¸å‡ºç°åœ¨å•ä¸ªjsonå­—ç¬¦ä¸²ä¸­ï¼Œæ¯”å¦‚ä¸Šè¿°caseä¸­æ˜¯ç”¨<code>&#125;,&#123;</code>æ›¿æ¢ä¸º<code>&#125;||&#123;</code>ï¼Œå†ä»¥<code>||</code>ä½œä¸ºåˆ†éš”ç¬¦splitï¼Œå¦‚è‹¥åœ¨å•ä¸ªjsonå­—ç¬¦ä¸²ä¸­ä¹Ÿå‡ºç°äº†<code>&#125;,&#123;</code>æˆ–æ˜¯<code>||</code>å°±ä¼šå¯¼è‡´è§£æå¤±è´¥</p><h2><span id="æ€ä¹ˆé«˜çº§äº†">æ€ä¹ˆé«˜çº§äº†</span></h2><p>çªç„¶æœ‰ä¸€å¤©åœ¨ç¿»çœ‹<a href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual+UDF?spm=a2c4g.11186623.0.0.3c267254Ka3fUh#LanguageManualUDF-get_json_object">hiveå®˜æ–¹æ–‡æ¡£</a>æ—¶å‘ç°pathæ”¯æŒçš„é€šé…ç¬¦<code>*</code><br><a href="https://imgloc.com/i/2Pw2H"><img src="https://i.328888.xyz/2023/01/17/2Pw2H.png" alt="2Pw2H.png"></a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ : è¡¨ç¤ºæ ¹èŠ‚ç‚¹</span><br><span class="line">. : è¡¨ç¤ºå­èŠ‚ç‚¹</span><br><span class="line">[] : [number]è¡¨ç¤ºæ•°ç»„ä¸‹æ ‡ï¼Œä»0å¼€å§‹</span><br><span class="line">* : []çš„é€šé…ç¬¦ï¼Œè¿”å›æ•´ä¸ªæ•°ç»„</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥ï¼Œä¸€å¼€å§‹çš„é—®é¢˜åº”è¯¥æŒ‰å¦‚ä¸‹è§£æ³•ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- jsonArray = &#123;&quot;store&quot;:</span></span><br><span class="line"><span class="comment">--                     &#123;</span></span><br><span class="line"><span class="comment">--                     &quot;fruit&quot;:[&#123;&quot;weight&quot;:8,&quot;type&quot;:&quot;apple&quot;&#125;, &#123;&quot;weight&quot;:9,&quot;type&quot;:&quot;pear&quot;&#125;],</span></span><br><span class="line"><span class="comment">--                     &quot;bicycle&quot;:&#123;&quot;price&quot;:19.95,&quot;color&quot;:&quot;red&quot;&#125;</span></span><br><span class="line"><span class="comment">--                     &#125;, </span></span><br><span class="line"><span class="comment">--             &quot;email&quot;:&quot;amy@only_for_json_udf_test.net&quot;, </span></span><br><span class="line"><span class="comment">--             &quot;owner&quot;:&quot;amy&quot;&#125;</span></span><br><span class="line"><span class="keyword">select</span> get_json_object(jsonArray, <span class="string">&#x27;$.store.fruit[*].weight&#x27;</span>);</span><br><span class="line"><span class="comment">-- return [8,9]</span></span><br></pre></td></tr></table></figure><p>ç¬”è€…ä¸ªäººè®¤ä¸ºï¼Œé«˜çº§ä¹‹å¤„åœ¨äºå†™æ³•æå…¶æ¸…çˆ½ï¼ŒæŒ‰ç…§ä»¥å‰ç”¨æ­£åˆ™è¡¨è¾¾å¼çš„å¤„ç†æ–¹æ³•ï¼Œéœ€è¦å¤šé“å¤„ç†æ‰èƒ½å¾—åˆ°ç»“æœ<code>[8,9]</code>ï¼Œè€Œä¸”å…¶ä¸­è¿˜æœ‰éšæ€§é£é™©ï¼Œä½†æ˜¯ç°åœ¨<code>$.store.fruit[*].weight</code>è¿™ç§æç®€è¯­æ³•æ—¢é¿å…äº†é£é™©ï¼Œåˆæ¸…æ™°æ˜“ç†è§£</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2&gt;&lt;span id=&quot;è¯­æ³•ä»‹ç»&quot;&gt;è¯­æ³•ä»‹ç»&lt;/span&gt;&lt;/h2&gt;&lt;figure class=&quot;highlight sql&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span cl</summary>
      
    
    
    
    <category term="SQL" scheme="https://llye-hub.github.io/categories/SQL/"/>
    
    
    <category term="SQLé«˜çº§è¯­æ³•" scheme="https://llye-hub.github.io/tags/SQL%E9%AB%98%E7%BA%A7%E8%AF%AD%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>èµ„æ–™æ±‡æ€»</title>
    <link href="https://llye-hub.github.io/posts/76d5a95a.html"/>
    <id>https://llye-hub.github.io/posts/76d5a95a.html</id>
    <published>2022-12-16T03:46:24.000Z</published>
    <updated>2023-02-22T02:49:03.975Z</updated>
    
    <content type="html"><![CDATA[<h1 id="SparkSQL"><a href="#SparkSQL" class="headerlink" title="SparkSQL"></a>SparkSQL</h1><p><a href="https://cloud.tencent.com/developer/article/1348071">Spark SQL Limit ä»‹ç»åŠä¼˜åŒ–</a></p><p><a href="https://tech.meituan.com/2016/04/29/spark-tuning-basic.html">Sparkæ€§èƒ½ä¼˜åŒ–æŒ‡å—â€”â€”åŸºç¡€ç¯‡</a></p><p><a href="https://tech.meituan.com/2016/05/12/spark-tuning-pro.html">Sparkæ€§èƒ½ä¼˜åŒ–æŒ‡å—â€”â€”é«˜çº§ç¯‡</a></p><h1 id="å¤§æ•°æ®ç¬”è®°"><a href="#å¤§æ•°æ®ç¬”è®°" class="headerlink" title="å¤§æ•°æ®ç¬”è®°"></a>å¤§æ•°æ®ç¬”è®°</h1><p><a href="https://github.com/heibaiying/BigData-Notes">å¤§æ•°æ®å…¥é—¨æŒ‡å—</a></p><h1 id="æ•°æ®ç»“æ„ä¸ç®—æ³•"><a href="#æ•°æ®ç»“æ„ä¸ç®—æ³•" class="headerlink" title="æ•°æ®ç»“æ„ä¸ç®—æ³•"></a>æ•°æ®ç»“æ„ä¸ç®—æ³•</h1><p><a href="https://programmercarl.com/other/algo_pdf.html">ä»£ç éšæƒ³å½•</a></p><h1 id="æ•°æ®æ²»ç†"><a href="#æ•°æ®æ²»ç†" class="headerlink" title="æ•°æ®æ²»ç†"></a>æ•°æ®æ²»ç†</h1><p><a href="https://www.infoq.cn/article/mBgvbc3bQWAbavwmBhXR">å­˜å‚¨å’Œè®¡ç®—èµ„æºéƒ½èŠ‚çœ 30%ï¼Œç½‘æ˜“äº‘éŸ³ä¹æ•°æ®æ²»ç†å®è·µ</a></p><h1 id="æ•°æ®åº“"><a href="#æ•°æ®åº“" class="headerlink" title="æ•°æ®åº“"></a>æ•°æ®åº“</h1><p><a href="https://www.infoq.cn/article/0rSVq2VIfUE0YLedLe5o">æ•°æ®åº“å†…æ ¸æ‚è°ˆç³»åˆ—</a></p><h1 id="ä¹±ä¸ƒå…«ç³Ÿçš„"><a href="#ä¹±ä¸ƒå…«ç³Ÿçš„" class="headerlink" title="ä¹±ä¸ƒå…«ç³Ÿçš„"></a>ä¹±ä¸ƒå…«ç³Ÿçš„</h1><p><a href="https://mp.weixin.qq.com/s/g5aQVHMUVkSrEO6QWDI1yw">2ä¸‡å­—æ­ç§˜é˜¿é‡Œå·´å·´æ•°æ®æ²»ç†å¹³å°å»ºè®¾ç»éªŒ</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;SparkSQL&quot;&gt;&lt;a href=&quot;#SparkSQL&quot; class=&quot;headerlink&quot; title=&quot;SparkSQL&quot;&gt;&lt;/a&gt;SparkSQL&lt;/h1&gt;&lt;p&gt;&lt;a href=&quot;https://cloud.tencent.com/developer/a</summary>
      
    
    
    
    <category term="èµ„æ–™" scheme="https://llye-hub.github.io/categories/%E8%B5%84%E6%96%99/"/>
    
    
  </entry>
  
</feed>
